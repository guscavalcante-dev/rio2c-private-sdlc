/**
* @version: 1.0.1
* @author: Dan Grossman http://www.dangrossman.info/
* @date: 2012-08-20
* @copyright: Copyright (c) 2012 Dan Grossman. All rights reserved.
* @license: Licensed under Apache License v2.0. See http://www.apache.org/licenses/LICENSE-2.0
* @website: http://www.improvely.com/
*/
!function(n){var t=function(t,i,r){var s=typeof i=="object",h,l,u,f,o,e,c,a,v,y;if(this.startDate=Date.today(),this.endDate=Date.today(),this.minDate=!1,this.maxDate=!1,this.changed=!1,this.ranges={},this.opens="right",this.cb=function(){},this.format="MM/dd/yyyy",this.separator=" - ",this.showWeekNumbers=!1,this.buttonClasses=["btn-primary"],this.locale={applyLabel:"Apply",fromLabel:"From",toLabel:"To",weekLabel:"W",customRangeLabel:"Custom Range",daysOfWeek:Date.CultureInfo.shortestDayNames,monthNames:Date.CultureInfo.monthNames,firstDay:0},h=this.locale,this.leftCalendar={month:Date.today().set({day:1,month:this.startDate.getMonth(),year:this.startDate.getFullYear()}),calendar:Array()},this.rightCalendar={month:Date.today().set({day:1,month:this.endDate.getMonth(),year:this.endDate.getFullYear()}),calendar:Array()},this.parentEl="body",this.element=n(t),this.element.hasClass("pull-right")&&(this.opens="left"),this.element.is("input"))this.element.on({click:n.proxy(this.show,this),focus:n.proxy(this.show,this)});else this.element.on("click",n.proxy(this.show,this));if(s&&typeof i.locale=="object"&&n.each(h,function(n,t){h[n]=i.locale[n]||t}),l='<div class="daterangepicker dropdown-menu"><div class="calendar left"><\/div><div class="calendar right"><\/div><div class="ranges"><div class="range_inputs"><div><label for="daterangepicker_start">'+this.locale.fromLabel+'<\/label><input class="input-mini form-control" type="text" name="daterangepicker_start" value="" disabled="disabled" /><\/div><div><label for="daterangepicker_end">'+this.locale.toLabel+'<\/label><input class="input-mini form-control" type="text" name="daterangepicker_end" value="" disabled="disabled" /><\/div><button class="btn btn-small" disabled="disabled">'+this.locale.applyLabel+"<\/button><\/div><\/div><\/div>",this.parentEl=s&&i.parentEl&&n(i.parentEl)||n(this.parentEl),this.container=n(l).appendTo(this.parentEl),s){if(typeof i.format=="string"&&(this.format=i.format),typeof i.separator=="string"&&(this.separator=i.separator),typeof i.startDate=="string"&&(this.startDate=Date.parse(i.startDate,this.format)),typeof i.endDate=="string"&&(this.endDate=Date.parse(i.endDate,this.format)),typeof i.minDate=="string"&&(this.minDate=Date.parse(i.minDate,this.format)),typeof i.maxDate=="string"&&(this.maxDate=Date.parse(i.maxDate,this.format)),typeof i.startDate=="object"&&(this.startDate=i.startDate),typeof i.endDate=="object"&&(this.endDate=i.endDate),typeof i.minDate=="object"&&(this.minDate=i.minDate),typeof i.maxDate=="object"&&(this.maxDate=i.maxDate),typeof i.ranges=="object"){for(e in i.ranges)(u=i.ranges[e][0],f=i.ranges[e][1],typeof u=="string"&&(u=Date.parse(u)),typeof f=="string"&&(f=Date.parse(f)),this.minDate&&u<this.minDate&&(u=this.minDate),this.maxDate&&f>this.maxDate&&(f=this.maxDate),this.minDate&&f<this.minDate||this.maxDate&&u>this.maxDate)||(this.ranges[e]=[u,f]);o="<ul>";for(e in this.ranges)o+="<li>"+e+"<\/li>";o+="<li>"+this.locale.customRangeLabel+"<\/li>";o+="<\/ul>";this.container.find(".ranges").prepend(o)}if(typeof i.locale=="object"&&typeof i.locale.firstDay=="number")for(this.locale.firstDay=i.locale.firstDay,c=i.locale.firstDay;c>0;)this.locale.daysOfWeek.push(this.locale.daysOfWeek.shift()),c--;typeof i.opens=="string"&&(this.opens=i.opens);typeof i.showWeekNumbers=="boolean"&&(this.showWeekNumbers=i.showWeekNumbers);typeof i.buttonClasses=="string"&&(this.buttonClasses=[i.buttonClasses]);typeof i.buttonClasses=="object"&&(this.buttonClasses=i.buttonClasses)}a=this.container;n.each(this.buttonClasses,function(n,t){a.find("button").addClass(t)});this.opens=="right"&&(v=this.container.find(".calendar.left"),y=this.container.find(".calendar.right"),v.removeClass("left").addClass("right"),y.removeClass("right").addClass("left"));(typeof i=="undefined"||typeof i.ranges=="undefined")&&this.container.find(".calendar").show();typeof r=="function"&&(this.cb=r);this.container.addClass("opens"+this.opens);this.container.on("mousedown",n.proxy(this.mousedown,this));this.container.find(".calendar").on("click",".prev",n.proxy(this.clickPrev,this));this.container.find(".calendar").on("click",".next",n.proxy(this.clickNext,this));this.container.find(".ranges").on("click","button",n.proxy(this.clickApply,this));this.container.find(".calendar").on("click","td.available",n.proxy(this.clickDate,this));this.container.find(".calendar").on("mouseenter","td.available",n.proxy(this.enterDate,this));this.container.find(".calendar").on("mouseleave","td.available",n.proxy(this.updateView,this));this.container.find(".ranges").on("click","li",n.proxy(this.clickRange,this));this.container.find(".ranges").on("mouseenter","li",n.proxy(this.enterRange,this));this.container.find(".ranges").on("mouseleave","li",n.proxy(this.updateView,this));this.element.on("keyup",n.proxy(this.updateFromControl,this));this.updateView();this.updateCalendars()};t.prototype={constructor:t,mousedown:function(n){n.stopPropagation();n.preventDefault()},updateView:function(){this.leftCalendar.month.set({month:this.startDate.getMonth(),year:this.startDate.getFullYear()});this.rightCalendar.month.set({month:this.endDate.getMonth(),year:this.endDate.getFullYear()});this.container.find("input[name=daterangepicker_start]").val(this.startDate.toString(this.format));this.container.find("input[name=daterangepicker_end]").val(this.endDate.toString(this.format));this.startDate.equals(this.endDate)||this.startDate.isBefore(this.endDate)?this.container.find("button").removeAttr("disabled"):this.container.find("button").attr("disabled","disabled")},updateFromControl:function(){if(this.element.is("input")){var i=this.element.val().split(this.separator),n=Date.parseExact(i[0],this.format),t=Date.parseExact(i[1],this.format);n!=null&&t!=null&&(t.isBefore(n)||(this.startDate=n,this.endDate=t,this.updateView(),this.cb(this.startDate,this.endDate),this.updateCalendars()))}},notify:function(){this.updateView();this.element.is("input")&&this.element.val(this.startDate.toString(this.format)+this.separator+this.endDate.toString(this.format));this.cb(this.startDate,this.endDate)},move:function(){var t={top:this.parentEl.offset().top-this.parentEl.scrollTop(),left:this.parentEl.offset().left-this.parentEl.scrollLeft()};this.opens=="left"?this.container.css({top:this.element.offset().top+this.element.outerHeight(),right:n(window).width()-this.element.offset().left-this.element.outerWidth()-t.left,left:"auto"}):this.container.css({top:this.element.offset().top+this.element.outerHeight(),left:this.element.offset().left-t.left,right:"auto"})},show:function(t){this.container.show();this.move();t&&(t.stopPropagation(),t.preventDefault());this.changed=!1;n(document).on("mousedown",n.proxy(this.hide,this))},hide:function(){this.container.hide();n(document).off("mousedown",this.hide);this.changed&&(this.changed=!1,this.notify())},enterRange:function(n){var i=n.target.innerHTML,t;i==this.locale.customRangeLabel?this.updateView():(t=this.ranges[i],this.container.find("input[name=daterangepicker_start]").val(t[0].toString(this.format)),this.container.find("input[name=daterangepicker_end]").val(t[1].toString(this.format)))},clickRange:function(n){var i=n.target.innerHTML,t;i==this.locale.customRangeLabel?this.container.find(".calendar").show():(t=this.ranges[i],this.startDate=t[0],this.endDate=t[1],this.leftCalendar.month.set({month:this.startDate.getMonth(),year:this.startDate.getFullYear()}),this.rightCalendar.month.set({month:this.endDate.getMonth(),year:this.endDate.getFullYear()}),this.updateCalendars(),this.changed=!0,this.container.find(".calendar").hide(),this.hide())},clickPrev:function(t){var i=n(t.target).parents(".calendar");i.hasClass("left")?this.leftCalendar.month.add({months:-1}):this.rightCalendar.month.add({months:-1});this.updateCalendars()},clickNext:function(t){var i=n(t.target).parents(".calendar");i.hasClass("left")?this.leftCalendar.month.add({months:1}):this.rightCalendar.month.add({months:1});this.updateCalendars()},enterDate:function(t){var i=n(t.target).attr("title"),r=i.substr(1,1),u=i.substr(3,1),f=n(t.target).parents(".calendar");f.hasClass("left")?this.container.find("input[name=daterangepicker_start]").val(this.leftCalendar.calendar[r][u].toString(this.format)):this.container.find("input[name=daterangepicker_end]").val(this.rightCalendar.calendar[r][u].toString(this.format))},clickDate:function(t){var i=n(t.target).attr("title"),r=i.substr(1,1),u=i.substr(3,1),f=n(t.target).parents(".calendar");f.hasClass("left")?(startDate=this.leftCalendar.calendar[r][u],endDate=this.endDate):(startDate=this.startDate,endDate=this.rightCalendar.calendar[r][u]);f.find("td").removeClass("active");(startDate.equals(endDate)||startDate.isBefore(endDate))&&(n(t.target).addClass("active"),startDate.equals(this.startDate)&&endDate.equals(this.endDate)||(this.changed=!0),this.startDate=startDate,this.endDate=endDate);this.leftCalendar.month.set({month:this.startDate.getMonth(),year:this.startDate.getFullYear()});this.rightCalendar.month.set({month:this.endDate.getMonth(),year:this.endDate.getFullYear()});this.updateCalendars()},clickApply:function(){this.hide()},updateCalendars:function(){this.leftCalendar.calendar=this.buildCalendar(this.leftCalendar.month.getMonth(),this.leftCalendar.month.getFullYear());this.rightCalendar.calendar=this.buildCalendar(this.rightCalendar.month.getMonth(),this.rightCalendar.month.getFullYear());this.container.find(".calendar.left").html(this.renderCalendar(this.leftCalendar.calendar,this.startDate,this.minDate,this.endDate));this.container.find(".calendar.right").html(this.renderCalendar(this.rightCalendar.calendar,this.endDate,this.startDate,this.maxDate))},buildCalendar:function(n,t){for(var r,u,e=Date.today().set({day:1,month:n,year:t}),h=e.clone().add(-1).day().getMonth(),c=e.clone().add(-1).day().getFullYear(),v=Date.getDaysInMonth(t,n),o=Date.getDaysInMonth(c,h),l=e.getDay(),s=Array(),i=0;i<6;i++)s[i]=Array();r=o-l+this.locale.firstDay+1;r>o&&(r-=7);l==this.locale.firstDay&&(r=o-6);u=Date.today().set({day:r,month:h,year:c});for(var i=0,f=0,a=0;i<42;i++,f++,u=u.clone().add(1).day())i>0&&f%7==0&&(f=0,a++),s[a][f]=u;return s},renderCalendar:function(t,i,r,u){var f='<table class="table-condensed">',e,o,s,h;for(f+="<thead>",f+="<tr>",this.showWeekNumbers&&(f+="<th><\/th>"),f+=!r||r<t[1][1]?'<th class="prev available"><i class="icon-arrow-left"><\/i><\/th>':"<th><\/th>",f+='<th colspan="5" style="width: auto">'+this.locale.monthNames[t[1][1].getMonth()]+t[1][1].toString(" yyyy")+"<\/th>",f+=!u||u>t[1][1]?'<th class="next available"><i class="icon-arrow-right"><\/i><\/th>':"<th><\/th>",f+="<\/tr>",f+="<tr>",this.showWeekNumbers&&(f+='<th class="week">'+this.locale.weekLabel+"<\/th>"),n.each(this.locale.daysOfWeek,function(n,t){f+="<th>"+t+"<\/th>"}),f+="<\/tr>",f+="<\/thead>",f+="<tbody>",e=0;e<6;e++){for(f+="<tr>",this.showWeekNumbers&&(f+='<td class="week">'+t[e][0].getWeek()+"<\/td>"),o=0;o<7;o++)s="available ",s+=t[e][o].getMonth()==t[1][1].getMonth()?"":"off",i.setHours(0,0,0,0),r&&t[e][o]<r||u&&t[e][o]>u?s="off disabled":t[e][o].equals(i)&&(s+="active"),h="r"+e+"c"+o,f+='<td class="'+s+'" title="'+h+'">'+t[e][o].getDate()+"<\/td>";f+="<\/tr>"}return f+="<\/tbody>",f+="<\/table>"}};n.fn.daterangepicker=function(i,r){return this.each(function(){var u=n(this);u.data("daterangepicker")||u.data("daterangepicker",new t(u,i,r))}),this}}(window.jQuery);