/*! Fabric.js Copyright 2008-2014, Printio (Juriy Zaytsev, Maxim Chernyak) */
"use strict";var fabric=fabric||{version:"1.4.13"};typeof exports!="undefined"&&(exports.fabric=fabric);typeof document!="undefined"&&typeof window!="undefined"?(fabric.document=document,fabric.window=window):(fabric.document=require("jsdom").jsdom("<!DOCTYPE html><html><head><\/head><body><\/body><\/html>"),fabric.window=fabric.document.createWindow?fabric.document.createWindow():fabric.document.parentWindow);fabric.isTouchSupported="ontouchstart"in fabric.document.documentElement;fabric.isLikelyNode=typeof Buffer!="undefined"&&typeof window=="undefined";fabric.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width"];fabric.DPI=96;fabric.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)",function(){function n(n,t){this.__eventListeners[n]&&(t?fabric.util.removeFromArray(this.__eventListeners[n],t):this.__eventListeners[n].length=0)}function t(n,t){if(this.__eventListeners||(this.__eventListeners={}),arguments.length===1)for(var i in n)this.on(i,n[i]);else this.__eventListeners[n]||(this.__eventListeners[n]=[]),this.__eventListeners[n].push(t);return this}function i(t,i){if(this.__eventListeners){if(arguments.length===0)this.__eventListeners={};else if(arguments.length===1&&typeof arguments[0]=="object")for(var r in t)n.call(this,r,t[r]);else n.call(this,t,i);return this}}function r(n,t){var i,r,u;if(this.__eventListeners&&(i=this.__eventListeners[n],i)){for(r=0,u=i.length;r<u;r++)i[r].call(this,t||{});return this}}fabric.Observable={observe:t,stopObserving:i,fire:r,on:t,off:i,trigger:r}}();fabric.Collection={add:function(){this._objects.push.apply(this._objects,arguments);for(var n=0,t=arguments.length;n<t;n++)this._onObjectAdded(arguments[n]);return this.renderOnAddRemove&&this.renderAll(),this},insertAt:function(n,t,i){var r=this.getObjects();return i?r[t]=n:r.splice(t,0,n),this._onObjectAdded(n),this.renderOnAddRemove&&this.renderAll(),this},remove:function(){for(var i=this.getObjects(),t,n=0,r=arguments.length;n<r;n++)t=i.indexOf(arguments[n]),t!==-1&&(i.splice(t,1),this._onObjectRemoved(arguments[n]));return this.renderOnAddRemove&&this.renderAll(),this},forEachObject:function(n,t){for(var i=this.getObjects(),r=i.length;r--;)n.call(t,i[r],r,i);return this},getObjects:function(n){return typeof n=="undefined"?this._objects:this._objects.filter(function(t){return t.type===n})},item:function(n){return this.getObjects()[n]},isEmpty:function(){return this.getObjects().length===0},size:function(){return this.getObjects().length},contains:function(n){return this.getObjects().indexOf(n)>-1},complexity:function(){return this.getObjects().reduce(function(n,t){return n+=t.complexity?t.complexity():0,n},0)}},function(n){var i=Math.sqrt,r=Math.atan2,t=Math.PI/180;fabric.util={removeFromArray:function(n,t){var i=n.indexOf(t);return i!==-1&&n.splice(i,1),n},getRandomInt:function(n,t){return Math.floor(Math.random()*(t-n+1))+n},degreesToRadians:function(n){return n*t},radiansToDegrees:function(n){return n/t},rotatePoint:function(n,t,i){var r=Math.sin(i),u=Math.cos(i),f,e;return n.subtractEquals(t),f=n.x*u-n.y*r,e=n.x*r+n.y*u,new fabric.Point(f,e).addEquals(t)},transformPoint:function(n,t,i){return i?new fabric.Point(t[0]*n.x+t[1]*n.y,t[2]*n.x+t[3]*n.y):new fabric.Point(t[0]*n.x+t[1]*n.y+t[4],t[2]*n.x+t[3]*n.y+t[5])},invertTransform:function(n){var t=n.slice(),i=1/(n[0]*n[3]-n[1]*n[2]),r;return t=[i*n[3],-i*n[1],-i*n[2],i*n[0],0,0],r=fabric.util.transformPoint({x:n[4],y:n[5]},t),t[4]=-r.x,t[5]=-r.y,t},toFixed:function(n,t){return parseFloat(Number(n).toFixed(t))},parseUnit:function(n,t){var r=/\D{0,2}$/.exec(n),i=parseFloat(n);t||(t=fabric.Text.DEFAULT_SVG_FONT_SIZE);switch(r[0]){case"mm":return i*fabric.DPI/25.4;case"cm":return i*fabric.DPI/2.54;case"in":return i*fabric.DPI;case"pt":return i*fabric.DPI/72;case"pc":return i*fabric.DPI/6;case"em":return i*t;default:return i}},falseFunction:function(){return!1},getKlass:function(n,t){return n=fabric.util.string.camelize(n.charAt(0).toUpperCase()+n.slice(1)),fabric.util.resolveNamespace(t)[n]},resolveNamespace:function(t){var i;if(!t)return fabric;var u=t.split("."),f=u.length,r=n||fabric.window;for(i=0;i<f;++i)r=r[u[i]];return r},loadImage:function(n,t,i,r){if(!n){t&&t.call(i,n);return}var u=fabric.util.createImage();u.onload=function(){t&&t.call(i,u);u=u.onload=u.onerror=null};u.onerror=function(){fabric.log("Error loading "+u.src);t&&t.call(i,null,!0);u=u.onload=u.onerror=null};n.indexOf("data")!==0&&typeof r!="undefined"&&(u.crossOrigin=r);u.src=n},enlivenObjects:function(n,t,i,r){function f(){++o===e&&t&&t(u)}n=n||[];var u=[],o=0,e=n.length;if(!e){t&&t(u);return}n.forEach(function(n,t){if(!n||!n.type){f();return}var e=fabric.util.getKlass(n.type,i);e.async?e.fromObject(n,function(i,e){e||(u[t]=i,r&&r(n,u[t]));f()}):(u[t]=e.fromObject(n),r&&r(n,u[t]),f())})},groupSVGElements:function(n,t,i){var r;return r=new fabric.PathGroup(n,t),typeof i!="undefined"&&r.setSourcePath(i),r},populateWithProperties:function(n,t,i){if(i&&Object.prototype.toString.call(i)==="[object Array]")for(var r=0,u=i.length;r<u;r++)i[r]in n&&(t[i[r]]=n[i[r]])},drawDashedLine:function(n,t,u,f,e,o){var s=f-t,h=e-u,c=i(s*s+h*h),a=r(h,s),v=o.length,y=0,l=!0;for(n.save(),n.translate(t,u),n.moveTo(0,0),n.rotate(a),t=0;c>t;)t+=o[y++%v],t>c&&(t=c),n[l?"lineTo":"moveTo"](t,0),l=!l;n.restore()},createCanvasElement:function(n){return n||(n=fabric.document.createElement("canvas")),!n.getContext&&typeof G_vmlCanvasManager!="undefined"&&G_vmlCanvasManager.initElement(n),n},createImage:function(){return fabric.isLikelyNode?new(require("canvas").Image):fabric.document.createElement("img")},createAccessors:function(n){for(var t=n.prototype,r=t.stateProperties.length;r--;){var i=t.stateProperties[r],u=i.charAt(0).toUpperCase()+i.slice(1),f="set"+u,e="get"+u;t[e]||(t[e]=function(n){return new Function('return this.get("'+n+'")')}(i));t[f]||(t[f]=function(n){return new Function("value",'return this.set("'+n+'", value)')}(i))}},clipContext:function(n,t){t.save();t.beginPath();n.clipTo(t);t.clip()},multiplyTransformMatrices:function(n,t){for(var u,e,f,o=[[n[0],n[2],n[4]],[n[1],n[3],n[5]],[0,0,1]],s=[[t[0],t[2],t[4]],[t[1],t[3],t[5]],[0,0,1]],i=[],r=0;r<3;r++)for(i[r]=[],u=0;u<3;u++){for(e=0,f=0;f<3;f++)e+=o[r][f]*s[f][u];i[r][u]=e}return[i[0][0],i[1][0],i[0][1],i[1][1],i[0][2],i[1][2]]},getFunctionBody:function(n){return(String(n).match(/function[^{]*\{([\s\S]*)\}/)||{})[1]},isTransparent:function(n,t,i,r){var u,f,e,o,s;for(r>0&&(t>r?t-=r:t=0,i>r?i-=r:i=0),u=!0,f=n.getImageData(t,i,r*2||1,r*2||1),e=3,o=f.data.length;e<o;e+=4)if(s=f.data[e],u=s<=0,u===!1)break;return f=null,u}}}(typeof exports!="undefined"?exports:undefined),function(){function u(n,i,u,e,s,h,c){var rt=r.call(arguments),et,y;if(t[rt])return t[rt];var nt=Math.PI,ht=c*nt/180,p=Math.sin(ht),w=Math.cos(ht),ct=0,lt=0;u=Math.abs(u);e=Math.abs(e);var l=-w*n*.5-p*i*.5,a=-w*i*.5+p*n*.5,tt=u*u,it=e*e,at=a*a,vt=l*l,ut=tt*it-tt*at-it*vt,ft=0;ut<0?(et=Math.sqrt(1-ut/(tt*it)),u*=et,e*=et):ft=(s===h?-1:1)*Math.sqrt(ut/(tt*at+it*vt));var b=ft*u*a/e,k=-ft*e*l/u,pt=w*b-p*k+n*.5,wt=p*b+w*k+i*.5,ot=f(1,0,(l-b)/u,(a-k)/e),v=f((l-b)/u,(a-k)/e,(-l-b)/u,(-a-k)/e);h===0&&v>0?v-=2*nt:h===1&&v<0&&(v+=2*nt);var yt=Math.ceil(Math.abs(v/nt*2)),d=[],g=v/yt,bt=8/3*Math.sin(g/4)*Math.sin(g/4)/Math.sin(g/2),st=ot+g;for(y=0;y<yt;y++)d[y]=o(ot,st,w,p,u,e,pt,wt,bt,ct,lt),ct=d[y][4],lt=d[y][5],ot=st,st+=g;return t[rt]=d,d}function o(t,i,u,f,e,o,s,h,c,l,a){var v=r.call(arguments);if(n[v])return n[v];var w=Math.cos(t),b=Math.sin(t),y=Math.cos(i),p=Math.sin(i),k=u*e*y-f*o*p+s,d=f*e*y+u*o*p+h,g=l+c*(-u*e*b-f*o*w),nt=a+c*(-f*e*b+u*o*w),tt=k+c*(u*e*p+f*o*y),it=d+c*(f*e*p-u*o*y);return n[v]=[g,nt,tt,it,k,d],n[v]}function f(n,t,i,r){var u=Math.atan2(t,n),f=Math.atan2(r,i);return f>=u?f-u:2*Math.PI-(u-f)}function e(n,t,u,f,e,o,s,h){var tt=r.call(arguments),nt,st,ht,p,b,l,ut;if(i[tt])return i[tt];var ct=Math.sqrt,ft=Math.min,et=Math.max,ot=Math.abs,w=[],a=[[],[]],y,v,k,c,d,g,it,rt;for(v=6*n-12*u+6*e,y=-3*n+9*u-9*e+3*s,k=3*u-3*n,nt=0;nt<2;++nt){if(nt>0&&(v=6*t-12*f+6*o,y=-3*t+9*f-9*o+3*h,k=3*f-3*t),ot(y)<1e-12){if(ot(v)<1e-12)continue;c=-k/v;0<c&&c<1&&w.push(c);continue}(it=v*v-4*k*y,it<0)||(rt=ct(it),d=(-v+rt)/(2*y),0<d&&d<1&&w.push(d),g=(-v-rt)/(2*y),0<g&&g<1&&w.push(g))}for(p=w.length,b=p;p--;)c=w[p],l=1-c,st=l*l*l*n+3*l*l*c*u+3*l*c*c*e+c*c*c*s,a[0][p]=st,ht=l*l*l*t+3*l*l*c*f+3*l*c*c*o+c*c*c*h,a[1][p]=ht;return a[0][b]=n,a[1][b]=t,a[0][b+1]=s,a[1][b+1]=h,ut=[{x:ft.apply(null,a[0]),y:ft.apply(null,a[1])},{x:et.apply(null,a[0]),y:et.apply(null,a[1])}],i[tt]=ut,ut}var t={},n={},i={},r=Array.prototype.join;fabric.util.drawArc=function(n,t,i,r){for(var s=r[0],h=r[1],c=r[2],l=r[3],a=r[4],v=r[5],y=r[6],e=[[],[],[],[]],o=u(v-t,y-i,s,h,l,a,c),f=0,p=o.length;f<p;f++)e[f][0]=o[f][0]+t,e[f][1]=o[f][1]+i,e[f][2]=o[f][2]+t,e[f][3]=o[f][3]+i,e[f][4]=o[f][4]+t,e[f][5]=o[f][5]+i,n.bezierCurveTo.apply(n,e[f])};fabric.util.getBoundsOfArc=function(n,t,i,r,f,o,s,h,c){for(var p=0,w=0,v=[],y=[],a=u(h-n,c-t,i,r,o,s,f),l=0,b=a.length;l<b;l++)v=e(p,w,a[l][0],a[l][1],a[l][2],a[l][3],a[l][4],a[l][5]),v[0].x+=n,v[0].y+=t,v[1].x+=n,v[1].y+=t,y.push(v[0]),y.push(v[1]),p=a[l][4],w=a[l][5];return y};fabric.util.getBoundsOfCurve=e}(),function(){function t(n,t){for(var r=u.call(arguments,2),f=[],i=0,e=n.length;i<e;i++)f[i]=r.length?n[i][t].apply(n[i],r):n[i][t].call(n[i]);return f}function i(t,i){return n(t,i,function(n,t){return n>=t})}function r(t,i){return n(t,i,function(n,t){return n<t})}function n(n,t,i){if(n&&n.length!==0){var r=n.length-1,u=t?n[r][t]:n[r];if(t)while(r--)i(n[r][t],u)&&(u=n[r][t]);else while(r--)i(n[r],u)&&(u=n[r]);return u}}var u=Array.prototype.slice;Array.prototype.indexOf||(Array.prototype.indexOf=function(n){var u,r,t,i;if(this===void 0||this===null)throw new TypeError;if((u=Object(this),r=u.length>>>0,r===0)||(t=0,arguments.length>0&&(t=Number(arguments[1]),t!==t?t=0:t!==0&&t!==Number.POSITIVE_INFINITY&&t!==Number.NEGATIVE_INFINITY&&(t=(t>0||-1)*Math.floor(Math.abs(t)))),t>=r))return-1;for(i=t>=0?t:Math.max(r-Math.abs(t),0);i<r;i++)if(i in u&&u[i]===n)return i;return-1});Array.prototype.forEach||(Array.prototype.forEach=function(n,t){for(var i=0,r=this.length>>>0;i<r;i++)i in this&&n.call(t,this[i],i,this)});Array.prototype.map||(Array.prototype.map=function(n,t){for(var r=[],i=0,u=this.length>>>0;i<u;i++)i in this&&(r[i]=n.call(t,this[i],i,this));return r});Array.prototype.every||(Array.prototype.every=function(n,t){for(var i=0,r=this.length>>>0;i<r;i++)if(i in this&&!n.call(t,this[i],i,this))return!1;return!0});Array.prototype.some||(Array.prototype.some=function(n,t){for(var i=0,r=this.length>>>0;i<r;i++)if(i in this&&n.call(t,this[i],i,this))return!0;return!1});Array.prototype.filter||(Array.prototype.filter=function(n,t){for(var u=[],r,i=0,f=this.length>>>0;i<f;i++)i in this&&(r=this[i],n.call(t,r,i,this)&&u.push(r));return u});Array.prototype.reduce||(Array.prototype.reduce=function(n){var r=this.length>>>0,t=0,i;if(arguments.length>1)i=arguments[1];else do{if(t in this){i=this[t++];break}if(++t>=r)throw new TypeError;}while(1);for(;t<r;t++)t in this&&(i=n.call(null,i,this[t],t,this));return i});fabric.util.array={invoke:t,min:r,max:i}}(),function(){function n(n,t){for(var i in t)n[i]=t[i];return n}function t(t){return n({},t)}fabric.util.object={extend:n,clone:t}}(),function(){function n(n){return n.replace(/-+(.)?/g,function(n,t){return t?t.toUpperCase():""})}function t(n,t){return n.charAt(0).toUpperCase()+(t?n.slice(1):n.slice(1).toLowerCase())}function i(n){return n.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")});fabric.util.string={camelize:n,capitalize:t,escapeXml:i}}(),function(){var t=Array.prototype.slice,i=Function.prototype.apply,n=function(){};Function.prototype.bind||(Function.prototype.bind=function(r){var f=this,e=t.call(arguments,1),u;return u=e.length?function(){return i.call(f,this instanceof n?this:r,e.concat(t.call(arguments)))}:function(){return i.call(f,this instanceof n?this:r,arguments)},n.prototype=this.prototype,u.prototype=new n,u})}(),function(){function n(){}function i(n){var i=this.constructor.superclass.prototype[n];return arguments.length>1?i.apply(this,t.call(arguments,1)):i.call(this)}function r(){function r(){this.initialize.apply(this,arguments)}var f=null,o=t.call(arguments,0),s,h;for(typeof o[0]=="function"&&(f=o.shift()),r.superclass=f,r.subclasses=[],f&&(n.prototype=f.prototype,r.prototype=new n,f.subclasses.push(r)),s=0,h=o.length;s<h;s++)e(r,o[s],f);return r.prototype.initialize||(r.prototype.initialize=u),r.prototype.constructor=r,r.prototype.callSuper=i,r}var t=Array.prototype.slice,u=function(){},f=function(){for(var n in{toString:1})if(n==="toString")return!1;return!0}(),e=function(n,t,i){for(var r in t)n.prototype[r]=r in n.prototype&&typeof n.prototype[r]=="function"&&(t[r]+"").indexOf("callSuper")>-1?function(n){return function(){var u=this.constructor.superclass,r;return this.constructor.superclass=i,r=t[n].apply(this,arguments),this.constructor.superclass=u,n!=="initialize"?r:void 0}}(r):t[r],f&&(t.toString!==Object.prototype.toString&&(n.prototype.toString=t.toString),t.valueOf!==Object.prototype.valueOf&&(n.prototype.valueOf=t.valueOf))};fabric.util.createClass=r}(),function(){function i(n){for(var i=Array.prototype.slice.call(arguments,1),r,u=i.length,t=0;t<u;t++)if(r=typeof n[i[t]],!/^(?:function|object|unknown)$/.test(r))return!1;return!0}function a(n,t){return{handler:t,wrappedHandler:v(n,t)}}function v(n,t){return function(i){t.call(c(n),i||fabric.window.event)}}function y(t,i){return function(r){var f,u,e;if(n[t]&&n[t][i])for(f=n[t][i],u=0,e=f.length;u<e;u++)f[u].call(this,r||fabric.window.event)}}function p(n,t){n||(n=fabric.window.event);var r=n.target||(typeof n.srcElement!==e?n.srcElement:null),i=fabric.util.getScrollLeftTop(r,t);return{x:o(n)+i.left,y:s(n)+i.top}}function h(n,t,i){var r=n.type==="touchend"?"changedTouches":"touches";return n[r]&&n[r][0]?n[r][0][t]-(n[r][0][t]-n[r][0][i])||n[i]:n[i]}var e="unknown",c,l,r=function(){var n=0;return function(t){return t.__uniqueID||(t.__uniqueID="uniqueID__"+n++)}}(),o,s;(function(){var n={};c=function(t){return n[t]};l=function(t,i){n[t]=i}})();var w=i(fabric.document.documentElement,"addEventListener","removeEventListener")&&i(fabric.window,"addEventListener","removeEventListener"),b=i(fabric.document.documentElement,"attachEvent","detachEvent")&&i(fabric.window,"attachEvent","detachEvent"),t={},n={},u,f;w?(u=function(n,t,i){n.addEventListener(t,i,!1)},f=function(n,t,i){n.removeEventListener(t,i,!1)}):b?(u=function(n,i,u){var f=r(n),e;l(f,n);t[f]||(t[f]={});t[f][i]||(t[f][i]=[]);e=a(f,u);t[f][i].push(e);n.attachEvent("on"+i,e.wrappedHandler)},f=function(n,i,u){var f=r(n),o,e,s;if(t[f]&&t[f][i])for(e=0,s=t[f][i].length;e<s;e++)o=t[f][i][e],o&&o.handler===u&&(n.detachEvent("on"+i,o.wrappedHandler),t[f][i][e]=null)}):(u=function(t,i,u){var f=r(t),e;n[f]||(n[f]={});n[f][i]||(n[f][i]=[],e=t["on"+i],e&&n[f][i].push(e),t["on"+i]=y(f,i));n[f][i].push(u)},f=function(t,i,u){var o=r(t),e,f,s;if(n[o]&&n[o][i])for(e=n[o][i],f=0,s=e.length;f<s;f++)e[f]===u&&e.splice(f,1)});fabric.util.addListener=u;fabric.util.removeListener=f;o=function(n){return typeof n.clientX!==e?n.clientX:0};s=function(n){return typeof n.clientY!==e?n.clientY:0};fabric.isTouchSupported&&(o=function(n){return h(n,"pageX","clientX")},s=function(n){return h(n,"pageY","clientY")});fabric.util.getPointer=p;fabric.util.object.extend(fabric.util,fabric.Observable)}(),function(){function r(t,i){var u=t.style,r,f;if(!u)return t;if(typeof i=="string")return t.style.cssText+=";"+i,i.indexOf("opacity")>-1?n(t,i.match(/opacity:\s*(\d?\.?\d*)/)[1]):t;for(r in i)r==="opacity"?n(t,i[r]):(f=r==="float"||r==="cssFloat"?typeof u.styleFloat=="undefined"?"cssFloat":"styleFloat":r,u[f]=i[r]);return t}var t=fabric.document.createElement("div"),u=typeof t.style.opacity=="string",f=typeof t.style.filter=="string",i=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,n=function(n){return n};u?n=function(n,t){return n.style.opacity=t,n}:f&&(n=function(n,t){var r=n.style;return n.currentStyle&&!n.currentStyle.hasLayout&&(r.zoom=1),i.test(r.filter)?(t=t>=.9999?"":"alpha(opacity="+t*100+")",r.filter=r.filter.replace(i,t)):r.filter+=" alpha(opacity="+t*100+")",n});fabric.util.setStyle=r}(),function(){function u(n){return typeof n=="string"?fabric.document.getElementById(n):n}function i(n,t){var r=fabric.document.createElement(n);for(var i in t)i==="class"?r.className=t[i]:i==="for"?r.htmlFor=t[i]:r.setAttribute(i,t[i]);return r}function f(n,t){n&&(" "+n.className+" ").indexOf(" "+t+" ")===-1&&(n.className+=(n.className?" ":"")+t)}function e(n,t,r){return typeof t=="string"&&(t=i(t,r)),n.parentNode&&n.parentNode.replaceChild(t,n),t.appendChild(n),t}function o(n,t){for(var u,i=0,r=0,e=fabric.document.documentElement,o=fabric.document.body||{scrollLeft:0,scrollTop:0},f=n;n&&n.parentNode&&!u;)n=n.parentNode,n.nodeType===1&&fabric.util.getElementStyle(n,"position")==="fixed"&&(u=n),n.nodeType===1&&f!==t&&fabric.util.getElementStyle(n,"position")==="absolute"?(i=0,r=0):n===fabric.document?(i=o.scrollLeft||e.scrollLeft||0,r=o.scrollTop||e.scrollTop||0):(i+=n.scrollLeft||0,r+=n.scrollTop||0);return{left:i,top:r}}function s(n){var i,o=n&&n.ownerDocument,r={left:0,top:0},u={left:0,top:0},f,s={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"},e;if(!o)return{left:0,top:0};for(e in s)u[s[e]]+=parseInt(t(n,e),10)||0;return i=o.documentElement,typeof n.getBoundingClientRect!="undefined"&&(r=n.getBoundingClientRect()),f=fabric.util.getScrollLeftTop(n,null),{left:r.left+f.left-(i.clientLeft||0)+u.left,top:r.top+f.top-(i.clientTop||0)+u.top}}var h=Array.prototype.slice,r,n=function(n){return h.call(n,0)},t;try{r=n(fabric.document.childNodes)instanceof Array}catch(c){}r||(n=function(n){for(var i=new Array(n.length),t=n.length;t--;)i[t]=n[t];return i});t=fabric.document.defaultView&&fabric.document.defaultView.getComputedStyle?function(n,t){var i=fabric.document.defaultView.getComputedStyle(n,null);return i?i[t]:undefined}:function(n,t){var i=n.style[t];return!i&&n.currentStyle&&(i=n.currentStyle[t]),i},function(){function i(n){return typeof n.onselectstart!="undefined"&&(n.onselectstart=fabric.util.falseFunction),t?n.style[t]="none":typeof n.unselectable=="string"&&(n.unselectable="on"),n}function r(n){return typeof n.onselectstart!="undefined"&&(n.onselectstart=null),t?n.style[t]="":typeof n.unselectable=="string"&&(n.unselectable=""),n}var n=fabric.document.documentElement.style,t="userSelect"in n?"userSelect":"MozUserSelect"in n?"MozUserSelect":"WebkitUserSelect"in n?"WebkitUserSelect":"KhtmlUserSelect"in n?"KhtmlUserSelect":"";fabric.util.makeElementUnselectable=i;fabric.util.makeElementSelectable=r}(),function(){function n(n,t){var u=fabric.document.getElementsByTagName("head")[0],i=fabric.document.createElement("script"),r=!0;i.onload=i.onreadystatechange=function(n){if(r){if(typeof this.readyState=="string"&&this.readyState!=="loaded"&&this.readyState!=="complete")return;r=!1;t(n||fabric.window.event);i=i.onload=i.onreadystatechange=null}};i.src=n;u.appendChild(i)}fabric.util.getScript=n}();fabric.util.getById=u;fabric.util.toArray=n;fabric.util.makeElement=i;fabric.util.addClass=f;fabric.util.wrapElement=e;fabric.util.getScrollLeftTop=o;fabric.util.getElementOffset=s;fabric.util.getElementStyle=t}(),function(){function n(n,t){return n+(/\?/.test(n)?"&":"?")+t}function t(){}function i(i,u){u||(u={});var e=u.method?u.method.toUpperCase():"GET",s=u.onComplete||function(){},f=r(),o;return f.onreadystatechange=function(){f.readyState===4&&(s(f),f.onreadystatechange=t)},e==="GET"&&(o=null,typeof u.parameters=="string"&&(i=n(i,u.parameters))),f.open(e,i,!0),(e==="POST"||e==="PUT")&&f.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),f.send(o),f}var r=function(){for(var i,n=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest}],t=n.length;t--;)try{if(i=n[t](),i)return n[t]}catch(r){}}();fabric.util.request=i}();fabric.log=function(){};fabric.warn=function(){};typeof console!="undefined"&&["log","warn"].forEach(function(n){typeof console[n]!="undefined"&&console[n].apply&&(fabric[n]=function(){return console[n].apply(console,arguments)})}),function(){function t(t){n(function(i){t||(t={});var u=i||+new Date,f=t.duration||500,e=u+f,r,s=t.onChange||function(){},h=t.abort||function(){return!1},c=t.easing||function(n,t,i,r){return-i*Math.cos(n/r*(Math.PI/2))+i+t},o="startValue"in t?t.startValue:0,l="endValue"in t?t.endValue:100,a=t.byValue||l-o;t.onStart&&t.onStart(),function v(i){r=i||+new Date;var l=r>e?f:r-u;if(h()){t.onComplete&&t.onComplete();return}if(s(c(l,o,a,f)),r>e){t.onComplete&&t.onComplete();return}n(v)}(u)})}function n(){return i.apply(fabric.window,arguments)}var i=fabric.window.requestAnimationFrame||fabric.window.webkitRequestAnimationFrame||fabric.window.mozRequestAnimationFrame||fabric.window.oRequestAnimationFrame||fabric.window.msRequestAnimationFrame||function(n){fabric.window.setTimeout(n,1e3/60)};fabric.util.animate=t;fabric.util.requestAnimFrame=n}(),function(){function n(n,t,i,r){return n<Math.abs(t)?(n=t,r=i/4):r=i/(2*Math.PI)*Math.asin(t/n),{a:n,c:t,p:i,s:r}}function i(n,t,i){return n.a*Math.pow(2,10*(t-=1))*Math.sin((t*i-n.s)*2*Math.PI/n.p)}function u(n,t,i,r){return i*((n=n/r-1)*n*n+1)+t}function f(n,t,i,r){return n/=r/2,n<1?i/2*n*n*n+t:i/2*((n-=2)*n*n+2)+t}function e(n,t,i,r){return i*(n/=r)*n*n*n+t}function o(n,t,i,r){return-i*((n=n/r-1)*n*n*n-1)+t}function s(n,t,i,r){return n/=r/2,n<1?i/2*n*n*n*n+t:-i/2*((n-=2)*n*n*n-2)+t}function h(n,t,i,r){return i*(n/=r)*n*n*n*n+t}function c(n,t,i,r){return i*((n=n/r-1)*n*n*n*n+1)+t}function l(n,t,i,r){return n/=r/2,n<1?i/2*n*n*n*n*n+t:i/2*((n-=2)*n*n*n*n+2)+t}function a(n,t,i,r){return-i*Math.cos(n/r*(Math.PI/2))+i+t}function v(n,t,i,r){return i*Math.sin(n/r*(Math.PI/2))+t}function y(n,t,i,r){return-i/2*(Math.cos(Math.PI*n/r)-1)+t}function p(n,t,i,r){return n===0?t:i*Math.pow(2,10*(n/r-1))+t}function w(n,t,i,r){return n===r?t+i:i*(-Math.pow(2,-10*n/r)+1)+t}function b(n,t,i,r){return n===0?t:n===r?t+i:(n/=r/2,n<1?i/2*Math.pow(2,10*(n-1))+t:i/2*(-Math.pow(2,-10*--n)+2)+t)}function k(n,t,i,r){return-i*(Math.sqrt(1-(n/=r)*n)-1)+t}function d(n,t,i,r){return i*Math.sqrt(1-(n=n/r-1)*n)+t}function g(n,t,i,r){return n/=r/2,n<1?-i/2*(Math.sqrt(1-n*n)-1)+t:i/2*(Math.sqrt(1-(n-=2)*n)+1)+t}function nt(t,r,u,f){var e=0,s=u,o;return t===0?r:(t/=f,t===1)?r+u:(e||(e=f*.3),o=n(s,u,e,1.70158),-i(o,t,f)+r)}function tt(t,i,r,u){var e=0,o=r,f;return t===0?i:(t/=u,t===1)?i+r:(e||(e=u*.3),f=n(o,r,e,1.70158),f.a*Math.pow(2,-10*t)*Math.sin((t*u-f.s)*2*Math.PI/f.p)+f.c+i)}function it(t,r,u,f){var o=0,s=u,e;return t===0?r:(t/=f/2,t===2)?r+u:(o||(o=f*.3*1.5),e=n(s,u,o,1.70158),t<1?-.5*i(e,t,f)+r:e.a*Math.pow(2,-10*(t-=1))*Math.sin((t*f-e.s)*2*Math.PI/e.p)*.5+e.c+r)}function rt(n,t,i,r,u){return u===undefined&&(u=1.70158),i*(n/=r)*n*((u+1)*n-u)+t}function ut(n,t,i,r,u){return u===undefined&&(u=1.70158),i*((n=n/r-1)*n*((u+1)*n+u)+1)+t}function ft(n,t,i,r,u){return u===undefined&&(u=1.70158),n/=r/2,n<1?i/2*n*n*(((u*=1.525)+1)*n-u)+t:i/2*((n-=2)*n*(((u*=1.525)+1)*n+u)+2)+t}function r(n,i,r,u){return r-t(u-n,0,r,u)+i}function t(n,t,i,r){return(n/=r)<1/2.75?i*7.5625*n*n+t:n<2/2.75?i*(7.5625*(n-=1.5/2.75)*n+.75)+t:n<2.5/2.75?i*(7.5625*(n-=2.25/2.75)*n+.9375)+t:i*(7.5625*(n-=2.625/2.75)*n+.984375)+t}function et(n,i,u,f){return n<f/2?r(n*2,0,u,f)*.5+i:t(n*2-f,0,u,f)*.5+u*.5+i}fabric.util.ease={easeInQuad:function(n,t,i,r){return i*(n/=r)*n+t},easeOutQuad:function(n,t,i,r){return-i*(n/=r)*(n-2)+t},easeInOutQuad:function(n,t,i,r){return n/=r/2,n<1?i/2*n*n+t:-i/2*(--n*(n-2)-1)+t},easeInCubic:function(n,t,i,r){return i*(n/=r)*n*n+t},easeOutCubic:u,easeInOutCubic:f,easeInQuart:e,easeOutQuart:o,easeInOutQuart:s,easeInQuint:h,easeOutQuint:c,easeInOutQuint:l,easeInSine:a,easeOutSine:v,easeInOutSine:y,easeInExpo:p,easeOutExpo:w,easeInOutExpo:b,easeInCirc:k,easeOutCirc:d,easeInOutCirc:g,easeInElastic:nt,easeOutElastic:tt,easeInOutElastic:it,easeInBack:rt,easeOutBack:ut,easeInOutBack:ft,easeInBounce:r,easeOutBounce:t,easeInOutBounce:et}}(),function(n){"use strict";function r(n){return n in l?l[n]:n}function u(n,r,u,f){var o=Object.prototype.toString.call(r)==="[object Array]",e;return n!=="fill"&&n!=="stroke"||r!=="none"?n==="strokeDashArray"?r=r.replace(/,/g," ").split(/\s+/).map(function(n){return parseFloat(n)}):n==="transformMatrix"?r=u&&u.transformMatrix?it(u.transformMatrix,t.parseTransformAttribute(r)):t.parseTransformAttribute(r):n==="visible"?(r=r==="none"||r==="hidden"?!1:!0,u&&u.visible===!1&&(r=!1)):n==="originX"?r=r==="start"?"left":r==="end"?"right":"center":e=o?r.map(i):i(r,f):r="",!o&&isNaN(e)?r:e}function a(n){var i,r;for(i in o)n[i]&&typeof n[o[i]]!="undefined"&&n[i].indexOf("url(")!==0&&(r=new t.Color(n[i]),n[i]=r.setAlpha(tt(r.getAlpha()*n[o[i]],2)).toRgba());return n}function v(n,t){var i,f;n.replace(/;$/,"").split(";").forEach(function(n){var e=n.split(":");i=r(e[0].trim().toLowerCase());f=u(i,e[1].trim());t[i]=f})}function y(n,t){var i,e;for(var f in n)typeof n[f]!="undefined"&&(i=r(f.toLowerCase()),e=u(i,n[f]),t[i]=e)}function p(n,i){var f={},r,u;for(r in t.cssRules[i])if(w(n,r.split(" ")))for(u in t.cssRules[i][r])f[u]=t.cssRules[i][r][u];return f}function w(n,t){var i,r=!0;return i=s(n,t.pop()),i&&t.length&&(r=b(n,t)),i&&r&&t.length===0}function b(n,t){for(var i,r=!0;n.parentNode&&n.parentNode.nodeType===1&&t.length;)r&&(i=t.pop()),n=n.parentNode,r=s(n,i);return t.length===0}function s(n,t){var e=n.nodeName,r=n.getAttribute("class"),f=n.getAttribute("id"),i,u;if(i=new RegExp("^"+e,"i"),t=t.replace(i,""),f&&t.length&&(i=new RegExp("#"+f+"(?![a-zA-Z\\-]+)","i"),t=t.replace(i,"")),r&&t.length)for(r=r.split(" "),u=r.length;u--;)i=new RegExp("\\."+r[u]+"(?![a-zA-Z\\-]+)","i"),t=t.replace(i,"");return t.length===0}function k(n){for(var e=n.getElementsByTagName("use"),t;e.length;){for(var i=e[0],h=i.getAttribute("xlink:href").substr(1),c=i.getAttribute("x")||0,l=i.getAttribute("y")||0,r=n.getElementById(h).cloneNode(!0),u=(r.getAttribute("transform")||"")+" translate("+c+", "+l+")",o,f=0,s=i.attributes,a=s.length;f<a;f++)(t=s.item(f),t.nodeName!=="x"&&t.nodeName!=="y"&&t.nodeName!=="xlink:href")&&(t.nodeName==="transform"?u=t.nodeValue+" "+u:r.setAttribute(t.nodeName,t.nodeValue));r.setAttribute("transform",u);r.setAttribute("instantiated_by_use","1");r.removeAttribute("id");o=i.parentNode;o.replaceChild(r,i)}}function h(n,i,r){var v=new RegExp("^\\s*("+t.reNum+"+)\\s*,?\\s*("+t.reNum+"+)\\s*,?\\s*("+t.reNum+"+)\\s*,?\\s*("+t.reNum+"+)\\s*$"),u=n.getAttribute("viewBox"),f=1,e=1,s=0,h=0,c,l,a,o;if(u&&(u=u.match(v))&&(s=-parseFloat(u[1]),h=-parseFloat(u[2]),c=parseFloat(u[3]),l=parseFloat(u[4]),i&&i!==c&&(f=i/c),r&&r!==l&&(e=r/l),e=f=f>e?e:f,f!==1||e!==1||s!==0||h!==0)){if(a="matrix("+f+" 0 0 "+e+" "+s*f+" "+h*e+")",n.tagName==="svg"){for(o=n.ownerDocument.createElement("g");n.firstChild!=null;)o.appendChild(n.firstChild);n.appendChild(o)}else o=n,a+=o.getAttribute("transform");o.setAttribute("transform",a)}}function d(n){var i=n.objects,r=n.options;return i=i.map(function(n){return t[g(n.type)].fromObject(n)}),{objects:i,options:r}}function c(n,t,i){t[i]&&t[i].toSVG&&n.push('<pattern x="0" y="0" id="',i,'Pattern" ','width="',t[i].source.width,'" height="',t[i].source.height,'" patternUnits="userSpaceOnUse">','<image x="0" y="0" ','width="',t[i].source.width,'" height="',t[i].source.height,'" xlink:href="',t[i].source.src,'"><\/image><\/pattern>')}var t=n.fabric||(n.fabric={}),f=t.util.object.extend,g=t.util.string.capitalize,nt=t.util.object.clone,tt=t.util.toFixed,i=t.util.parseUnit,it=t.util.multiplyTransformMatrices,l={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","stroke-dasharray":"strokeDashArray","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"originX"},o={stroke:"strokeOpacity",fill:"fillOpacity"},e;t.cssRules={};t.gradientDefs={};t.parseTransformAttribute=function(){function f(n,t){var i=t[0];n[0]=Math.cos(i);n[1]=Math.sin(i);n[2]=-Math.sin(i);n[3]=Math.cos(i)}function e(n,t){var i=t[0],r=t.length===2?t[1]:t[0];n[0]=i;n[3]=r}function o(n,i){n[2]=Math.tan(t.util.degreesToRadians(i[0]))}function s(n,i){n[1]=Math.tan(t.util.degreesToRadians(i[0]))}function h(n,t){n[4]=t[0];t.length===2&&(n[5]=t[1])}var u=[1,0,0,1,0,0],n=t.reNum,i="(?:\\s+,?\\s*|,\\s*)",c="(?:(skewX)\\s*\\(\\s*("+n+")\\s*\\))",l="(?:(skewY)\\s*\\(\\s*("+n+")\\s*\\))",a="(?:(rotate)\\s*\\(\\s*("+n+")(?:"+i+"("+n+")"+i+"("+n+"))?\\s*\\))",v="(?:(scale)\\s*\\(\\s*("+n+")(?:"+i+"("+n+"))?\\s*\\))",y="(?:(translate)\\s*\\(\\s*("+n+")(?:"+i+"("+n+"))?\\s*\\))",p="(?:(matrix)\\s*\\(\\s*("+n+")"+i+"("+n+")"+i+"("+n+")"+i+"("+n+")"+i+"("+n+")"+i+"("+n+")\\s*\\))",r="(?:"+p+"|"+y+"|"+v+"|"+a+"|"+c+"|"+l+")",w="(?:"+r+"(?:"+i+r+")*)",b="^\\s*(?:"+w+"?)\\s*$",k=new RegExp(b),d=new RegExp(r,"g");return function(n){var i=u.concat(),c=[],l;if(!n||n&&!k.test(n))return i;for(n.replace(d,function(n){var a=new RegExp(r).exec(n).filter(function(n){return n!==""&&n!=null}),v=a[1],l=a.slice(2).map(parseFloat);switch(v){case"translate":h(i,l);break;case"rotate":l[0]=t.util.degreesToRadians(l[0]);f(i,l);break;case"scale":e(i,l);break;case"skewX":o(i,l);break;case"skewY":s(i,l);break;case"matrix":i=l}c.push(i.concat());i=u.concat()}),l=c[0];c.length>1;)c.shift(),l=t.util.multiplyTransformMatrices(l,c[0]);return l}}();t.parseSVGDocument=function(){function n(n,t){while(n&&(n=n.parentNode))if(t.test(n.nodeName)&&!n.getAttribute("instantiated_by_use"))return!0;return!1}var r=/^(path|circle|polygon|polyline|ellipse|rect|line|image|text)$/,u=/^(symbol|image|marker|pattern|view)$/;return function(f,e,o){var s,p,c,b,l,w;if(f){k(f);var d=new Date,a=t.Object.__uid++,v=i(f.getAttribute("width")||"100%"),y=i(f.getAttribute("height")||"100%");if(h(f,v,y),s=t.util.toArray(f.getElementsByTagName("*")),s.length===0&&t.isLikelyNode){for(s=f.selectNodes('//*[name(.)!="svg"]'),p=[],c=0,b=s.length;c<b;c++)p[c]=s[c];s=p}if(l=s.filter(function(t){return u.test(t.tagName)&&h(t,0,0),r.test(t.tagName)&&!n(t,/^(?:pattern|defs|symbol)$/)}),!l||l&&!l.length){e&&e([],{});return}w={width:v,height:y,widthAttr:v,heightAttr:y,svgUid:a};t.gradientDefs[a]=t.getGradientDefs(f);t.cssRules[a]=t.getCSSRules(f);t.parseElements(l,function(n){t.documentParsingTime=new Date-d;e&&e(n,w)},nt(w),o)}}}();e={has:function(n,t){t(!1)},get:function(){},set:function(){}};f(t,{parseFontDeclaration:function(n,r){var c="(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+t.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+t.reNum+"))?\\s+(.*)",u=n.match(c);if(u){var o=u[1],f=u[3],s=u[4],e=u[5],h=u[6];o&&(r.fontStyle=o);f&&(r.fontWeight=isNaN(parseFloat(f))?f:parseFloat(f));s&&(r.fontSize=i(s));h&&(r.fontFamily=h);e&&(r.lineHeight=e==="normal"?1:e)}},getGradientDefs:function(n){var o=n.getElementsByTagName("linearGradient"),s=n.getElementsByTagName("radialGradient"),t,i,u=0,r,h,f=[],e={},c={},l;for(f.length=o.length+s.length,i=o.length;i--;)f[u++]=o[i];for(i=s.length;i--;)f[u++]=s[i];while(u--)t=f[u],h=t.getAttribute("xlink:href"),r=t.getAttribute("id"),h&&(c[r]=h.substr(1)),e[r]=t;for(r in c)for(l=e[c[r]].cloneNode(!0),t=e[r];l.firstChild;)t.appendChild(l.firstChild);return e},parseAttributes:function(n,i,e){var h,s,c,o;if(n)return s={},typeof e=="undefined"&&(e=n.getAttribute("svgUid")),n.parentNode&&/^symbol|[g|a]$/i.test(n.parentNode.nodeName)&&(s=t.parseAttributes(n.parentNode,i,e)),c=s&&s.fontSize||n.getAttribute("font-size")||t.Text.DEFAULT_SVG_FONT_SIZE,o=i.reduce(function(t,i){return h=n.getAttribute(i),h&&(i=r(i),h=u(i,h,s,c),t[i]=h),t},{}),o=f(o,f(p(n,e),t.parseStyleAttribute(n))),o.font&&t.parseFontDeclaration(o.font,o),a(f(s,o))},parseElements:function(n,i,r,u){new t.ElementsParser(n,i,r,u).parse()},parseStyleAttribute:function(n){var t={},i=n.getAttribute("style");return i?(typeof i=="string"?v(i,t):y(i,t),t):t},parsePointsAttribute:function(n){if(!n)return null;n=n.replace(/,/g," ").trim();n=n.split(/\s+/);for(var i=[],t=0,r=n.length;t<r;t+=2)i.push({x:parseFloat(n[t]),y:parseFloat(n[t+1])});return i},getCSSRules:function(n){for(var i,o=n.getElementsByTagName("style"),s={},f,e=0,h=o.length;e<h;e++)(i=o[e].textContent,i=i.replace(/\/\*[\s\S]*?\*\//g,""),i.trim()!=="")&&(f=i.match(/[^{]*\{[\s\S]*?\}/g),f=f.map(function(n){return n.trim()}),f.forEach(function(n){for(var e=n.match(/([\s\S]*?)\s*\{([^}]*)\}/),o={},l=e[2].trim(),h=l.replace(/;$/,"").split(/\s*;\s*/),i=0,a=h.length;i<a;i++){var f=h[i].split(/\s*:\s*/),c=r(f[0]),v=u(c,f[1],f[0]);o[c]=v}n=e[1];n.split(",").forEach(function(n){(n=n.replace(/^svg/i,"").trim(),n!=="")&&(s[n]=t.util.object.clone(o))})}));return s},loadSVGFromURL:function(n,i,r){function u(u){var f=u.responseXML;(f&&!f.documentElement&&t.window.ActiveXObject&&u.responseText&&(f=new ActiveXObject("Microsoft.XMLDOM"),f.async="false",f.loadXML(u.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,""))),f&&f.documentElement)&&t.parseSVGDocument(f.documentElement,function(r,u){e.set(n,{objects:t.util.array.invoke(r,"toObject"),options:u});i(r,u)},r)}n=n.replace(/^\n\s*/,"").trim();e.has(n,function(r){r?e.get(n,function(n){var t=d(n);i(t.objects,t.options)}):new t.util.request(n,{method:"get",onComplete:u})})},loadSVGFromString:function(n,i,r){var u,f;n=n.trim();typeof DOMParser!="undefined"?(f=new DOMParser,f&&f.parseFromString&&(u=f.parseFromString(n,"text/xml"))):t.window.ActiveXObject&&(u=new ActiveXObject("Microsoft.XMLDOM"),u.async="false",u.loadXML(n.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,"")));t.parseSVGDocument(u.documentElement,function(n,t){i(n,t)},r)},createSVGFontFacesMarkup:function(n){for(var i="",t=0,r=n.length;t<r;t++)n[t].type==="text"&&n[t].path&&(i+=["@font-face {","font-family: ",n[t].fontFamily,"; ","src: url('",n[t].path,"')","}"].join(""));return i&&(i=['<style type="text/css">',"<![CDATA[",i,"]\]>","<\/style>"].join("")),i},createSVGRefElementsMarkup:function(n){var t=[];return c(t,n,"backgroundColor"),c(t,n,"overlayColor"),t.join("")}})}(typeof exports!="undefined"?exports:undefined);fabric.ElementsParser=function(n,t,i,r){this.elements=n;this.callback=t;this.options=i;this.reviver=r;this.svgUid=i&&i.svgUid||0};fabric.ElementsParser.prototype.parse=function(){this.instances=new Array(this.elements.length);this.numElements=this.elements.length;this.createObjects()};fabric.ElementsParser.prototype.createObjects=function(){for(var n=0,t=this.elements.length;n<t;n++)this.elements[n].setAttribute("svgUid",this.svgUid),function(n,t){setTimeout(function(){n.createObject(n.elements[t],t)},0)}(this,n)};fabric.ElementsParser.prototype.createObject=function(n,t){var i=fabric[fabric.util.string.capitalize(n.tagName)];if(i&&i.fromElement)try{this._createObject(i,n,t)}catch(r){fabric.log(r)}else this.checkIfDone()};fabric.ElementsParser.prototype._createObject=function(n,t,i){if(n.async)n.fromElement(t,this.createCallback(i,t),this.options);else{var r=n.fromElement(t,this.options);this.resolveGradient(r,"fill");this.resolveGradient(r,"stroke");this.reviver&&this.reviver(t,r);this.instances[i]=r;this.checkIfDone()}};fabric.ElementsParser.prototype.createCallback=function(n,t){var i=this;return function(r){i.resolveGradient(r,"fill");i.resolveGradient(r,"stroke");i.reviver&&i.reviver(t,r);i.instances[n]=r;i.checkIfDone()}};fabric.ElementsParser.prototype.resolveGradient=function(n,t){var i=n.get(t),r;/^url\(/.test(i)&&(r=i.slice(5,i.length-1),fabric.gradientDefs[this.svgUid][r]&&n.set(t,fabric.Gradient.fromElement(fabric.gradientDefs[this.svgUid][r],n)))};fabric.ElementsParser.prototype.checkIfDone=function(){--this.numElements==0&&(this.instances=this.instances.filter(function(n){return n!=null}),this.callback(this.instances))},function(n){"use strict";function t(n,t){this.x=n;this.y=t}var i=n.fabric||(n.fabric={});if(i.Point){i.warn("fabric.Point is already defined");return}i.Point=t;t.prototype={constructor:t,add:function(n){return new t(this.x+n.x,this.y+n.y)},addEquals:function(n){return this.x+=n.x,this.y+=n.y,this},scalarAdd:function(n){return new t(this.x+n,this.y+n)},scalarAddEquals:function(n){return this.x+=n,this.y+=n,this},subtract:function(n){return new t(this.x-n.x,this.y-n.y)},subtractEquals:function(n){return this.x-=n.x,this.y-=n.y,this},scalarSubtract:function(n){return new t(this.x-n,this.y-n)},scalarSubtractEquals:function(n){return this.x-=n,this.y-=n,this},multiply:function(n){return new t(this.x*n,this.y*n)},multiplyEquals:function(n){return this.x*=n,this.y*=n,this},divide:function(n){return new t(this.x/n,this.y/n)},divideEquals:function(n){return this.x/=n,this.y/=n,this},eq:function(n){return this.x===n.x&&this.y===n.y},lt:function(n){return this.x<n.x&&this.y<n.y},lte:function(n){return this.x<=n.x&&this.y<=n.y},gt:function(n){return this.x>n.x&&this.y>n.y},gte:function(n){return this.x>=n.x&&this.y>=n.y},lerp:function(n,i){return new t(this.x+(n.x-this.x)*i,this.y+(n.y-this.y)*i)},distanceFrom:function(n){var t=this.x-n.x,i=this.y-n.y;return Math.sqrt(t*t+i*i)},midPointFrom:function(n){return new t(this.x+(n.x-this.x)/2,this.y+(n.y-this.y)/2)},min:function(n){return new t(Math.min(this.x,n.x),Math.min(this.y,n.y))},max:function(n){return new t(Math.max(this.x,n.x),Math.max(this.y,n.y))},toString:function(){return this.x+","+this.y},setXY:function(n,t){this.x=n;this.y=t},setFromPoint:function(n){this.x=n.x;this.y=n.y},swap:function(n){var t=this.x,i=this.y;this.x=n.x;this.y=n.y;n.x=t;n.y=i}}}(typeof exports!="undefined"?exports:undefined),function(n){"use strict";function t(n){this.status=n;this.points=[]}var i=n.fabric||(n.fabric={});if(i.Intersection){i.warn("fabric.Intersection is already defined");return}i.Intersection=t;i.Intersection.prototype={appendPoint:function(n){this.points.push(n)},appendPoints:function(n){this.points=this.points.concat(n)}};i.Intersection.intersectLineLine=function(n,r,u,f){var e,c=(f.x-u.x)*(n.y-u.y)-(f.y-u.y)*(n.x-u.x),l=(r.x-n.x)*(n.y-u.y)-(r.y-n.y)*(n.x-u.x),s=(f.y-u.y)*(r.x-n.x)-(f.x-u.x)*(r.y-n.y),o,h;return s!==0?(o=c/s,h=l/s,0<=o&&o<=1&&0<=h&&h<=1?(e=new t("Intersection"),e.points.push(new i.Point(n.x+o*(r.x-n.x),n.y+o*(r.y-n.y)))):e=new t):e=c===0||l===0?new t("Coincident"):new t("Parallel"),e};i.Intersection.intersectLinePolygon=function(n,i,r){for(var u=new t,e=r.length,f=0;f<e;f++){var o=r[f],s=r[(f+1)%e],h=t.intersectLineLine(n,i,o,s);u.appendPoints(h.points)}return u.points.length>0&&(u.status="Intersection"),u};i.Intersection.intersectPolygonPolygon=function(n,i){for(var r=new t,f=n.length,u=0;u<f;u++){var e=n[u],o=n[(u+1)%f],s=t.intersectLinePolygon(e,o,i);r.appendPoints(s.points)}return r.points.length>0&&(r.status="Intersection"),r};i.Intersection.intersectPolygonRectangle=function(n,r,u){var e=r.min(u),o=r.max(u),s=new i.Point(o.x,e.y),h=new i.Point(e.x,o.y),c=t.intersectLinePolygon(e,s,n),l=t.intersectLinePolygon(s,o,n),a=t.intersectLinePolygon(o,h,n),v=t.intersectLinePolygon(h,e,n),f=new t;return f.appendPoints(c.points),f.appendPoints(l.points),f.appendPoints(a.points),f.appendPoints(v.points),f.points.length>0&&(f.status="Intersection"),f}}(typeof exports!="undefined"?exports:undefined),function(n){"use strict";function t(n){n?this._tryParsingColor(n):this.setSource([0,0,0,1])}function r(n,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?n+(t-n)*6*i:i<.5?t:i<2/3?n+(t-n)*(2/3-i)*6:n}var i=n.fabric||(n.fabric={});if(i.Color){i.warn("fabric.Color is already defined.");return}i.Color=t;i.Color.prototype={_tryParsingColor:function(n){var i;if(n in t.colorNameMap&&(n=t.colorNameMap[n]),n==="transparent"){this.setSource([255,255,255,0]);return}i=t.sourceFromHex(n);i||(i=t.sourceFromRgb(n));i||(i=t.sourceFromHsl(n));i&&this.setSource(i)},_rgbToHsl:function(n,t,r){var f,s,h,u,e,o;if(n/=255,t/=255,r/=255,u=i.util.array.max([n,t,r]),e=i.util.array.min([n,t,r]),h=(u+e)/2,u===e)f=s=0;else{o=u-e;s=h>.5?o/(2-u-e):o/(u+e);switch(u){case n:f=(t-r)/o+(t<r?6:0);break;case t:f=(r-n)/o+2;break;case r:f=(n-t)/o+4}f/=6}return[Math.round(f*360),Math.round(s*100),Math.round(h*100)]},getSource:function(){return this._source},setSource:function(n){this._source=n},toRgb:function(){var n=this.getSource();return"rgb("+n[0]+","+n[1]+","+n[2]+")"},toRgba:function(){var n=this.getSource();return"rgba("+n[0]+","+n[1]+","+n[2]+","+n[3]+")"},toHsl:function(){var n=this.getSource(),t=this._rgbToHsl(n[0],n[1],n[2]);return"hsl("+t[0]+","+t[1]+"%,"+t[2]+"%)"},toHsla:function(){var n=this.getSource(),t=this._rgbToHsl(n[0],n[1],n[2]);return"hsla("+t[0]+","+t[1]+"%,"+t[2]+"%,"+n[3]+")"},toHex:function(){var r=this.getSource(),n,t,i;return n=r[0].toString(16),n=n.length===1?"0"+n:n,t=r[1].toString(16),t=t.length===1?"0"+t:t,i=r[2].toString(16),i=i.length===1?"0"+i:i,n.toUpperCase()+t.toUpperCase()+i.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(n){var t=this.getSource();return t[3]=n,this.setSource(t),this},toGrayscale:function(){var n=this.getSource(),t=parseInt((n[0]*.3+n[1]*.59+n[2]*.11).toFixed(0),10),i=n[3];return this.setSource([t,t,t,i]),this},toBlackWhite:function(n){var i=this.getSource(),t=(i[0]*.3+i[1]*.59+i[2]*.11).toFixed(0),r=i[3];return n=n||127,t=Number(t)<Number(n)?0:255,this.setSource([t,t,t,r]),this},overlayWith:function(n){var i;n instanceof t||(n=new t(n));var r=[],f=this.getAlpha(),u=.5,e=this.getSource(),o=n.getSource();for(i=0;i<3;i++)r.push(Math.round(e[i]*(1-u)+o[i]*u));return r[3]=f,this.setSource(r),this}};i.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/;i.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/;i.Color.reHex=/^#?([0-9a-f]{6}|[0-9a-f]{3})$/i;i.Color.colorNameMap={aqua:"#00FFFF",black:"#000000",blue:"#0000FF",fuchsia:"#FF00FF",gray:"#808080",green:"#008000",lime:"#00FF00",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#FFA500",purple:"#800080",red:"#FF0000",silver:"#C0C0C0",teal:"#008080",white:"#FFFFFF",yellow:"#FFFF00"};i.Color.fromRgb=function(n){return t.fromSource(t.sourceFromRgb(n))};i.Color.sourceFromRgb=function(n){var i=n.match(t.reRGBa);if(i){var r=parseInt(i[1],10)/(/%$/.test(i[1])?100:1)*(/%$/.test(i[1])?255:1),u=parseInt(i[2],10)/(/%$/.test(i[2])?100:1)*(/%$/.test(i[2])?255:1),f=parseInt(i[3],10)/(/%$/.test(i[3])?100:1)*(/%$/.test(i[3])?255:1);return[parseInt(r,10),parseInt(u,10),parseInt(f,10),i[4]?parseFloat(i[4]):1]}};i.Color.fromRgba=t.fromRgb;i.Color.fromHsl=function(n){return t.fromSource(t.sourceFromHsl(n))};i.Color.sourceFromHsl=function(n){var i=n.match(t.reHSLa),f,o;if(i){var s=(parseFloat(i[1])%360+360)%360/360,e=parseFloat(i[2])/(/%$/.test(i[2])?100:1),u=parseFloat(i[3])/(/%$/.test(i[3])?100:1),h,c,l;return e===0?h=c=l=u:(f=u<=.5?u*(e+1):u+e-u*e,o=u*2-f,h=r(o,f,s+1/3),c=r(o,f,s),l=r(o,f,s-1/3)),[Math.round(h*255),Math.round(c*255),Math.round(l*255),i[4]?parseFloat(i[4]):1]}};i.Color.fromHsla=t.fromHsl;i.Color.fromHex=function(n){return t.fromSource(t.sourceFromHex(n))};i.Color.sourceFromHex=function(n){if(n.match(t.reHex)){var i=n.slice(n.indexOf("#")+1),r=i.length===3,u=r?i.charAt(0)+i.charAt(0):i.substring(0,2),f=r?i.charAt(1)+i.charAt(1):i.substring(2,4),e=r?i.charAt(2)+i.charAt(2):i.substring(4,6);return[parseInt(u,16),parseInt(f,16),parseInt(e,16),1]}};i.Color.fromSource=function(n){var i=new t;return i.setSource(n),i}}(typeof exports!="undefined"?exports:undefined),function(){function t(n){var e=n.getAttribute("style"),t=n.getAttribute("offset"),r,o,i,u,f;if(t=parseFloat(t)/(/%$/.test(t)?100:1),t=t<0?0:t>1?1:t,e)for(u=e.split(/\s*;\s*/),u[u.length-1]===""&&u.pop(),f=u.length;f--;){var s=u[f].split(/\s*:\s*/),h=s[0].trim(),c=s[1].trim();h==="stop-color"?r=c:h==="stop-opacity"&&(i=c)}return r||(r=n.getAttribute("stop-color")||"rgb(0,0,0)"),i||(i=n.getAttribute("stop-opacity")),r=new fabric.Color(r),o=r.getAlpha(),i=isNaN(parseFloat(i))?1:parseFloat(i),i*=o,{offset:t,color:r.toRgb(),opacity:i}}function i(n){return{x1:n.getAttribute("x1")||0,y1:n.getAttribute("y1")||0,x2:n.getAttribute("x2")||"100%",y2:n.getAttribute("y2")||0}}function r(n){return{x1:n.getAttribute("fx")||n.getAttribute("cx")||"50%",y1:n.getAttribute("fy")||n.getAttribute("cy")||"50%",r1:0,x2:n.getAttribute("cx")||"50%",y2:n.getAttribute("cy")||"50%",r2:n.getAttribute("r")||"50%"}}function n(n,t,i){var o,e=0,u=1,s="",r,f;for(r in t)o=parseFloat(t[r],10),u=typeof t[r]=="string"&&/^\d+%$/.test(t[r])?.01:1,r==="x1"||r==="x2"||r==="r2"?(u*=i==="objectBoundingBox"?n.width:1,e=i==="objectBoundingBox"?n.left||0:0):(r==="y1"||r==="y2")&&(u*=i==="objectBoundingBox"?n.height:1,e=i==="objectBoundingBox"?n.top||0:0),t[r]=o*u+e;return n.type==="ellipse"&&t.r2!==null&&i==="objectBoundingBox"&&n.rx!==n.ry&&(f=n.ry/n.rx,s=" scale(1, "+f+")",t.y1&&(t.y1/=f),t.y2&&(t.y2/=f)),s}fabric.Gradient=fabric.util.createClass({offsetX:0,offsetY:0,initialize:function(n){n||(n={});var t={};this.id=fabric.Object.__uid++;this.type=n.type||"linear";t={x1:n.coords.x1||0,y1:n.coords.y1||0,x2:n.coords.x2||0,y2:n.coords.y2||0};this.type==="radial"&&(t.r1=n.coords.r1||0,t.r2=n.coords.r2||0);this.coords=t;this.colorStops=n.colorStops.slice();n.gradientTransform&&(this.gradientTransform=n.gradientTransform);this.offsetX=n.offsetX||this.offsetX;this.offsetY=n.offsetY||this.offsetY},addColorStop:function(n){var t,i;for(t in n)i=new fabric.Color(n[t]),this.colorStops.push({offset:t,color:i.toRgb(),opacity:i.getAlpha()});return this},toObject:function(){return{type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY}},toSVG:function(n){var t=fabric.util.object.clone(this.coords),u,f,i,r;if(this.colorStops.sort(function(n,t){return n.offset-t.offset}),!n.group||n.group.type!=="path-group")for(i in t)i==="x1"||i==="x2"||i==="r2"?t[i]+=this.offsetX-n.width/2:(i==="y1"||i==="y2")&&(t[i]+=this.offsetY-n.height/2);for(f='id="SVGID_'+this.id+'" gradientUnits="userSpaceOnUse"',this.gradientTransform&&(f+=' gradientTransform="matrix('+this.gradientTransform.join(" ")+')" '),this.type==="linear"?u=["<linearGradient ",f,' x1="',t.x1,'" y1="',t.y1,'" x2="',t.x2,'" y2="',t.y2,'">\n']:this.type==="radial"&&(u=["<radialGradient ",f,' cx="',t.x2,'" cy="',t.y2,'" r="',t.r2,'" fx="',t.x1,'" fy="',t.y1,'">\n']),r=0;r<this.colorStops.length;r++)u.push("<stop ",'offset="',this.colorStops[r].offset*100+"%",'" style="stop-color:',this.colorStops[r].color,this.colorStops[r].opacity!=null?";stop-opacity: "+this.colorStops[r].opacity:";",'"/>\n');return u.push(this.type==="linear"?"<\/linearGradient>\n":"<\/radialGradient>\n"),u.join("")},toLive:function(n,t){var f,i=fabric.util.object.clone(this.coords),r,u,o;if(this.type){if(t.group&&t.group.type==="path-group")for(r in i)r==="x1"||r==="x2"?i[r]+=-this.offsetX+t.width/2:(r==="y1"||r==="y2")&&(i[r]+=-this.offsetY+t.height/2);for(this.type==="linear"?f=n.createLinearGradient(i.x1,i.y1,i.x2,i.y2):this.type==="radial"&&(f=n.createRadialGradient(i.x1,i.y1,i.r1,i.x2,i.y2,i.r2)),u=0,o=this.colorStops.length;u<o;u++){var e=this.colorStops[u].color,s=this.colorStops[u].opacity,h=this.colorStops[u].offset;typeof s!="undefined"&&(e=new fabric.Color(e).setAlpha(s).toRgba());f.addColorStop(parseFloat(h),e)}return f}}});fabric.util.object.extend(fabric.Gradient,{fromElement:function(u,f){var l=u.getElementsByTagName("stop"),o=u.nodeName==="linearGradient"?"linear":"radial",y=u.getAttribute("gradientUnits")||"objectBoundingBox",a=u.getAttribute("gradientTransform"),v=[],e={},s,h,c;for(o==="linear"?e=i(u):o==="radial"&&(e=r(u)),h=l.length;h--;)v.push(t(l[h]));return s=n(f,e,y),c=new fabric.Gradient({type:o,coords:e,colorStops:v,offsetX:-f.left,offsetY:-f.top}),(a||s!=="")&&(c.gradientTransform=fabric.parseTransformAttribute((a||"")+s)),c},forObject:function(t,i){return i||(i={}),n(t,i.coords,"userSpaceOnUse"),new fabric.Gradient(i)}})}();fabric.Pattern=fabric.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,initialize:function(n){if(n||(n={}),this.id=fabric.Object.__uid++,n.source)if(typeof n.source=="string")if(typeof fabric.util.getFunctionBody(n.source)!="undefined")this.source=new Function(fabric.util.getFunctionBody(n.source));else{var t=this;this.source=fabric.util.createImage();fabric.util.loadImage(n.source,function(n){t.source=n})}else this.source=n.source;n.repeat&&(this.repeat=n.repeat);n.offsetX&&(this.offsetX=n.offsetX);n.offsetY&&(this.offsetY=n.offsetY)},toObject:function(){var n;return typeof this.source=="function"?n=String(this.source):typeof this.source.src=="string"&&(n=this.source.src),{source:n,repeat:this.repeat,offsetX:this.offsetX,offsetY:this.offsetY}},toSVG:function(n){var t=typeof this.source=="function"?this.source():this.source,r=t.width/n.getWidth(),u=t.height/n.getHeight(),f=this.offsetX/n.getWidth(),e=this.offsetY/n.getHeight(),i="";return(this.repeat==="repeat-x"||this.repeat==="no-repeat")&&(u=1),(this.repeat==="repeat-y"||this.repeat==="no-repeat")&&(r=1),t.src?i=t.src:t.toDataURL&&(i=t.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+f+'" y="'+e+'" width="'+r+'" height="'+u+'">\n<image x="0" y="0" width="'+t.width+'" height="'+t.height+'" xlink:href="'+i+'"><\/image>\n<\/pattern>\n'},toLive:function(n){var t=typeof this.source=="function"?this.source():this.source;return t?typeof t.src!="undefined"&&(!t.complete||t.naturalWidth===0||t.naturalHeight===0)?"":n.createPattern(t,this.repeat):""}}),function(n){"use strict";var t=n.fabric||(n.fabric={});if(t.Shadow){t.warn("fabric.Shadow is already defined.");return}t.Shadow=t.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,initialize:function(n){typeof n=="string"&&(n=this._parseShadow(n));for(var i in n)this[i]=n[i];this.id=t.Object.__uid++},_parseShadow:function(n){var r=n.trim(),i=t.Shadow.reOffsetsAndBlur.exec(r)||[],u=r.replace(t.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)";return{color:u.trim(),offsetX:parseInt(i[1],10)||0,offsetY:parseInt(i[2],10)||0,blur:parseInt(i[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(n){var r="SourceAlpha",t=40,i=40;return n&&(n.fill===this.color||n.stroke===this.color)&&(r="SourceGraphic"),n.width&&n.height&&(t=Math.abs(this.offsetX/n.getWidth())*100+20,i=Math.abs(this.offsetY/n.getHeight())*100+20),'<filter id="SVGID_'+this.id+'" y="-'+i+'%" height="'+(100+2*i)+'%" x="-'+t+'%" width="'+(100+2*t)+'%" >\n\t<feGaussianBlur in="'+r+'" stdDeviation="'+(this.blur?this.blur/3:0)+'"><\/feGaussianBlur>\n\t<feOffset dx="'+this.offsetX+'" dy="'+this.offsetY+'"><\/feOffset>\n\t<feMerge>\n\t\t<feMergeNode><\/feMergeNode>\n\t\t<feMergeNode in="SourceGraphic"><\/feMergeNode>\n\t<\/feMerge>\n<\/filter>\n'},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY};var n={},i=t.Shadow.prototype;return this.color!==i.color&&(n.color=this.color),this.blur!==i.blur&&(n.blur=this.blur),this.offsetX!==i.offsetX&&(n.offsetX=this.offsetX),this.offsetY!==i.offsetY&&(n.offsetY=this.offsetY),n}});t.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:px)?(?:\s?|$))?(-?\d+(?:px)?(?:\s?|$))?(\d+(?:px)?)?(?:\s?|$)(?:$|\s)/}(typeof exports!="undefined"?exports:undefined),function(){"use strict";if(fabric.StaticCanvas){fabric.warn("fabric.StaticCanvas is already defined.");return}var n=fabric.util.object.extend,r=fabric.util.getElementOffset,t=fabric.util.removeFromArray,i=new Error("Could not initialize `canvas` element");fabric.StaticCanvas=fabric.util.createClass({initialize:function(n,t){t||(t={});this._initStatic(n,t);fabric.StaticCanvas.activeInstance=this},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!0,renderOnAddRemove:!0,clipTo:null,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,preserveObjectStacking:!1,viewportTransform:[1,0,0,1,0,0],onBeforeScaleRotate:function(){},_initStatic:function(n,t){this._objects=[];this._createLowerCanvas(n);this._initOptions(t);this._setImageSmoothing();t.overlayImage&&this.setOverlayImage(t.overlayImage,this.renderAll.bind(this));t.backgroundImage&&this.setBackgroundImage(t.backgroundImage,this.renderAll.bind(this));t.backgroundColor&&this.setBackgroundColor(t.backgroundColor,this.renderAll.bind(this));t.overlayColor&&this.setOverlayColor(t.overlayColor,this.renderAll.bind(this));this.calcOffset()},calcOffset:function(){return this._offset=r(this.lowerCanvasEl),this},setOverlayImage:function(n,t,i){return this.__setBgOverlayImage("overlayImage",n,t,i)},setBackgroundImage:function(n,t,i){return this.__setBgOverlayImage("backgroundImage",n,t,i)},setOverlayColor:function(n,t){return this.__setBgOverlayColor("overlayColor",n,t)},setBackgroundColor:function(n,t){return this.__setBgOverlayColor("backgroundColor",n,t)},_setImageSmoothing:function(){var n=this.getContext();n.imageSmoothingEnabled=this.imageSmoothingEnabled;n.webkitImageSmoothingEnabled=this.imageSmoothingEnabled;n.mozImageSmoothingEnabled=this.imageSmoothingEnabled;n.msImageSmoothingEnabled=this.imageSmoothingEnabled;n.oImageSmoothingEnabled=this.imageSmoothingEnabled},__setBgOverlayImage:function(n,t,i,r){return typeof t=="string"?fabric.util.loadImage(t,function(t){this[n]=new fabric.Image(t,r);i&&i()},this,r&&r.crossOrigin):(this[n]=t,i&&i()),this},__setBgOverlayColor:function(n,t,i){if(t&&t.source){var r=this;fabric.util.loadImage(t.source,function(u){r[n]=new fabric.Pattern({source:u,repeat:t.repeat,offsetX:t.offsetX,offsetY:t.offsetY});i&&i()})}else this[n]=t,i&&i();return this},_createCanvasElement:function(){var n=fabric.document.createElement("canvas");if(n.style||(n.style={}),!n)throw i;return this._initCanvasElement(n),n},_initCanvasElement:function(n){if(fabric.util.createCanvasElement(n),typeof n.getContext=="undefined")throw i;},_initOptions:function(n){for(var t in n)this[t]=n[t];(this.width=this.width||parseInt(this.lowerCanvasEl.width,10)||0,this.height=this.height||parseInt(this.lowerCanvasEl.height,10)||0,this.lowerCanvasEl.style)&&(this.lowerCanvasEl.width=this.width,this.lowerCanvasEl.height=this.height,this.lowerCanvasEl.style.width=this.width+"px",this.lowerCanvasEl.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(n){this.lowerCanvasEl=fabric.util.getById(n)||this._createCanvasElement();this._initCanvasElement(this.lowerCanvasEl);fabric.util.addClass(this.lowerCanvasEl,"lower-canvas");this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl);this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(n,t){return this.setDimensions({width:n},t)},setHeight:function(n,t){return this.setDimensions({height:n},t)},setDimensions:function(n,t){var r,i;t=t||{};for(i in n)r=n[i],t.cssOnly||(this._setBackstoreDimension(i,n[i]),r+="px"),t.backstoreOnly||this._setCssDimension(i,r);return t.cssOnly||this.renderAll(),this.calcOffset(),this},_setBackstoreDimension:function(n,t){return this.lowerCanvasEl[n]=t,this.upperCanvasEl&&(this.upperCanvasEl[n]=t),this.cacheCanvasEl&&(this.cacheCanvasEl[n]=t),this[n]=t,this},_setCssDimension:function(n,t){return this.lowerCanvasEl.style[n]=t,this.upperCanvasEl&&(this.upperCanvasEl.style[n]=t),this.wrapperEl&&(this.wrapperEl.style[n]=t),this},getZoom:function(){return Math.sqrt(this.viewportTransform[0]*this.viewportTransform[3])},setViewportTransform:function(n){this.viewportTransform=n;this.renderAll();for(var t=0,i=this._objects.length;t<i;t++)this._objects[t].setCoords();return this},zoomToPoint:function(n,t){var u=n,r,i,f;for(n=fabric.util.transformPoint(n,fabric.util.invertTransform(this.viewportTransform)),this.viewportTransform[0]=t,this.viewportTransform[3]=t,r=fabric.util.transformPoint(n,this.viewportTransform),this.viewportTransform[4]+=u.x-r.x,this.viewportTransform[5]+=u.y-r.y,this.renderAll(),i=0,f=this._objects.length;i<f;i++)this._objects[i].setCoords();return this},setZoom:function(n){return this.zoomToPoint(new fabric.Point(0,0),n),this},absolutePan:function(n){this.viewportTransform[4]=-n.x;this.viewportTransform[5]=-n.y;this.renderAll();for(var t=0,i=this._objects.length;t<i;t++)this._objects[t].setCoords();return this},relativePan:function(n){return this.absolutePan(new fabric.Point(-n.x-this.viewportTransform[4],-n.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},getActiveObject:function(){return null},getActiveGroup:function(){return null},_draw:function(n,t){if(t){n.save();var i=this.viewportTransform;n.transform(i[0],i[1],i[2],i[3],i[4],i[5]);this._shouldRenderObject(t)&&t.render(n);n.restore();this.controlsAboveOverlay||t._renderControls(n)}},_shouldRenderObject:function(n){return n?n!==this.getActiveGroup()||!this.preserveObjectStacking:!1},_onObjectAdded:function(n){this.stateful&&n.setupState();n.canvas=this;n.setCoords();this.fire("object:added",{target:n});n.fire("added")},_onObjectRemoved:function(n){this.getActiveObject()===n&&(this.fire("before:selection:cleared",{target:n}),this._discardActiveObject(),this.fire("selection:cleared"));this.fire("object:removed",{target:n});n.fire("removed")},clearContext:function(n){return n.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this._objects.length=0,this.discardActiveGroup&&this.discardActiveGroup(),this.discardActiveObject&&this.discardActiveObject(),this.clearContext(this.contextContainer),this.contextTop&&this.clearContext(this.contextTop),this.fire("canvas:cleared"),this.renderAll(),this},renderAll:function(n){var t=this[n===!0&&this.interactive?"contextTop":"contextContainer"],i=this.getActiveGroup();return this.contextTop&&this.selection&&!this._groupSelector&&this.clearContext(this.contextTop),n||this.clearContext(t),this.fire("before:render"),this.clipTo&&fabric.util.clipContext(this,t),this._renderBackground(t),this._renderObjects(t,i),this._renderActiveGroup(t,i),this.clipTo&&t.restore(),this._renderOverlay(t),this.controlsAboveOverlay&&this.interactive&&this.drawControls(t),this.fire("after:render"),this},_renderObjects:function(n,t){var i,r;if(!t||this.preserveObjectStacking)for(i=0,r=this._objects.length;i<r;++i)this._draw(n,this._objects[i]);else for(i=0,r=this._objects.length;i<r;++i)this._objects[i]&&!t.contains(this._objects[i])&&this._draw(n,this._objects[i])},_renderActiveGroup:function(n,t){if(t){var i=[];this.forEachObject(function(n){t.contains(n)&&i.push(n)});t._set("objects",i);this._draw(n,t)}},_renderBackground:function(n){this.backgroundColor&&(n.fillStyle=this.backgroundColor.toLive?this.backgroundColor.toLive(n):this.backgroundColor,n.fillRect(this.backgroundColor.offsetX||0,this.backgroundColor.offsetY||0,this.width,this.height));this.backgroundImage&&this._draw(n,this.backgroundImage)},_renderOverlay:function(n){this.overlayColor&&(n.fillStyle=this.overlayColor.toLive?this.overlayColor.toLive(n):this.overlayColor,n.fillRect(this.overlayColor.offsetX||0,this.overlayColor.offsetY||0,this.width,this.height));this.overlayImage&&this._draw(n,this.overlayImage)},renderTop:function(){var n=this.contextTop||this.contextContainer,t;return this.clearContext(n),this.selection&&this._groupSelector&&this._drawSelection(),t=this.getActiveGroup(),t&&t.render(n),this._renderOverlay(n),this.fire("after:render"),this},getCenter:function(){return{top:this.getHeight()/2,left:this.getWidth()/2}},centerObjectH:function(n){return this._centerObject(n,new fabric.Point(this.getCenter().left,n.getCenterPoint().y)),this.renderAll(),this},centerObjectV:function(n){return this._centerObject(n,new fabric.Point(n.getCenterPoint().x,this.getCenter().top)),this.renderAll(),this},centerObject:function(n){var t=this.getCenter();return this._centerObject(n,new fabric.Point(t.left,t.top)),this.renderAll(),this},_centerObject:function(n,t){return n.setPositionByOrigin(t,"center","center"),this},toDatalessJSON:function(n){return this.toDatalessObject(n)},toObject:function(n){return this._toObjectMethod("toObject",n)},toDatalessObject:function(n){return this._toObjectMethod("toDatalessObject",n)},_toObjectMethod:function(t,i){var r=this.getActiveGroup(),u;return r&&this.discardActiveGroup(),u={objects:this._toObjects(t,i)},n(u,this.__serializeBgOverlay()),fabric.util.populateWithProperties(this,u,i),r&&(this.setActiveGroup(new fabric.Group(r.getObjects(),{originX:"center",originY:"center"})),r.forEachObject(function(n){n.set("active",!0)}),this._currentTransform&&(this._currentTransform.target=this.getActiveGroup())),u},_toObjects:function(n,t){return this.getObjects().map(function(i){return this._toObject(i,n,t)},this)},_toObject:function(n,t,i){var r,u;return this.includeDefaultValues||(r=n.includeDefaultValues,n.includeDefaultValues=!1),u=n[t](i),this.includeDefaultValues||(n.includeDefaultValues=r),u},__serializeBgOverlay:function(){var n={background:this.backgroundColor&&this.backgroundColor.toObject?this.backgroundColor.toObject():this.backgroundColor};return this.overlayColor&&(n.overlay=this.overlayColor.toObject?this.overlayColor.toObject():this.overlayColor),this.backgroundImage&&(n.backgroundImage=this.backgroundImage.toObject()),this.overlayImage&&(n.overlayImage=this.overlayImage.toObject()),n},svgViewportTransformation:!0,toSVG:function(n,t){n||(n={});var i=[];return this._setSVGPreamble(i,n),this._setSVGHeader(i,n),this._setSVGBgOverlayColor(i,"backgroundColor"),this._setSVGBgOverlayImage(i,"backgroundImage"),this._setSVGObjects(i,t),this._setSVGBgOverlayColor(i,"overlayColor"),this._setSVGBgOverlayImage(i,"overlayImage"),i.push("<\/svg>"),i.join("")},_setSVGPreamble:function(n,t){t.suppressPreamble||n.push('<?xml version="1.0" encoding="',t.encoding||"UTF-8",'" standalone="no" ?>','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},_setSVGHeader:function(n,t){var i,r,u;t.viewBox?(i=t.viewBox.width,r=t.viewBox.height):(i=this.width,r=this.height,this.svgViewportTransformation||(u=this.viewportTransform,i/=u[0],r/=u[3]));n.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',i,'" ','height="',r,'" ',this.backgroundColor&&!this.backgroundColor.toLive?'style="background-color: '+this.backgroundColor+'" ':null,t.viewBox?'viewBox="'+t.viewBox.x+" "+t.viewBox.y+" "+t.viewBox.width+" "+t.viewBox.height+'" ':null,'xml:space="preserve">',"<desc>Created with Fabric.js ",fabric.version,"<\/desc>","<defs>",fabric.createSVGFontFacesMarkup(this.getObjects()),fabric.createSVGRefElementsMarkup(this),"<\/defs>")},_setSVGObjects:function(n,t){var i=this.getActiveGroup();i&&this.discardActiveGroup();for(var r=0,u=this.getObjects(),f=u.length;r<f;r++)n.push(u[r].toSVG(t));i&&(this.setActiveGroup(new fabric.Group(i.getObjects())),i.forEachObject(function(n){n.set("active",!0)}))},_setSVGBgOverlayImage:function(n,t){this[t]&&this[t].toSVG&&n.push(this[t].toSVG())},_setSVGBgOverlayColor:function(n,t){this[t]&&this[t].source?n.push('<rect x="',this[t].offsetX,'" y="',this[t].offsetY,'" ','width="',this[t].repeat==="repeat-y"||this[t].repeat==="no-repeat"?this[t].source.width:this.width,'" height="',this[t].repeat==="repeat-x"||this[t].repeat==="no-repeat"?this[t].source.height:this.height,'" fill="url(#'+t+'Pattern)"',"><\/rect>"):this[t]&&t==="overlayColor"&&n.push('<rect x="0" y="0" ','width="',this.width,'" height="',this.height,'" fill="',this[t],'"',"><\/rect>")},sendToBack:function(n){return t(this._objects,n),this._objects.unshift(n),this.renderAll&&this.renderAll()},bringToFront:function(n){return t(this._objects,n),this._objects.push(n),this.renderAll&&this.renderAll()},sendBackwards:function(n,i){var r=this._objects.indexOf(n),u;return r!==0&&(u=this._findNewLowerIndex(n,r,i),t(this._objects,n),this._objects.splice(u,0,n),this.renderAll&&this.renderAll()),this},_findNewLowerIndex:function(n,t,i){var u,r,f;if(i){for(u=t,r=t-1;r>=0;--r)if(f=n.intersectsWithObject(this._objects[r])||n.isContainedWithinObject(this._objects[r])||this._objects[r].isContainedWithinObject(n),f){u=r;break}}else u=t-1;return u},bringForward:function(n,i){var r=this._objects.indexOf(n),u;return r!==this._objects.length-1&&(u=this._findNewUpperIndex(n,r,i),t(this._objects,n),this._objects.splice(u,0,n),this.renderAll&&this.renderAll()),this},_findNewUpperIndex:function(n,t,i){var u,r,f;if(i){for(u=t,r=t+1;r<this._objects.length;++r)if(f=n.intersectsWithObject(this._objects[r])||n.isContainedWithinObject(this._objects[r])||this._objects[r].isContainedWithinObject(n),f){u=r;break}}else u=t+1;return u},moveTo:function(n,i){return t(this._objects,n),this._objects.splice(i,0,n),this.renderAll&&this.renderAll()},dispose:function(){return this.clear(),this.interactive&&this.removeListeners(),this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this.getObjects().length+" }>"}});n(fabric.StaticCanvas.prototype,fabric.Observable);n(fabric.StaticCanvas.prototype,fabric.Collection);n(fabric.StaticCanvas.prototype,fabric.DataURLExporter);n(fabric.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(n){var t=fabric.util.createCanvasElement(),i;if(!t||!t.getContext||(i=t.getContext("2d"),!i))return null;switch(n){case"getImageData":return typeof i.getImageData!="undefined";case"setLineDash":return typeof i.setLineDash!="undefined";case"toDataURL":return typeof t.toDataURL!="undefined";case"toDataURLWithQuality":try{return t.toDataURL("image/jpeg",0),!0}catch(r){}return!1;default:return null}}});fabric.StaticCanvas.prototype.toJSON=fabric.StaticCanvas.prototype.toObject}();fabric.BaseBrush=fabric.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",setShadow:function(n){return this.shadow=new fabric.Shadow(n),this},_setBrushStyles:function(){var n=this.canvas.contextTop;n.strokeStyle=this.color;n.lineWidth=this.width;n.lineCap=this.strokeLineCap;n.lineJoin=this.strokeLineJoin},_setShadow:function(){if(this.shadow){var n=this.canvas.contextTop;n.shadowColor=this.shadow.color;n.shadowBlur=this.shadow.blur;n.shadowOffsetX=this.shadow.offsetX;n.shadowOffsetY=this.shadow.offsetY}},_resetShadow:function(){var n=this.canvas.contextTop;n.shadowColor="";n.shadowBlur=n.shadowOffsetX=n.shadowOffsetY=0}}),function(){fabric.PencilBrush=fabric.util.createClass(fabric.BaseBrush,{initialize:function(n){this.canvas=n;this._points=[]},onMouseDown:function(n){this._prepareForDrawing(n);this._captureDrawingPath(n);this._render()},onMouseMove:function(n){this._captureDrawingPath(n);this.canvas.clearContext(this.canvas.contextTop);this._render()},onMouseUp:function(){this._finalizeAndAddPath()},_prepareForDrawing:function(n){var t=new fabric.Point(n.x,n.y);this._reset();this._addPoint(t);this.canvas.contextTop.moveTo(t.x,t.y)},_addPoint:function(n){this._points.push(n)},_reset:function(){this._points.length=0;this._setBrushStyles();this._setShadow()},_captureDrawingPath:function(n){var t=new fabric.Point(n.x,n.y);this._addPoint(t)},_render:function(){var t=this.canvas.contextTop,i=this.canvas.viewportTransform,n=this._points[0],r=this._points[1],u,e,f;for(t.save(),t.transform(i[0],i[1],i[2],i[3],i[4],i[5]),t.beginPath(),this._points.length===2&&n.x===r.x&&n.y===r.y&&(n.x-=.5,r.x+=.5),t.moveTo(n.x,n.y),u=1,e=this._points.length;u<e;u++)f=n.midPointFrom(r),t.quadraticCurveTo(n.x,n.y,f.x,f.y),n=this._points[u],r=this._points[u+1];t.lineTo(n.x,n.y);t.stroke();t.restore()},convertPointsToSVGPath:function(n){var r=[],i=new fabric.Point(n[0].x,n[0].y),f=new fabric.Point(n[1].x,n[1].y),t,e,u;for(r.push("M ",n[0].x," ",n[0].y," "),t=1,e=n.length;t<e;t++)u=i.midPointFrom(f),r.push("Q ",i.x," ",i.y," ",u.x," ",u.y," "),i=new fabric.Point(n[t].x,n[t].y),t+1<n.length&&(f=new fabric.Point(n[t+1].x,n[t+1].y));return r.push("L ",i.x," ",i.y," "),r},createPath:function(n){var t=new fabric.Path(n,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,originX:"center",originY:"center"});return this.shadow&&(this.shadow.affectStroke=!0,t.setShadow(this.shadow)),t},_finalizeAndAddPath:function(){var i=this.canvas.contextTop,t,n;if(i.closePath(),t=this.convertPointsToSVGPath(this._points).join(""),t==="M 0 0 Q 0 0 0 0 L 0 0"){this.canvas.renderAll();return}n=this.createPath(t);this.canvas.add(n);n.setCoords();this.canvas.clearContext(this.canvas.contextTop);this._resetShadow();this.canvas.renderAll();this.canvas.fire("path:created",{path:n})}})}();fabric.CircleBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,initialize:function(n){this.canvas=n;this.points=[]},drawDot:function(n){var r=this.addPoint(n),t=this.canvas.contextTop,i=this.canvas.viewportTransform;t.save();t.transform(i[0],i[1],i[2],i[3],i[4],i[5]);t.fillStyle=r.fill;t.beginPath();t.arc(r.x,r.y,r.radius,0,Math.PI*2,!1);t.closePath();t.fill();t.restore()},onMouseDown:function(n){this.points.length=0;this.canvas.clearContext(this.canvas.contextTop);this._setShadow();this.drawDot(n)},onMouseMove:function(n){this.drawDot(n)},onMouseUp:function(){var e=this.canvas.renderOnAddRemove,r,t,f,n,u,i;for(this.canvas.renderOnAddRemove=!1,r=[],t=0,f=this.points.length;t<f;t++)n=this.points[t],u=new fabric.Circle({radius:n.radius,left:n.x,top:n.y,originX:"center",originY:"center",fill:n.fill}),this.shadow&&u.setShadow(this.shadow),r.push(u);i=new fabric.Group(r,{originX:"center",originY:"center"});i.canvas=this.canvas;this.canvas.add(i);this.canvas.fire("path:created",{path:i});this.canvas.clearContext(this.canvas.contextTop);this._resetShadow();this.canvas.renderOnAddRemove=e;this.canvas.renderAll()},addPoint:function(n){var t=new fabric.Point(n.x,n.y),i=fabric.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,r=new fabric.Color(this.color).setAlpha(fabric.util.getRandomInt(0,100)/100).toRgba();return t.radius=i,t.fill=r,this.points.push(t),t}});fabric.SprayBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(n){this.canvas=n;this.sprayChunks=[]},onMouseDown:function(n){this.sprayChunks.length=0;this.canvas.clearContext(this.canvas.contextTop);this._setShadow();this.addSprayChunk(n);this.render()},onMouseMove:function(n){this.addSprayChunk(n);this.render()},onMouseUp:function(){var s=this.canvas.renderOnAddRemove,i,r,e,t,n,o,f,u;for(this.canvas.renderOnAddRemove=!1,i=[],r=0,e=this.sprayChunks.length;r<e;r++)for(t=this.sprayChunks[r],n=0,o=t.length;n<o;n++)f=new fabric.Rect({width:t[n].width,height:t[n].width,left:t[n].x+1,top:t[n].y+1,originX:"center",originY:"center",fill:this.color}),this.shadow&&f.setShadow(this.shadow),i.push(f);this.optimizeOverlapping&&(i=this._getOptimizedRects(i));u=new fabric.Group(i,{originX:"center",originY:"center"});u.canvas=this.canvas;this.canvas.add(u);this.canvas.fire("path:created",{path:u});this.canvas.clearContext(this.canvas.contextTop);this._resetShadow();this.canvas.renderOnAddRemove=s;this.canvas.renderAll()},_getOptimizedRects:function(n){for(var u,r={},t,i=0,f=n.length;i<f;i++)t=n[i].left+""+n[i].top,r[t]||(r[t]=n[i]);u=[];for(t in r)u.push(r[t]);return u},render:function(){var i=this.canvas.contextTop,n,r,u,t;for(i.fillStyle=this.color,n=this.canvas.viewportTransform,i.save(),i.transform(n[0],n[1],n[2],n[3],n[4],n[5]),r=0,u=this.sprayChunkPoints.length;r<u;r++)t=this.sprayChunkPoints[r],typeof t.opacity!="undefined"&&(i.globalAlpha=t.opacity),i.fillRect(t.x,t.y,t.width,t.width);i.restore()},addSprayChunk:function(n){var u,f,e,t,r,i;for(this.sprayChunkPoints=[],t=this.width/2,r=0;r<this.density;r++)u=fabric.util.getRandomInt(n.x-t,n.x+t),f=fabric.util.getRandomInt(n.y-t,n.y+t),e=this.dotWidthVariance?fabric.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth,i=new fabric.Point(u,f),i.width=e,this.randomOpacity&&(i.opacity=fabric.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(i);this.sprayChunks.push(this.sprayChunkPoints)}});fabric.PatternBrush=fabric.util.createClass(fabric.PencilBrush,{getPatternSrc:function(){var t=20,i=fabric.document.createElement("canvas"),n=i.getContext("2d");return i.width=i.height=t+5,n.fillStyle=this.color,n.beginPath(),n.arc(t/2,t/2,t/2,0,Math.PI*2,!1),n.closePath(),n.fill(),i},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(){return this.canvas.contextTop.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(){this.callSuper("_setBrushStyles");this.canvas.contextTop.strokeStyle=this.getPattern()},createPath:function(n){var t=this.callSuper("createPath",n);return t.stroke=new fabric.Pattern({source:this.source||this.getPatternSrcFunction()}),t}}),function(){var u=fabric.util.getPointer,f=fabric.util.degreesToRadians,e=fabric.util.radiansToDegrees,r=Math.atan2,n=Math.abs,t=.5,i;fabric.Canvas=fabric.util.createClass(fabric.StaticCanvas,{initialize:function(n,t){t||(t={});this._initStatic(n,t);this._initInteractive();this._createCacheCanvas();fabric.Canvas.activeInstance=this},uniScaleTransform:!1,centeredScaling:!1,centeredRotation:!1,interactive:!0,selection:!0,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,_initInteractive:function(){this._currentTransform=null;this._groupSelector=null;this._initWrapperElement();this._createUpperCanvas();this._initEventListeners();this.freeDrawingBrush=fabric.PencilBrush&&new fabric.PencilBrush(this);this.calcOffset()},_resetCurrentTransform:function(n){var t=this._currentTransform;t.target.set({scaleX:t.original.scaleX,scaleY:t.original.scaleY,left:t.original.left,top:t.original.top});this._shouldCenterTransform(n,t.target)?t.action==="rotate"?this._setOriginToCenter(t.target):(t.originX!=="center"&&(t.mouseXSign=t.originX==="right"?-1:1),t.originY!=="center"&&(t.mouseYSign=t.originY==="bottom"?-1:1),t.originX="center",t.originY="center"):(t.originX=t.original.originX,t.originY=t.original.originY)},containsPoint:function(n,t){var i=this.getPointer(n,!0),r=this._normalizePointer(t,i);return t.containsPoint(r)||t._findTargetCorner(i)},_normalizePointer:function(n,t){var r=this.getActiveGroup(),u=t.x,f=t.y,e=r&&n.type!=="group"&&r.contains(n),i;return e&&(i=new fabric.Point(r.left,r.top),i=fabric.util.transformPoint(i,this.viewportTransform,!0),u-=i.x,f-=i.y),{x:u,y:f}},isTargetTransparent:function(n,t,i){var u=n.hasBorders,f=n.transparentCorners,r;return n.hasBorders=n.transparentCorners=!1,this._draw(this.contextCache,n),n.hasBorders=u,n.transparentCorners=f,r=fabric.util.isTransparent(this.contextCache,t,i,this.targetFindTolerance),this.clearContext(this.contextCache),r},_shouldClearSelection:function(n,t){var i=this.getActiveGroup(),r=this.getActiveObject();return!t||t&&i&&!i.contains(t)&&i!==t&&!n.shiftKey||t&&!t.evented||t&&!t.selectable&&r&&r!==t},_shouldCenterTransform:function(n,t){if(t){var i=this._currentTransform,r;return i.action==="scale"||i.action==="scaleX"||i.action==="scaleY"?r=this.centeredScaling||t.centeredScaling:i.action==="rotate"&&(r=this.centeredRotation||t.centeredRotation),r?!n.altKey:n.altKey}},_getOriginFromCorner:function(n,t){var i={x:n.originX,y:n.originY};return t==="ml"||t==="tl"||t==="bl"?i.x="right":(t==="mr"||t==="tr"||t==="br")&&(i.x="left"),t==="tl"||t==="mt"||t==="tr"?i.y="bottom":(t==="bl"||t==="mb"||t==="br")&&(i.y="top"),i},_getActionFromCorner:function(n,t){var i="drag";return t&&(i=t==="ml"||t==="mr"?"scaleX":t==="mt"||t==="mb"?"scaleY":t==="mtr"?"rotate":"scale"),i},_setupCurrentTransform:function(n,t){if(t){var i=this.getPointer(n),u=t._findTargetCorner(this.getPointer(n,!0)),e=this._getActionFromCorner(t,u),r=this._getOriginFromCorner(t,u);this._currentTransform={target:t,action:e,scaleX:t.scaleX,scaleY:t.scaleY,offsetX:i.x-t.left,offsetY:i.y-t.top,originX:r.x,originY:r.y,ex:i.x,ey:i.y,left:t.left,top:t.top,theta:f(t.angle),width:t.width*t.scaleX,mouseXSign:1,mouseYSign:1};this._currentTransform.original={left:t.left,top:t.top,scaleX:t.scaleX,scaleY:t.scaleY,originX:r.x,originY:r.y};this._resetCurrentTransform(n)}},_translateObject:function(n,t){var i=this._currentTransform.target;i.get("lockMovementX")||i.set("left",n-this._currentTransform.offsetX);i.get("lockMovementY")||i.set("top",t-this._currentTransform.offsetY)},_scaleObject:function(n,t,i){var r=this._currentTransform,u=r.target,e=u.get("lockScalingX"),o=u.get("lockScalingY"),h=u.get("lockScalingFlip"),s,f;e&&o||(s=u.translateToOriginPoint(u.getCenterPoint(),r.originX,r.originY),f=u.toLocalPoint(new fabric.Point(n,t),r.originX,r.originY),this._setLocalMouse(f,r),this._setObjectScale(f,r,e,o,i,h),u.setPositionByOrigin(s,r.originX,r.originY))},_setObjectScale:function(n,t,i,r,u,f){var e=t.target,o=!1,s=!1,h=e.stroke?e.strokeWidth:0;t.newScaleX=n.x/(e.width+h/2);t.newScaleY=n.y/(e.height+h/2);f&&t.newScaleX<=0&&t.newScaleX<e.scaleX&&(o=!0);f&&t.newScaleY<=0&&t.newScaleY<e.scaleY&&(s=!0);u==="equally"&&!i&&!r?o||s||this._scaleObjectEqually(n,e,t):u?u==="x"&&!e.get("lockUniScaling")?o||i||e.set("scaleX",t.newScaleX):u==="y"&&!e.get("lockUniScaling")&&(s||r||e.set("scaleY",t.newScaleY)):(o||i||e.set("scaleX",t.newScaleX),s||r||e.set("scaleY",t.newScaleY));o||s||this._flipObject(t,u)},_scaleObjectEqually:function(n,t,i){var r=n.y+n.x,u=t.stroke?t.strokeWidth:0,f=(t.height+u/2)*i.original.scaleY+(t.width+u/2)*i.original.scaleX;i.newScaleX=i.original.scaleX*r/f;i.newScaleY=i.original.scaleY*r/f;t.set("scaleX",i.newScaleX);t.set("scaleY",i.newScaleY)},_flipObject:function(n,t){n.newScaleX<0&&t!=="y"&&(n.originX==="left"?n.originX="right":n.originX==="right"&&(n.originX="left"));n.newScaleY<0&&t!=="x"&&(n.originY==="top"?n.originY="bottom":n.originY==="bottom"&&(n.originY="top"))},_setLocalMouse:function(t,i){var r=i.target;i.originX==="right"?t.x*=-1:i.originX==="center"&&(t.x*=i.mouseXSign*2,t.x<0&&(i.mouseXSign=-i.mouseXSign));i.originY==="bottom"?t.y*=-1:i.originY==="center"&&(t.y*=i.mouseYSign*2,t.y<0&&(i.mouseYSign=-i.mouseYSign));n(t.x)>r.padding?t.x<0?t.x+=r.padding:t.x-=r.padding:t.x=0;n(t.y)>r.padding?t.y<0?t.y+=r.padding:t.y-=r.padding:t.y=0},_rotateObject:function(n,t){var i=this._currentTransform;if(!i.target.get("lockRotation")){var f=r(i.ey-i.top,i.ex-i.left),o=r(t-i.top,n-i.left),u=e(o-f+i.theta);u<0&&(u=360+u);i.target.angle=u%360}},setCursor:function(n){this.upperCanvasEl.style.cursor=n},_resetObjectTransform:function(n){n.scaleX=1;n.scaleY=1;n.setAngle(0)},_drawSelection:function(){var i=this.contextTop,f=this._groupSelector,s=f.left,h=f.top,e=n(s),o=n(h),r,u;i.fillStyle=this.selectionColor;i.fillRect(f.ex-(s>0?0:-s),f.ey-(h>0?0:-h),e,o);i.lineWidth=this.selectionLineWidth;i.strokeStyle=this.selectionBorderColor;this.selectionDashArray.length>1?(r=f.ex+t-(s>0?0:e),u=f.ey+t-(h>0?0:o),i.beginPath(),fabric.util.drawDashedLine(i,r,u,r+e,u,this.selectionDashArray),fabric.util.drawDashedLine(i,r,u+o-1,r+e,u+o-1,this.selectionDashArray),fabric.util.drawDashedLine(i,r,u,r,u+o,this.selectionDashArray),fabric.util.drawDashedLine(i,r+e-1,u,r+e-1,u+o,this.selectionDashArray),i.closePath(),i.stroke()):i.strokeRect(f.ex+t-(s>0?0:e),f.ey+t-(h>0?0:o),e,o)},_isLastRenderedObject:function(n){return this.controlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay.visible&&this.containsPoint(n,this.lastRenderedObjectWithControlsAboveOverlay)&&this.lastRenderedObjectWithControlsAboveOverlay._findTargetCorner(this.getPointer(n,!0))},findTarget:function(n,t){var i,r;if(!this.skipTargetFind)return this._isLastRenderedObject(n)?this.lastRenderedObjectWithControlsAboveOverlay:(i=this.getActiveGroup(),i&&!t&&this.containsPoint(n,i))?i:(r=this._searchPossibleTargets(n),this._fireOverOutEvents(r),r)},_fireOverOutEvents:function(n){n?this._hoveredTarget!==n&&(this.fire("mouse:over",{target:n}),n.fire("mouseover"),this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget}),this._hoveredTarget.fire("mouseout")),this._hoveredTarget=n):this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget}),this._hoveredTarget.fire("mouseout"),this._hoveredTarget=null)},_checkTarget:function(n,t,i){if(t&&t.visible&&t.evented&&this.containsPoint(n,t)){if(!this.perPixelTargetFind&&!t.perPixelTargetFind||!!t.isEditing)return!0;var r=this.isTargetTransparent(t,i.x,i.y);if(!r)return!0}},_searchPossibleTargets:function(n){for(var i,r=this.getPointer(n,!0),t=this._objects.length;t--;)if(this._checkTarget(n,this._objects[t],r)){this.relatedTarget=this._objects[t];i=this._objects[t];break}return i},getPointer:function(n,t,i){i||(i=this.upperCanvasEl);var f=u(n,i),r=i.getBoundingClientRect(),e=r.width||0,o=r.height||0,s;return e&&o||("top"in r&&"bottom"in r&&(o=Math.abs(r.top-r.bottom)),"right"in r&&"left"in r&&(e=Math.abs(r.right-r.left))),this.calcOffset(),f.x=f.x-this._offset.left,f.y=f.y-this._offset.top,t||(f=fabric.util.transformPoint(f,fabric.util.invertTransform(this.viewportTransform))),s=e===0||o===0?{width:1,height:1}:{width:i.width/e,height:i.height/o},{x:f.x*s.width,y:f.y*s.height}},_createUpperCanvas:function(){var n=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,"");this.upperCanvasEl=this._createCanvasElement();fabric.util.addClass(this.upperCanvasEl,"upper-canvas "+n);this.wrapperEl.appendChild(this.upperCanvasEl);this._copyCanvasStyle(this.lowerCanvasEl,this.upperCanvasEl);this._applyCanvasStyle(this.upperCanvasEl);this.contextTop=this.upperCanvasEl.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement();this.cacheCanvasEl.setAttribute("width",this.width);this.cacheCanvasEl.setAttribute("height",this.height);this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=fabric.util.wrapElement(this.lowerCanvasEl,"div",{"class":this.containerClass});fabric.util.setStyle(this.wrapperEl,{width:this.getWidth()+"px",height:this.getHeight()+"px",position:"relative"});fabric.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(n){var t=this.getWidth()||n.width,i=this.getHeight()||n.height;fabric.util.setStyle(n,{position:"absolute",width:t+"px",height:i+"px",left:0,top:0});n.width=t;n.height=i;fabric.util.makeElementUnselectable(n)},_copyCanvasStyle:function(n,t){t.style.cssText=n.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},_setActiveObject:function(n){this._activeObject&&this._activeObject.set("active",!1);this._activeObject=n;n.set("active",!0)},setActiveObject:function(n,t){return this._setActiveObject(n),this.renderAll(),this.fire("object:selected",{target:n,e:t}),n.fire("selected",{e:t}),this},getActiveObject:function(){return this._activeObject},_discardActiveObject:function(){this._activeObject&&this._activeObject.set("active",!1);this._activeObject=null},discardActiveObject:function(n){return this._discardActiveObject(),this.renderAll(),this.fire("selection:cleared",{e:n}),this},_setActiveGroup:function(n){this._activeGroup=n;n&&n.set("active",!0)},setActiveGroup:function(n,t){return this._setActiveGroup(n),n&&(this.fire("object:selected",{target:n,e:t}),n.fire("selected",{e:t})),this},getActiveGroup:function(){return this._activeGroup},_discardActiveGroup:function(){var n=this.getActiveGroup();n&&n.destroy();this.setActiveGroup(null)},discardActiveGroup:function(n){return this._discardActiveGroup(),this.fire("selection:cleared",{e:n}),this},deactivateAll:function(){for(var t=this.getObjects(),n=0,i=t.length;n<i;n++)t[n].set("active",!1);return this._discardActiveGroup(),this._discardActiveObject(),this},deactivateAllWithDispatch:function(n){var t=this.getActiveGroup()||this.getActiveObject();return t&&this.fire("before:selection:cleared",{target:t,e:n}),this.deactivateAll(),t&&this.fire("selection:cleared",{e:n}),this},drawControls:function(n){var t=this.getActiveGroup();t?this._drawGroupControls(n,t):this._drawObjectsControls(n)},_drawGroupControls:function(n,t){t._renderControls(n)},_drawObjectsControls:function(n){for(var t=0,i=this._objects.length;t<i;++t)this._objects[t]&&this._objects[t].active&&(this._objects[t]._renderControls(n),this.lastRenderedObjectWithControlsAboveOverlay=this._objects[t])}});for(i in fabric.StaticCanvas)i!=="prototype"&&(fabric.Canvas[i]=fabric.StaticCanvas[i]);fabric.isTouchSupported&&(fabric.Canvas.prototype._setCursorFromEvent=function(){});fabric.Element=fabric.Canvas}(),function(){var i={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},n=fabric.util.addListener,t=fabric.util.removeListener;fabric.util.object.extend(fabric.Canvas.prototype,{cursorMap:["n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize","w-resize","nw-resize"],_initEventListeners:function(){this._bindEvents();n(fabric.window,"resize",this._onResize);n(this.upperCanvasEl,"mousedown",this._onMouseDown);n(this.upperCanvasEl,"mousemove",this._onMouseMove);n(this.upperCanvasEl,"mousewheel",this._onMouseWheel);n(this.upperCanvasEl,"touchstart",this._onMouseDown);n(this.upperCanvasEl,"touchmove",this._onMouseMove);typeof Event!="undefined"&&"add"in Event&&(Event.add(this.upperCanvasEl,"gesture",this._onGesture),Event.add(this.upperCanvasEl,"drag",this._onDrag),Event.add(this.upperCanvasEl,"orientation",this._onOrientationChange),Event.add(this.upperCanvasEl,"shake",this._onShake),Event.add(this.upperCanvasEl,"longpress",this._onLongPress))},_bindEvents:function(){this._onMouseDown=this._onMouseDown.bind(this);this._onMouseMove=this._onMouseMove.bind(this);this._onMouseUp=this._onMouseUp.bind(this);this._onResize=this._onResize.bind(this);this._onGesture=this._onGesture.bind(this);this._onDrag=this._onDrag.bind(this);this._onShake=this._onShake.bind(this);this._onLongPress=this._onLongPress.bind(this);this._onOrientationChange=this._onOrientationChange.bind(this);this._onMouseWheel=this._onMouseWheel.bind(this)},removeListeners:function(){t(fabric.window,"resize",this._onResize);t(this.upperCanvasEl,"mousedown",this._onMouseDown);t(this.upperCanvasEl,"mousemove",this._onMouseMove);t(this.upperCanvasEl,"mousewheel",this._onMouseWheel);t(this.upperCanvasEl,"touchstart",this._onMouseDown);t(this.upperCanvasEl,"touchmove",this._onMouseMove);typeof Event!="undefined"&&"remove"in Event&&(Event.remove(this.upperCanvasEl,"gesture",this._onGesture),Event.remove(this.upperCanvasEl,"drag",this._onDrag),Event.remove(this.upperCanvasEl,"orientation",this._onOrientationChange),Event.remove(this.upperCanvasEl,"shake",this._onShake),Event.remove(this.upperCanvasEl,"longpress",this._onLongPress))},_onGesture:function(n,t){this.__onTransformGesture&&this.__onTransformGesture(n,t)},_onDrag:function(n,t){this.__onDrag&&this.__onDrag(n,t)},_onMouseWheel:function(n,t){this.__onMouseWheel&&this.__onMouseWheel(n,t)},_onOrientationChange:function(n,t){this.__onOrientationChange&&this.__onOrientationChange(n,t)},_onShake:function(n,t){this.__onShake&&this.__onShake(n,t)},_onLongPress:function(n,t){this.__onLongPress&&this.__onLongPress(n,t)},_onMouseDown:function(i){this.__onMouseDown(i);n(fabric.document,"touchend",this._onMouseUp);n(fabric.document,"touchmove",this._onMouseMove);t(this.upperCanvasEl,"mousemove",this._onMouseMove);t(this.upperCanvasEl,"touchmove",this._onMouseMove);i.type==="touchstart"?t(this.upperCanvasEl,"mousedown",this._onMouseDown):(n(fabric.document,"mouseup",this._onMouseUp),n(fabric.document,"mousemove",this._onMouseMove))},_onMouseUp:function(i){if(this.__onMouseUp(i),t(fabric.document,"mouseup",this._onMouseUp),t(fabric.document,"touchend",this._onMouseUp),t(fabric.document,"mousemove",this._onMouseMove),t(fabric.document,"touchmove",this._onMouseMove),n(this.upperCanvasEl,"mousemove",this._onMouseMove),n(this.upperCanvasEl,"touchmove",this._onMouseMove),i.type==="touchend"){var r=this;setTimeout(function(){n(r.upperCanvasEl,"mousedown",r._onMouseDown)},400)}},_onMouseMove:function(n){!this.allowTouchScrolling&&n.preventDefault&&n.preventDefault();this.__onMouseMove(n)},_onResize:function(){this.calcOffset()},_shouldRender:function(n,t){var i=this.getActiveGroup()||this.getActiveObject();return!!(n&&(n.isMoving||n!==i)||!n&&!!i||!n&&!i&&!this._groupSelector||t&&this._previousPointer&&this.selection&&(t.x!==this._previousPointer.x||t.y!==this._previousPointer.y))},__onMouseUp:function(n){var t,i;if(this.isDrawingMode&&this._isCurrentlyDrawing){this._onMouseUpInDrawingMode(n);return}this._currentTransform?(this._finalizeCurrentTransform(),t=this._currentTransform.target):t=this.findTarget(n,!0);i=this._shouldRender(t,this.getPointer(n));this._maybeGroupObjects(n);t&&(t.isMoving=!1);i&&this.renderAll();this._handleCursorAndEvent(n,t)},_handleCursorAndEvent:function(n,t){this._setCursorFromEvent(n,t);var i=this;setTimeout(function(){i._setCursorFromEvent(n,t)},50);this.fire("mouse:up",{target:t,e:n});t&&t.fire("mouseup",{e:n})},_finalizeCurrentTransform:function(){var t=this._currentTransform,n=t.target;n._scaling&&(n._scaling=!1);n.setCoords();this.stateful&&n.hasStateChanged()&&(this.fire("object:modified",{target:n}),n.fire("modified"));this._restoreOriginXY(n)},_restoreOriginXY:function(n){if(this._previousOriginX&&this._previousOriginY){var t=n.translateToOriginPoint(n.getCenterPoint(),this._previousOriginX,this._previousOriginY);n.originX=this._previousOriginX;n.originY=this._previousOriginY;n.left=t.x;n.top=t.y;this._previousOriginX=null;this._previousOriginY=null}},_onMouseDownInDrawingMode:function(n){var i,r,t;this._isCurrentlyDrawing=!0;this.discardActiveObject(n).renderAll();this.clipTo&&fabric.util.clipContext(this,this.contextTop);i=fabric.util.invertTransform(this.viewportTransform);r=fabric.util.transformPoint(this.getPointer(n,!0),i);this.freeDrawingBrush.onMouseDown(r);this.fire("mouse:down",{e:n});t=this.findTarget(n);typeof t!="undefined"&&t.fire("mousedown",{e:n,target:t})},_onMouseMoveInDrawingMode:function(n){var i,r,t;if(this._isCurrentlyDrawing){i=fabric.util.invertTransform(this.viewportTransform);r=fabric.util.transformPoint(this.getPointer(n,!0),i);this.freeDrawingBrush.onMouseMove(r)}this.setCursor(this.freeDrawingCursor);this.fire("mouse:move",{e:n});t=this.findTarget(n);typeof t!="undefined"&&t.fire("mousemove",{e:n,target:t})},_onMouseUpInDrawingMode:function(n){this._isCurrentlyDrawing=!1;this.clipTo&&this.contextTop.restore();this.freeDrawingBrush.onMouseUp();this.fire("mouse:up",{e:n});var t=this.findTarget(n);typeof t!="undefined"&&t.fire("mouseup",{e:n,target:t})},__onMouseDown:function(n){var f="which"in n?n.which===1:n.button===1,t,i,u,r;if(f||fabric.isTouchSupported){if(this.isDrawingMode){this._onMouseDownInDrawingMode(n);return}this._currentTransform||(t=this.findTarget(n),i=this.getPointer(n,!0),this._previousPointer=i,u=this._shouldRender(t,i),r=this._shouldGroup(n,t),this._shouldClearSelection(n,t)?this._clearSelection(n,t,i):r&&(this._handleGrouping(n,t),t=this.getActiveGroup()),t&&t.selectable&&!r&&(this._beforeTransform(n,t),this._setupCurrentTransform(n,t)),u&&this.renderAll(),this.fire("mouse:down",{target:t,e:n}),t&&t.fire("mousedown",{e:n}))}},_beforeTransform:function(n,t){var i;this.stateful&&t.saveState();(i=t._findTargetCorner(this.getPointer(n)))&&this.onBeforeScaleRotate(t);t!==this.getActiveGroup()&&t!==this.getActiveObject()&&(this.deactivateAll(),this.setActiveObject(t,n))},_clearSelection:function(n,t,i){this.deactivateAllWithDispatch(n);t&&t.selectable?this.setActiveObject(t,n):this.selection&&(this._groupSelector={ex:i.x,ey:i.y,top:0,left:0})},_setOriginToCenter:function(n){this._previousOriginX=this._currentTransform.target.originX;this._previousOriginY=this._currentTransform.target.originY;var t=n.getCenterPoint();n.originX="center";n.originY="center";n.left=t.x;n.top=t.y;this._currentTransform.left=n.left;this._currentTransform.top=n.top},_setCenterToOrigin:function(n){var t=n.translateToOriginPoint(n.getCenterPoint(),this._previousOriginX,this._previousOriginY);n.originX=this._previousOriginX;n.originY=this._previousOriginY;n.left=t.x;n.top=t.y;this._previousOriginX=null;this._previousOriginY=null},__onMouseMove:function(n){var t,r,i;if(this.isDrawingMode){this._onMouseMoveInDrawingMode(n);return}typeof n.touches!="undefined"&&n.touches.length>1||(i=this._groupSelector,i?(r=this.getPointer(n,!0),i.left=r.x-i.ex,i.top=r.y-i.ey,this.renderTop()):this._currentTransform?this._transformObject(n):(t=this.findTarget(n),!t||t&&!t.selectable?this.setCursor(this.defaultCursor):this._setCursorFromEvent(n,t)),this.fire("mouse:move",{target:t,e:n}),t&&t.fire("mousemove",{e:n}))},_transformObject:function(n){var i=this.getPointer(n),t=this._currentTransform;t.reset=!1;t.target.isMoving=!0;this._beforeScaleTransform(n,t);this._performTransformAction(n,t,i);this.renderAll()},_performTransformAction:function(n,t,i){var r=i.x,u=i.y,f=t.target,e=t.action;e==="rotate"?(this._rotateObject(r,u),this._fire("rotating",f,n)):e==="scale"?(this._onScale(n,t,r,u),this._fire("scaling",f,n)):e==="scaleX"?(this._scaleObject(r,u,"x"),this._fire("scaling",f,n)):e==="scaleY"?(this._scaleObject(r,u,"y"),this._fire("scaling",f,n)):(this._translateObject(r,u),this._fire("moving",f,n),this.setCursor(this.moveCursor))},_fire:function(n,t,i){this.fire("object:"+n,{target:t,e:i});t.fire(n,{e:i})},_beforeScaleTransform:function(n,t){if(t.action==="scale"||t.action==="scaleX"||t.action==="scaleY"){var i=this._shouldCenterTransform(n,t.target);(i&&(t.originX!=="center"||t.originY!=="center")||!i&&t.originX==="center"&&t.originY==="center")&&(this._resetCurrentTransform(n),t.reset=!0)}},_onScale:function(n,t,i,r){(n.shiftKey||this.uniScaleTransform)&&!t.target.get("lockUniScaling")?(t.currentAction="scale",this._scaleObject(i,r)):(!t.reset&&t.currentAction==="scale"&&this._resetCurrentTransform(n,t.target),t.currentAction="scaleEqually",this._scaleObject(i,r,"equally"))},_setCursorFromEvent:function(n,t){if(!t||!t.selectable)return this.setCursor(this.defaultCursor),!1;var i=this.getActiveGroup(),r=t._findTargetCorner&&(!i||!i.contains(t))&&t._findTargetCorner(this.getPointer(n,!0));return r?this._setCornerCursor(r,t):this.setCursor(t.hoverCursor||this.hoverCursor),!0},_setCornerCursor:function(n,t){if(n in i)this.setCursor(this._getRotatedCornerCursor(n,t));else{if(n!=="mtr"||!t.hasRotatingPoint)return this.setCursor(this.defaultCursor),!1;this.setCursor(this.rotationCursor)}},_getRotatedCornerCursor:function(n,t){var r=Math.round(t.getAngle()%360/45);return r<0&&(r+=8),r+=i[n],r%=8,this.cursorMap[r]}})}(),function(){var n=Math.min,t=Math.max;fabric.util.object.extend(fabric.Canvas.prototype,{_shouldGroup:function(n,t){var i=this.getActiveObject();return n.shiftKey&&(this.getActiveGroup()||i&&i!==t)&&this.selection},_handleGrouping:function(n,t){(t!==this.getActiveGroup()||(t=this.findTarget(n,!0),t&&!t.isType("group")))&&(this.getActiveGroup()?this._updateActiveGroup(t,n):this._createActiveGroup(t,n),this._activeGroup&&this._activeGroup.saveCoords())},_updateActiveGroup:function(n,t){var i=this.getActiveGroup();if(i.contains(n)){if(i.removeWithUpdate(n),this._resetObjectTransform(i),n.set("active",!1),i.size()===1){this.discardActiveGroup(t);this.setActiveObject(i.item(0));return}}else i.addWithUpdate(n),this._resetObjectTransform(i);this.fire("selection:created",{target:i,e:t});i.set("active",!0)},_createActiveGroup:function(n,t){if(this._activeObject&&n!==this._activeObject){var i=this._createGroup(n);i.addWithUpdate();this.setActiveGroup(i);this._activeObject=null;this.fire("selection:created",{target:i,e:t})}n.set("active",!0)},_createGroup:function(n){var t=this.getObjects(),i=t.indexOf(this._activeObject)<t.indexOf(n),r=i?[this._activeObject,n]:[n,this._activeObject];return new fabric.Group(r,{canvas:this})},_groupSelectedObjects:function(n){var t=this._collectObjects();t.length===1?this.setActiveObject(t[0],n):t.length>1&&(t=new fabric.Group(t.reverse(),{canvas:this}),t.addWithUpdate(),this.setActiveGroup(t,n),t.saveCoords(),this.fire("selection:created",{target:t}),this.renderAll())},_collectObjects:function(){for(var h=[],i,r=this._groupSelector.ex,u=this._groupSelector.ey,f=r+this._groupSelector.left,e=u+this._groupSelector.top,o=new fabric.Point(n(r,f),n(u,e)),s=new fabric.Point(t(r,f),t(u,e)),l=r===f&&u===e,c=this._objects.length;c--;)if((i=this._objects[c],i&&i.selectable&&i.visible)&&(i.intersectsWithRect(o,s)||i.isContainedWithinRect(o,s)||i.containsPoint(o)||i.containsPoint(s))&&(i.set("active",!0),h.push(i),l))break;return h},_maybeGroupObjects:function(n){this.selection&&this._groupSelector&&this._groupSelectedObjects(n);var t=this.getActiveGroup();t&&(t.setObjectsCoords().setCoords(),t.isMoving=!1,this.setCursor(this.defaultCursor));this._groupSelector=null;this._currentTransform=null}})}();fabric.util.object.extend(fabric.StaticCanvas.prototype,{toDataURL:function(n){n||(n={});var t=n.format||"png",i=n.quality||1,r=n.multiplier||1,u={left:n.left,top:n.top,width:n.width,height:n.height};return r!==1?this.__toDataURLWithMultiplier(t,i,u,r):this.__toDataURL(t,i,u)},__toDataURL:function(n,t,i){var u,r,f;return this.renderAll(!0),u=this.upperCanvasEl||this.lowerCanvasEl,r=this.__getCroppedCanvas(u,i),n==="jpg"&&(n="jpeg"),f=fabric.StaticCanvas.supports("toDataURLWithQuality")?(r||u).toDataURL("image/"+n,t):(r||u).toDataURL("image/"+n),this.contextTop&&this.clearContext(this.contextTop),this.renderAll(),r&&(r=null),f},__getCroppedCanvas:function(n,t){var i,r,u="left"in t||"top"in t||"width"in t||"height"in t;return u&&(i=fabric.util.createCanvasElement(),r=i.getContext("2d"),i.width=t.width||this.width,i.height=t.height||this.height,r.drawImage(n,-t.left||0,-t.top||0)),i},__toDataURLWithMultiplier:function(n,t,i,r){var f=this.getWidth(),e=this.getHeight(),s=f*r,h=e*r,o=this.getActiveObject(),u=this.getActiveGroup(),c=this.contextTop||this.contextContainer,l;return r>1&&this.setWidth(s).setHeight(h),c.scale(r,r),i.left&&(i.left*=r),i.top&&(i.top*=r),i.width?i.width*=r:r<1&&(i.width=s),i.height?i.height*=r:r<1&&(i.height=h),u?this._tempRemoveBordersControlsFromGroup(u):o&&this.deactivateAll&&this.deactivateAll(),this.renderAll(!0),l=this.__toDataURL(n,t,i),this.width=f,this.height=e,c.scale(1/r,1/r),this.setWidth(f).setHeight(e),u?this._restoreBordersControlsOnGroup(u):o&&this.setActiveObject&&this.setActiveObject(o),this.contextTop&&this.clearContext(this.contextTop),this.renderAll(),l},toDataURLWithMultiplier:function(n,t,i){return this.toDataURL({format:n,multiplier:t,quality:i})},_tempRemoveBordersControlsFromGroup:function(n){n.origHasControls=n.hasControls;n.origBorderColor=n.borderColor;n.hasControls=!0;n.borderColor="rgba(0,0,0,0)";n.forEachObject(function(n){n.origBorderColor=n.borderColor;n.borderColor="rgba(0,0,0,0)"})},_restoreBordersControlsOnGroup:function(n){n.hideControls=n.origHideControls;n.borderColor=n.origBorderColor;n.forEachObject(function(n){n.borderColor=n.origBorderColor;delete n.origBorderColor})}});fabric.util.object.extend(fabric.StaticCanvas.prototype,{loadFromDatalessJSON:function(n,t,i){return this.loadFromJSON(n,t,i)},loadFromJSON:function(n,t,i){var r,u;if(n)return r=typeof n=="string"?JSON.parse(n):n,this.clear(),u=this,this._enlivenObjects(r.objects,function(){u._setBgOverlay(r,t)},i),this},_setBgOverlay:function(n,t){var u=this,i={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1},r;if(!n.backgroundImage&&!n.overlayImage&&!n.background&&!n.overlay){t&&t();return}r=function(){i.backgroundImage&&i.overlayImage&&i.backgroundColor&&i.overlayColor&&(u.renderAll(),t&&t())};this.__setBgOverlay("backgroundImage",n.backgroundImage,i,r);this.__setBgOverlay("overlayImage",n.overlayImage,i,r);this.__setBgOverlay("backgroundColor",n.background,i,r);this.__setBgOverlay("overlayColor",n.overlay,i,r);r()},__setBgOverlay:function(n,t,i,r){var u=this;if(!t){i[n]=!0;return}n==="backgroundImage"||n==="overlayImage"?fabric.Image.fromObject(t,function(t){u[n]=t;i[n]=!0;r&&r()}):this["set"+fabric.util.string.capitalize(n,!0)](t,function(){i[n]=!0;r&&r()})},_enlivenObjects:function(n,t,i){var r=this,u;if(!n||n.length===0){t&&t();return}u=this.renderOnAddRemove;this.renderOnAddRemove=!1;fabric.util.enlivenObjects(n,function(n){n.forEach(function(n,t){r.insertAt(n,t,!0)});r.renderOnAddRemove=u;t&&t()},null,i)},_toDataURL:function(n,t){this.clone(function(i){t(i.toDataURL(n))})},_toDataURLWithMultiplier:function(n,t,i){this.clone(function(r){i(r.toDataURLWithMultiplier(n,t))})},clone:function(n,t){var i=JSON.stringify(this.toJSON(t));this.cloneWithoutData(function(t){t.loadFromJSON(i,function(){n&&n(t)})})},cloneWithoutData:function(n){var i=fabric.document.createElement("canvas"),t;i.width=this.getWidth();i.height=this.getHeight();t=new fabric.Canvas(i);t.clipTo=this.clipTo;this.backgroundImage?(t.setBackgroundImage(this.backgroundImage.src,function(){t.renderAll();n&&n(t)}),t.backgroundImageOpacity=this.backgroundImageOpacity,t.backgroundImageStretch=this.backgroundImageStretch):n&&n(t)}}),function(n){"use strict";var t=n.fabric||(n.fabric={}),u=t.util.object.extend,i=t.util.toFixed,f=t.util.string.capitalize,r=t.util.degreesToRadians,e=t.StaticCanvas.supports("setLineDash");t.Object||(t.Object=t.util.createClass({type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,cornerSize:12,transparentCorners:!0,hoverCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",cornerColor:"rgba(102,153,255,0.5)",centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:10,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:.01,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,hasRotatingPoint:!0,rotatingPointOffset:40,perPixelTargetFind:!1,includeDefaultValues:!0,clipTo:null,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockUniScaling:!1,lockScalingFlip:!1,stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit angle opacity fill fillRule globalCompositeOperation shadow clipTo visible backgroundColor".split(" "),initialize:function(n){n&&this.setOptions(n)},_initGradient:function(n){!n.fill||!n.fill.colorStops||n.fill instanceof t.Gradient||this.set("fill",new t.Gradient(n.fill))},_initPattern:function(n){!n.fill||!n.fill.source||n.fill instanceof t.Pattern||this.set("fill",new t.Pattern(n.fill));!n.stroke||!n.stroke.source||n.stroke instanceof t.Pattern||this.set("stroke",new t.Pattern(n.stroke))},_initClipping:function(n){if(n.clipTo&&typeof n.clipTo=="string"){var i=t.util.getFunctionBody(n.clipTo);typeof i!="undefined"&&(this.clipTo=new Function("ctx",i))}},setOptions:function(n){for(var t in n)this.set(t,n[t]);this._initGradient(n);this._initPattern(n);this._initClipping(n)},transform:function(n,t){this.group&&this.group.transform(n,t);var i=t?this._getLeftTopCoords():this.getCenterPoint();n.translate(i.x,i.y);n.rotate(r(this.angle));n.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1))},toObject:function(n){var r=t.Object.NUM_FRACTION_DIGITS,u={type:this.type,originX:this.originX,originY:this.originY,left:i(this.left,r),top:i(this.top,r),width:i(this.width,r),height:i(this.height,r),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:i(this.strokeWidth,r),strokeDashArray:this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:i(this.strokeMiterLimit,r),scaleX:i(this.scaleX,r),scaleY:i(this.scaleY,r),angle:i(this.getAngle(),r),flipX:this.flipX,flipY:this.flipY,opacity:i(this.opacity,r),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&String(this.clipTo),backgroundColor:this.backgroundColor,fillRule:this.fillRule,globalCompositeOperation:this.globalCompositeOperation};return this.includeDefaultValues||(u=this._removeDefaultValues(u)),t.util.populateWithProperties(this,u,n),u},toDatalessObject:function(n){return this.toObject(n)},_removeDefaultValues:function(n){var i=t.util.getKlass(n.type).prototype,r=i.stateProperties;return r.forEach(function(t){n[t]===i[t]&&delete n[t]}),n},toString:function(){return"#<fabric."+f(this.type)+">"},get:function(n){return this[n]},_setObject:function(n){for(var t in n)this._set(t,n[t])},set:function(n,t){return typeof n=="object"?this._setObject(n):typeof t=="function"&&n!=="clipTo"?this._set(n,t(this.get(n))):this._set(n,t),this},_set:function(n,r){var u=n==="scaleX"||n==="scaleY";return u&&(r=this._constrainScale(r)),n==="scaleX"&&r<0?(this.flipX=!this.flipX,r*=-1):n==="scaleY"&&r<0?(this.flipY=!this.flipY,r*=-1):n==="width"||n==="height"?this.minScaleLimit=i(Math.min(.1,1/Math.max(this.width,this.height)),2):n==="shadow"&&r&&!(r instanceof t.Shadow)&&(r=new t.Shadow(r)),this[n]=r,this},toggle:function(n){var t=this.get(n);return typeof t=="boolean"&&this.set(n,!t),this},setSourcePath:function(n){return this.sourcePath=n,this},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:[1,0,0,1,0,0]},render:function(n,i){(this.width!==0||this.height!==0)&&this.visible&&(n.save(),this._setupCompositeOperation(n),i||this.transform(n),this._setStrokeStyles(n),this._setFillStyles(n),this.group&&this.group.type==="path-group"&&n.translate(-this.group.width/2,-this.group.height/2),this.transformMatrix&&n.transform.apply(n,this.transformMatrix),this._setOpacity(n),this._setShadow(n),this.clipTo&&t.util.clipContext(this,n),this._render(n,i),this.clipTo&&n.restore(),this._removeShadow(n),this._restoreCompositeOperation(n),n.restore())},_setOpacity:function(n){this.group&&this.group._setOpacity(n);n.globalAlpha*=this.opacity},_setStrokeStyles:function(n){this.stroke&&(n.lineWidth=this.strokeWidth,n.lineCap=this.strokeLineCap,n.lineJoin=this.strokeLineJoin,n.miterLimit=this.strokeMiterLimit,n.strokeStyle=this.stroke.toLive?this.stroke.toLive(n,this):this.stroke)},_setFillStyles:function(n){this.fill&&(n.fillStyle=this.fill.toLive?this.fill.toLive(n,this):this.fill)},_renderControls:function(n,i){var f=this.getViewportTransform(),u;n.save();this.active&&!i&&(this.group&&(u=t.util.transformPoint(this.group.getCenterPoint(),f),n.translate(u.x,u.y),n.rotate(r(this.group.angle))),u=t.util.transformPoint(this.getCenterPoint(),f,null!=this.group),this.group&&(u.x*=this.group.scaleX,u.y*=this.group.scaleY),n.translate(u.x,u.y),n.rotate(r(this.angle)),this.drawBorders(n),this.drawControls(n));n.restore()},_setShadow:function(n){if(this.shadow){var t=this.canvas&&this.canvas._currentMultiplier||1;n.shadowColor=this.shadow.color;n.shadowBlur=this.shadow.blur*t*(this.scaleX+this.scaleY)/2;n.shadowOffsetX=this.shadow.offsetX*t*this.scaleX;n.shadowOffsetY=this.shadow.offsetY*t*this.scaleY}},_removeShadow:function(n){this.shadow&&(n.shadowColor="",n.shadowBlur=n.shadowOffsetX=n.shadowOffsetY=0)},_renderFill:function(n){if(this.fill){if(n.save(),this.fill.gradientTransform){var t=this.fill.gradientTransform;n.transform.apply(n,t)}this.fill.toLive&&n.translate(-this.width/2+this.fill.offsetX||0,-this.height/2+this.fill.offsetY||0);this.fillRule==="evenodd"?n.fill("evenodd"):n.fill();n.restore();this.shadow&&!this.shadow.affectStroke&&this._removeShadow(n)}},_renderStroke:function(n){if(this.stroke&&this.strokeWidth!==0){if(n.save(),this.strokeDashArray)1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),e?(n.setLineDash(this.strokeDashArray),this._stroke&&this._stroke(n)):this._renderDashedStroke&&this._renderDashedStroke(n),n.stroke();else{if(this.stroke.gradientTransform){var t=this.stroke.gradientTransform;n.transform.apply(n,t)}this._stroke?this._stroke(n):n.stroke()}this._removeShadow(n);n.restore()}},clone:function(n,i){return this.constructor.fromObject?this.constructor.fromObject(this.toObject(i),n):new t.Object(this.toObject(i))},cloneAsImage:function(n){var i=this.toDataURL();return t.util.loadImage(i,function(i){n&&n(new t.Image(i))}),this},toDataURL:function(n){var i,u,r,f,e,o;return n||(n={}),i=t.util.createCanvasElement(),u=this.getBoundingRect(),i.width=u.width,i.height=u.height,t.util.wrapElement(i,"div"),r=new t.Canvas(i),n.format==="jpg"&&(n.format="jpeg"),n.format==="jpeg"&&(r.backgroundColor="#fff"),f={active:this.get("active"),left:this.getLeft(),top:this.getTop()},this.set("active",!1),this.setPositionByOrigin(new t.Point(i.width/2,i.height/2),"center","center"),e=this.canvas,r.add(this),o=r.toDataURL(n),this.set(f).setCoords(),this.canvas=e,r.dispose(),r=null,o},isType:function(n){return this.type===n},complexity:function(){return 0},toJSON:function(n){return this.toObject(n)},setGradient:function(n,i){var r,u,f;i||(i={});r={colorStops:[]};r.type=i.type||(i.r1||i.r2?"radial":"linear");r.coords={x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2};(i.r1||i.r2)&&(r.coords.r1=i.r1,r.coords.r2=i.r2);for(u in i.colorStops)f=new t.Color(i.colorStops[u]),r.colorStops.push({offset:u,color:f.toRgb(),opacity:f.getAlpha()});return this.set(n,t.Gradient.forObject(this,r))},setPatternFill:function(n){return this.set("fill",new t.Pattern(n))},setShadow:function(n){return this.set("shadow",n?new t.Shadow(n):null)},setColor:function(n){return this.set("fill",n),this},setAngle:function(n){var t=(this.originX!=="center"||this.originY!=="center")&&this.centeredRotation;return t&&this._setOriginToCenter(),this.set("angle",n),t&&this._resetOrigin(),this},centerH:function(){return this.canvas.centerObjectH(this),this},centerV:function(){return this.canvas.centerObjectV(this),this},center:function(){return this.canvas.centerObject(this),this},remove:function(){return this.canvas.remove(this),this},getLocalPointer:function(n,t){t=t||this.canvas.getPointer(n);var i=this.translateToOriginPoint(this.getCenterPoint(),"left","top");return{x:t.x-i.x,y:t.y-i.y}},_setupCompositeOperation:function(n){this.globalCompositeOperation&&(this._prevGlobalCompositeOperation=n.globalCompositeOperation,n.globalCompositeOperation=this.globalCompositeOperation)},_restoreCompositeOperation:function(n){this.globalCompositeOperation&&this._prevGlobalCompositeOperation&&(n.globalCompositeOperation=this._prevGlobalCompositeOperation)}}),t.util.createAccessors(t.Object),t.Object.prototype.rotate=t.Object.prototype.setAngle,u(t.Object.prototype,t.Observable),t.Object.NUM_FRACTION_DIGITS=2,t.Object.__uid=0)}(typeof exports!="undefined"?exports:undefined),function(){var n=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{translateToCenterPoint:function(t,i,r){var f=t.x,e=t.y,u=this.stroke?this.strokeWidth:0;return i==="left"?f=t.x+(this.getWidth()+u*this.scaleX)/2:i==="right"&&(f=t.x-(this.getWidth()+u*this.scaleX)/2),r==="top"?e=t.y+(this.getHeight()+u*this.scaleY)/2:r==="bottom"&&(e=t.y-(this.getHeight()+u*this.scaleY)/2),fabric.util.rotatePoint(new fabric.Point(f,e),t,n(this.angle))},translateToOriginPoint:function(t,i,r){var f=t.x,e=t.y,u=this.stroke?this.strokeWidth:0;return i==="left"?f=t.x-(this.getWidth()+u*this.scaleX)/2:i==="right"&&(f=t.x+(this.getWidth()+u*this.scaleX)/2),r==="top"?e=t.y-(this.getHeight()+u*this.scaleY)/2:r==="bottom"&&(e=t.y+(this.getHeight()+u*this.scaleY)/2),fabric.util.rotatePoint(new fabric.Point(f,e),t,n(this.angle))},getCenterPoint:function(){var n=new fabric.Point(this.left,this.top);return this.translateToCenterPoint(n,this.originX,this.originY)},getPointByOrigin:function(n,t){var i=this.getCenterPoint();return this.translateToOriginPoint(i,n,t)},toLocalPoint:function(t,i,r){var u=this.getCenterPoint(),f=this.stroke?this.strokeWidth:0,e,o;return i&&r?(e=i==="left"?u.x-(this.getWidth()+f*this.scaleX)/2:i==="right"?u.x+(this.getWidth()+f*this.scaleX)/2:u.x,o=r==="top"?u.y-(this.getHeight()+f*this.scaleY)/2:r==="bottom"?u.y+(this.getHeight()+f*this.scaleY)/2:u.y):(e=this.left,o=this.top),fabric.util.rotatePoint(new fabric.Point(t.x,t.y),u,-n(this.angle)).subtractEquals(new fabric.Point(e,o))},setPositionByOrigin:function(n,t,i){var u=this.translateToCenterPoint(n,t,i),r=this.translateToOriginPoint(u,this.originX,this.originY);this.set("left",r.x);this.set("top",r.y)},adjustPosition:function(t){var i=n(this.angle),r=this.getWidth()/2,u=Math.cos(i)*r,f=Math.sin(i)*r,e=this.getWidth(),o=Math.cos(i)*e,s=Math.sin(i)*e;this.originX==="center"&&t==="left"||this.originX==="right"&&t==="center"?(this.left-=u,this.top-=f):this.originX==="left"&&t==="center"||this.originX==="center"&&t==="right"?(this.left+=u,this.top+=f):this.originX==="left"&&t==="right"?(this.left+=o,this.top+=s):this.originX==="right"&&t==="left"&&(this.left-=o,this.top-=s);this.setCoords();this.originX=t},_setOriginToCenter:function(){this._originalOriginX=this.originX;this._originalOriginY=this.originY;var n=this.getCenterPoint();this.originX="center";this.originY="center";this.left=n.x;this.top=n.y},_resetOrigin:function(){var n=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX;this.originY=this._originalOriginY;this.left=n.x;this.top=n.y;this._originalOriginX=null;this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","center")}})}(),function(){var n=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{oCoords:null,intersectsWithRect:function(n,t){var i=this.oCoords,r=new fabric.Point(i.tl.x,i.tl.y),u=new fabric.Point(i.tr.x,i.tr.y),f=new fabric.Point(i.bl.x,i.bl.y),e=new fabric.Point(i.br.x,i.br.y),o=fabric.Intersection.intersectPolygonRectangle([r,u,e,f],n,t);return o.status==="Intersection"},intersectsWithObject:function(n){function r(n){return{tl:new fabric.Point(n.tl.x,n.tl.y),tr:new fabric.Point(n.tr.x,n.tr.y),bl:new fabric.Point(n.bl.x,n.bl.y),br:new fabric.Point(n.br.x,n.br.y)}}var t=r(this.oCoords),i=r(n.oCoords),u=fabric.Intersection.intersectPolygonPolygon([t.tl,t.tr,t.br,t.bl],[i.tl,i.tr,i.br,i.bl]);return u.status==="Intersection"},isContainedWithinObject:function(n){var t=n.getBoundingRect(),i=new fabric.Point(t.left,t.top),r=new fabric.Point(t.left+t.width,t.top+t.height);return this.isContainedWithinRect(i,r)},isContainedWithinRect:function(n,t){var i=this.getBoundingRect();return i.left>=n.x&&i.left+i.width<=t.x&&i.top>=n.y&&i.top+i.height<=t.y},containsPoint:function(n){var i=this._getImageLines(this.oCoords),t=this._findCrossPoints(n,i);return t!==0&&t%2==1},_getImageLines:function(n){return{topline:{o:n.tl,d:n.tr},rightline:{o:n.tr,d:n.br},bottomline:{o:n.br,d:n.bl},leftline:{o:n.bl,d:n.tl}}},_findCrossPoints:function(n,t){var r,f,e,s,u,h,o=0,i;for(var c in t)if((i=t[c],!(i.o.y<n.y)||!(i.d.y<n.y))&&(!(i.o.y>=n.y)||!(i.d.y>=n.y))&&(i.o.x===i.d.x&&i.o.x>=n.x?(u=i.o.x,h=n.y):(r=0,f=(i.d.y-i.o.y)/(i.d.x-i.o.x),e=n.y-r*n.x,s=i.o.y-f*i.o.x,u=-(e-s)/(r-f),h=e+r*u),u>=n.x&&(o+=1),o===2))break;return o},getBoundingRectWidth:function(){return this.getBoundingRect().width},getBoundingRectHeight:function(){return this.getBoundingRect().height},getBoundingRect:function(){this.oCoords||this.setCoords();var n=[this.oCoords.tl.x,this.oCoords.tr.x,this.oCoords.br.x,this.oCoords.bl.x],t=fabric.util.array.min(n),u=fabric.util.array.max(n),f=Math.abs(t-u),i=[this.oCoords.tl.y,this.oCoords.tr.y,this.oCoords.br.y,this.oCoords.bl.y],r=fabric.util.array.min(i),e=fabric.util.array.max(i),o=Math.abs(r-e);return{left:t,top:r,width:f,height:o}},getWidth:function(){return this.width*this.scaleX},getHeight:function(){return this.height*this.scaleY},_constrainScale:function(n){return Math.abs(n)<this.minScaleLimit?n<0?-this.minScaleLimit:this.minScaleLimit:n},scale:function(n){return n=this._constrainScale(n),n<0&&(this.flipX=!this.flipX,this.flipY=!this.flipY,n*=-1),this.scaleX=n,this.scaleY=n,this.setCoords(),this},scaleToWidth:function(n){var t=this.getBoundingRectWidth()/this.getWidth();return this.scale(n/this.width/t)},scaleToHeight:function(n){var t=this.getBoundingRectHeight()/this.getHeight();return this.scale(n/this.height/t)},setCoords:function(){var s=this.strokeWidth,h=n(this.angle),ct=this.getViewportTransform(),u=function(n){return fabric.util.transformPoint(n,ct)},l=this.width,a=this.height,et=this.strokeLineCap==="round"||this.strokeLineCap==="square",y=this.type==="line"&&this.width===0,p=this.type==="line"&&this.height===0,ot=y||p,lt=et&&p||!ot,at=et&&y||!ot;y?l=s:p&&(a=s);lt&&(l+=l>0?s:-s);at&&(a+=a>0?s:-s);this.currentWidth=l*this.scaleX;this.currentHeight=a*this.scaleY;this.currentWidth<0&&(this.currentWidth=Math.abs(this.currentWidth));var st=Math.sqrt(Math.pow(this.currentWidth/2,2)+Math.pow(this.currentHeight/2,2)),v=Math.atan(isFinite(this.currentHeight/this.currentWidth)?this.currentHeight/this.currentWidth:0),vt=Math.cos(v+h)*st,yt=Math.sin(v+h)*st,e=Math.sin(h),o=Math.cos(h),ht=this.getCenterPoint(),t=new fabric.Point(this.currentWidth,this.currentHeight),f=new fabric.Point(ht.x-vt,ht.y-yt),c=new fabric.Point(f.x+t.x*o,f.y+t.x*e),w=new fabric.Point(f.x-t.y*e,f.y+t.y*o),b=new fabric.Point(f.x+t.x/2*o,f.y+t.x/2*e),k=u(f),d=u(c),g=u(new fabric.Point(c.x-t.y*e,c.y+t.y*o)),nt=u(w),tt=u(new fabric.Point(f.x-t.y/2*e,f.y+t.y/2*o)),it=u(b),rt=u(new fabric.Point(c.x-t.y/2*e,c.y+t.y/2*o)),ut=u(new fabric.Point(w.x+t.x/2*o,w.y+t.x/2*e)),ft=u(new fabric.Point(b.x,b.y)),i=Math.cos(v+h)*this.padding*Math.sqrt(2),r=Math.sin(v+h)*this.padding*Math.sqrt(2);return k=k.add(new fabric.Point(-i,-r)),d=d.add(new fabric.Point(r,-i)),g=g.add(new fabric.Point(i,r)),nt=nt.add(new fabric.Point(-r,i)),tt=tt.add(new fabric.Point((-i-r)/2,(-r+i)/2)),it=it.add(new fabric.Point((r-i)/2,-(r+i)/2)),rt=rt.add(new fabric.Point((r+i)/2,(r-i)/2)),ut=ut.add(new fabric.Point((i-r)/2,(i+r)/2)),ft=ft.add(new fabric.Point((r-i)/2,-(r+i)/2)),this.oCoords={tl:k,tr:d,br:g,bl:nt,ml:tt,mt:it,mr:rt,mb:ut,mtr:ft},this._setCornerCoords&&this._setCornerCoords(),this}})}();fabric.util.object.extend(fabric.Object.prototype,{sendToBack:function(){return this.group?fabric.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?fabric.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas.bringToFront(this),this},sendBackwards:function(n){return this.group?fabric.StaticCanvas.prototype.sendBackwards.call(this.group,this,n):this.canvas.sendBackwards(this,n),this},bringForward:function(n){return this.group?fabric.StaticCanvas.prototype.bringForward.call(this.group,this,n):this.canvas.bringForward(this,n),this},moveTo:function(n){return this.group?fabric.StaticCanvas.prototype.moveTo.call(this.group,this,n):this.canvas.moveTo(this,n),this}});fabric.util.object.extend(fabric.Object.prototype,{getSvgStyles:function(){var n=this.fill?this.fill.toLive?"url(#SVGID_"+this.fill.id+")":this.fill:"none",t=this.fillRule,i=this.stroke?this.stroke.toLive?"url(#SVGID_"+this.stroke.id+")":this.stroke:"none",r=this.strokeWidth?this.strokeWidth:"0",u=this.strokeDashArray?this.strokeDashArray.join(" "):"",f=this.strokeLineCap?this.strokeLineCap:"butt",e=this.strokeLineJoin?this.strokeLineJoin:"miter",o=this.strokeMiterLimit?this.strokeMiterLimit:"4",s=typeof this.opacity!="undefined"?this.opacity:"1",h=this.visible?"":" visibility: hidden;",c=this.shadow&&this.type!=="text"?"filter: url(#SVGID_"+this.shadow.id+");":"";return["stroke: ",i,"; ","stroke-width: ",r,"; ","stroke-dasharray: ",u,"; ","stroke-linecap: ",f,"; ","stroke-linejoin: ",e,"; ","stroke-miterlimit: ",o,"; ","fill: ",n,"; ","fill-rule: ",t,"; ","opacity: ",s,";",c,h].join("")},getSvgTransform:function(){if(this.group&&this.group.type==="path-group")return"";var t=fabric.util.toFixed,r=this.getAngle(),n=!this.canvas||this.canvas.svgViewportTransformation?this.getViewportTransform():[1,0,0,1,0,0],u=fabric.util.transformPoint(this.getCenterPoint(),n),i=fabric.Object.NUM_FRACTION_DIGITS,f=this.type==="path-group"?"":"translate("+t(u.x,i)+" "+t(u.y,i)+")",e=r!==0?" rotate("+t(r,i)+")":"",o=this.scaleX===1&&this.scaleY===1&&n[0]===1&&n[3]===1?"":" scale("+t(this.scaleX*n[0],i)+" "+t(this.scaleY*n[3],i)+")",s=this.type==="path-group"?this.width*n[0]:0,h=this.flipX?" matrix(-1 0 0 1 "+s+" 0) ":"",c=this.type==="path-group"?this.height*n[3]:0,l=this.flipY?" matrix(1 0 0 -1 0 "+c+")":"";return[f,e,o,h,l].join("")},getSvgTransformMatrix:function(){return this.transformMatrix?" matrix("+this.transformMatrix.join(" ")+")":""},_createBaseSVGMarkup:function(){var n=[];return this.fill&&this.fill.toLive&&n.push(this.fill.toSVG(this,!1)),this.stroke&&this.stroke.toLive&&n.push(this.stroke.toSVG(this,!1)),this.shadow&&n.push(this.shadow.toSVG(this)),n}});fabric.util.object.extend(fabric.Object.prototype,{hasStateChanged:function(){return this.stateProperties.some(function(n){return this.get(n)!==this.originalState[n]},this)},saveState:function(n){return this.stateProperties.forEach(function(n){this.originalState[n]=this.get(n)},this),n&&n.stateProperties&&n.stateProperties.forEach(function(n){this.originalState[n]=this.get(n)},this),this},setupState:function(){return this.originalState={},this.saveState(),this}}),function(){var n=fabric.util.degreesToRadians,t=function(){return typeof G_vmlCanvasManager!="undefined"};fabric.util.object.extend(fabric.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(n){var r,u,i,f,t;if(!this.hasControls||!this.active)return!1;r=n.x;u=n.y;for(t in this.oCoords)if(this.isControlVisible(t)&&(t!=="mtr"||this.hasRotatingPoint)&&(!this.get("lockUniScaling")||t!=="mt"&&t!=="mr"&&t!=="mb"&&t!=="ml")&&(f=this._getImageLines(this.oCoords[t].corner),i=this._findCrossPoints({x:r,y:u},f),i!==0&&i%2==1))return this.__corner=t,t;return!1},_setCornerCoords:function(){var t=this.oCoords,e=n(this.angle),o=n(45-this.angle),s=Math.sqrt(2*Math.pow(this.cornerSize,2))/2,i=s*Math.cos(o),r=s*Math.sin(o),u=Math.sin(e),f=Math.cos(e);t.tl.corner={tl:{x:t.tl.x-r,y:t.tl.y-i},tr:{x:t.tl.x+i,y:t.tl.y-r},bl:{x:t.tl.x-i,y:t.tl.y+r},br:{x:t.tl.x+r,y:t.tl.y+i}};t.tr.corner={tl:{x:t.tr.x-r,y:t.tr.y-i},tr:{x:t.tr.x+i,y:t.tr.y-r},br:{x:t.tr.x+r,y:t.tr.y+i},bl:{x:t.tr.x-i,y:t.tr.y+r}};t.bl.corner={tl:{x:t.bl.x-r,y:t.bl.y-i},bl:{x:t.bl.x-i,y:t.bl.y+r},br:{x:t.bl.x+r,y:t.bl.y+i},tr:{x:t.bl.x+i,y:t.bl.y-r}};t.br.corner={tr:{x:t.br.x+i,y:t.br.y-r},bl:{x:t.br.x-i,y:t.br.y+r},br:{x:t.br.x+r,y:t.br.y+i},tl:{x:t.br.x-r,y:t.br.y-i}};t.ml.corner={tl:{x:t.ml.x-r,y:t.ml.y-i},tr:{x:t.ml.x+i,y:t.ml.y-r},bl:{x:t.ml.x-i,y:t.ml.y+r},br:{x:t.ml.x+r,y:t.ml.y+i}};t.mt.corner={tl:{x:t.mt.x-r,y:t.mt.y-i},tr:{x:t.mt.x+i,y:t.mt.y-r},bl:{x:t.mt.x-i,y:t.mt.y+r},br:{x:t.mt.x+r,y:t.mt.y+i}};t.mr.corner={tl:{x:t.mr.x-r,y:t.mr.y-i},tr:{x:t.mr.x+i,y:t.mr.y-r},bl:{x:t.mr.x-i,y:t.mr.y+r},br:{x:t.mr.x+r,y:t.mr.y+i}};t.mb.corner={tl:{x:t.mb.x-r,y:t.mb.y-i},tr:{x:t.mb.x+i,y:t.mb.y-r},bl:{x:t.mb.x-i,y:t.mb.y+r},br:{x:t.mb.x+r,y:t.mb.y+i}};t.mtr.corner={tl:{x:t.mtr.x-r+u*this.rotatingPointOffset,y:t.mtr.y-i-f*this.rotatingPointOffset},tr:{x:t.mtr.x+i+u*this.rotatingPointOffset,y:t.mtr.y-r-f*this.rotatingPointOffset},bl:{x:t.mtr.x-i+u*this.rotatingPointOffset,y:t.mtr.y+r-f*this.rotatingPointOffset},br:{x:t.mtr.x+r+u*this.rotatingPointOffset,y:t.mtr.y+i-f*this.rotatingPointOffset}}},drawBorders:function(n){var u,f,l;if(!this.hasBorders)return this;var t=this.padding,a=t*2,w=this.getViewportTransform();n.save();n.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;n.strokeStyle=this.borderColor;u=1/this._constrainScale(this.scaleX);f=1/this._constrainScale(this.scaleY);n.lineWidth=1/this.borderScaleFactor;var e=this.getWidth(),o=this.getHeight(),i=this.strokeWidth,v=this.strokeLineCap==="round"||this.strokeLineCap==="square",s=this.type==="line"&&this.width===0,h=this.type==="line"&&this.height===0,y=s||h,b=v&&h||!y,k=v&&s||!y;s?e=i/u:h&&(o=i/f);b&&(e+=i/u);k&&(o+=i/f);var p=fabric.util.transformPoint(new fabric.Point(e,o),w,!0),c=p.x,r=p.y;return this.group&&(c*=this.group.scaleX,r*=this.group.scaleY),n.strokeRect(~~(-(c/2)-t)-.5,~~(-(r/2)-t)-.5,~~(c+a)+1,~~(r+a)+1),this.hasRotatingPoint&&this.isControlVisible("mtr")&&!this.get("lockRotation")&&this.hasControls&&(l=(-r-t*2)/2,n.beginPath(),n.moveTo(0,l),n.lineTo(0,l-this.rotatingPointOffset),n.closePath(),n.stroke()),n.restore(),this},drawControls:function(n){if(!this.hasControls)return this;var y=this.cornerSize,p=y/2,d=this.getViewportTransform(),h=this.strokeWidth,c=this.width,l=this.height,w=this.strokeLineCap==="round"||this.strokeLineCap==="square",a=this.type==="line"&&this.width===0,v=this.type==="line"&&this.height===0,b=a||v,g=w&&v||!b,nt=w&&a||!b;a?c=h:v&&(l=h);g&&(c+=h);nt&&(l+=h);c*=this.scaleX;l*=this.scaleY;var k=fabric.util.transformPoint(new fabric.Point(c,l),d,!0),e=k.x,o=k.y,r=-(e/2),u=-(o/2),t=this.padding,i=p,s=p-y,f=this.transparentCorners?"strokeRect":"fillRect";return n.save(),n.lineWidth=1,n.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,n.strokeStyle=n.fillStyle=this.cornerColor,this._drawControl("tl",n,f,r-i-t,u-i-t),this._drawControl("tr",n,f,r+e-i+t,u-i-t),this._drawControl("bl",n,f,r-i-t,u+o+s+t),this._drawControl("br",n,f,r+e+s+t,u+o+s+t),this.get("lockUniScaling")||(this._drawControl("mt",n,f,r+e/2-i,u-i-t),this._drawControl("mb",n,f,r+e/2-i,u+o+s+t),this._drawControl("mr",n,f,r+e+s+t,u+o/2-i),this._drawControl("ml",n,f,r-i-t,u+o/2-i)),this.hasRotatingPoint&&this._drawControl("mtr",n,f,r+e/2-i,u-this.rotatingPointOffset-this.cornerSize/2-t),n.restore(),this},_drawControl:function(n,i,r,u,f){var e=this.cornerSize;this.isControlVisible(n)&&(t()||this.transparentCorners||i.clearRect(u,f,e,e),i[r](u,f,e,e))},isControlVisible:function(n){return this._getControlsVisibility()[n]},setControlVisible:function(n,t){return this._getControlsVisibility()[n]=t,this},setControlsVisibility:function(n){n||(n={});for(var t in n)this.setControlVisible(t,n[t]);return this},_getControlsVisibility:function(){return this._controlsVisibility||(this._controlsVisibility={tl:!0,tr:!0,br:!0,bl:!0,ml:!0,mt:!0,mr:!0,mb:!0,mtr:!0}),this._controlsVisibility}})}();fabric.util.object.extend(fabric.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(n,t){t=t||{};var i=function(){},r=t.onComplete||i,u=t.onChange||i,f=this;return fabric.util.animate({startValue:n.get("left"),endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(t){n.set("left",t);f.renderAll();u()},onComplete:function(){n.setCoords();r()}}),this},fxCenterObjectV:function(n,t){t=t||{};var i=function(){},r=t.onComplete||i,u=t.onChange||i,f=this;return fabric.util.animate({startValue:n.get("top"),endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(t){n.set("top",t);f.renderAll();u()},onComplete:function(){n.setCoords();r()}}),this},fxRemove:function(n,t){t=t||{};var i=function(){},u=t.onComplete||i,f=t.onChange||i,r=this;return fabric.util.animate({startValue:n.get("opacity"),endValue:0,duration:this.FX_DURATION,onStart:function(){n.set("active",!1)},onChange:function(t){n.set("opacity",t);r.renderAll();f()},onComplete:function(){r.remove(n);u()}}),this}});fabric.util.object.extend(fabric.Object.prototype,{animate:function(){var i,n,u,t,r;if(arguments[0]&&typeof arguments[0]=="object"){i=[];for(n in arguments[0])i.push(n);for(t=0,r=i.length;t<r;t++)n=i[t],u=t!==r-1,this._animate(n,arguments[0][n],arguments[1],u)}else this._animate.apply(this,arguments);return this},_animate:function(n,t,i,r){var f=this,u,e;t=t.toString();i=i?fabric.util.object.clone(i):{};~n.indexOf(".")&&(u=n.split("."));e=u?this.get(u[0])[u[1]]:this.get(n);"from"in i||(i.from=e);t=~t.indexOf("=")?e+parseFloat(t.replace("=","")):parseFloat(t);fabric.util.animate({startValue:i.from,endValue:t,byValue:i.by,easing:i.easing,duration:i.duration,abort:i.abort&&function(){return i.abort.call(f)},onChange:function(t){(u?f[u[0]][u[1]]=t:f.set(n,t),r)||i.onChange&&i.onChange()},onComplete:function(){r||(f.setCoords(),i.onComplete&&i.onComplete())}})}}),function(n){"use strict";function i(n,t){var u=n.origin,i=n.axis1,r=n.axis2,f=n.dimension,e=t.nearest,o=t.center,s=t.farthest;return function(){switch(this.get(u)){case e:return Math.min(this.get(i),this.get(r));case o:return Math.min(this.get(i),this.get(r))+.5*this.get(f);case s:return Math.max(this.get(i),this.get(r))}}}var t=n.fabric||(n.fabric={}),r=t.util.object.extend,u={x1:1,x2:1,y1:1,y2:1},f=t.StaticCanvas.supports("setLineDash");if(t.Line){t.warn("fabric.Line is already defined");return}t.Line=t.util.createClass(t.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,initialize:function(n,t){t=t||{};n||(n=[0,0,0,0]);this.callSuper("initialize",t);this.set("x1",n[0]);this.set("y1",n[1]);this.set("x2",n[2]);this.set("y2",n[3]);this._setWidthHeight(t)},_setWidthHeight:function(n){n||(n={});this.width=Math.abs(this.x2-this.x1);this.height=Math.abs(this.y2-this.y1);this.left="left"in n?n.left:this._getLeftToOriginX();this.top="top"in n?n.top:this._getTopToOriginY()},_set:function(n,t){return this.callSuper("_set",n,t),typeof u[n]!="undefined"&&this._setWidthHeight(),this},_getLeftToOriginX:i({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:i({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(n,t){var r,i,u;n.beginPath();t&&(r=this.getCenterPoint(),n.translate(r.x-this.strokeWidth/2,r.y-this.strokeWidth/2));(!this.strokeDashArray||this.strokeDashArray&&f)&&(i=this.calcLinePoints(),n.moveTo(i.x1,i.y1),n.lineTo(i.x2,i.y2));n.lineWidth=this.strokeWidth;u=n.strokeStyle;n.strokeStyle=this.stroke||n.fillStyle;this.stroke&&this._renderStroke(n);n.strokeStyle=u},_renderDashedStroke:function(n){var i=this.calcLinePoints();n.beginPath();t.util.drawDashedLine(n,i.x1,i.y1,i.x2,i.y2,this.strokeDashArray);n.closePath()},toObject:function(n){return r(this.callSuper("toObject",n),this.calcLinePoints())},calcLinePoints:function(){var n=this.x1<=this.x2?-1:1,t=this.y1<=this.y2?-1:1,i=n*this.width*.5,r=t*this.height*.5,u=n*this.width*-.5,f=t*this.height*-.5;return{x1:i,x2:u,y1:r,y2:f}},toSVG:function(n){var i=this._createBaseSVGMarkup(),t={x1:this.x1,x2:this.x2,y1:this.y1,y2:this.y2};return this.group&&this.group.type==="path-group"||(t=this.calcLinePoints()),i.push("<line ",'x1="',t.x1,'" y1="',t.y1,'" x2="',t.x2,'" y2="',t.y2,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n'),n?n(i.join("")):i.join("")},complexity:function(){return 1}});t.Line.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" "));t.Line.fromElement=function(n,i){var u=t.parseAttributes(n,t.Line.ATTRIBUTE_NAMES),f=[u.x1||0,u.y1||0,u.x2||0,u.y2||0];return new t.Line(f,r(u,i))};t.Line.fromObject=function(n){var i=[n.x1,n.y1,n.x2,n.y2];return new t.Line(i,n)}}(typeof exports!="undefined"?exports:undefined),function(n){"use strict";function u(n){return"radius"in n&&n.radius>0}var t=n.fabric||(n.fabric={}),i=Math.PI,r=t.util.object.extend;if(t.Circle){t.warn("fabric.Circle is already defined.");return}t.Circle=t.util.createClass(t.Object,{type:"circle",radius:0,startAngle:0,endAngle:i*2,initialize:function(n){n=n||{};this.callSuper("initialize",n);this.set("radius",n.radius||0);this.startAngle=n.startAngle||this.startAngle;this.endAngle=n.endAngle||this.endAngle},_set:function(n,t){return this.callSuper("_set",n,t),n==="radius"&&this.setRadius(t),this},toObject:function(n){return r(this.callSuper("toObject",n),{radius:this.get("radius"),startAngle:this.startAngle,endAngle:this.endAngle})},toSVG:function(n){var t=this._createBaseSVGMarkup(),r=0,u=0,f=(this.endAngle-this.startAngle)%(2*i);if(f===0)this.group&&this.group.type==="path-group"&&(r=this.left+this.radius,u=this.top+this.radius),t.push("<circle ",'cx="'+r+'" cy="'+u+'" ','r="',this.radius,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n');else{var e=Math.cos(this.startAngle)*this.radius,o=Math.sin(this.startAngle)*this.radius,s=Math.cos(this.endAngle)*this.radius,h=Math.sin(this.endAngle)*this.radius,c=f>i?"1":"0";t.push('<path d="M '+e+" "+o," A "+this.radius+" "+this.radius," 0 ",+c+" 1"," "+s+" "+h,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n')}return n?n(t.join("")):t.join("")},_render:function(n,t){n.beginPath();n.arc(t?this.left+this.radius:0,t?this.top+this.radius:0,this.radius,this.startAngle,this.endAngle,!1);this._renderFill(n);this._renderStroke(n)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(n){this.radius=n;this.set("width",n*2).set("height",n*2)},complexity:function(){return 1}});t.Circle.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("cx cy r".split(" "));t.Circle.fromElement=function(n,i){var f,e;if(i||(i={}),f=t.parseAttributes(n,t.Circle.ATTRIBUTE_NAMES),!u(f))throw new Error("value of `r` attribute is required and can not be negative");return f.left=f.left||0,f.top=f.top||0,e=new t.Circle(r(f,i)),e.left-=e.radius,e.top-=e.radius,e};t.Circle.fromObject=function(n){return new t.Circle(n)}}(typeof exports!="undefined"?exports:undefined),function(n){"use strict";var t=n.fabric||(n.fabric={});if(t.Triangle){t.warn("fabric.Triangle is already defined");return}t.Triangle=t.util.createClass(t.Object,{type:"triangle",initialize:function(n){n=n||{};this.callSuper("initialize",n);this.set("width",n.width||100).set("height",n.height||100)},_render:function(n){var i=this.width/2,t=this.height/2;n.beginPath();n.moveTo(-i,t);n.lineTo(0,-t);n.lineTo(i,t);n.closePath();this._renderFill(n);this._renderStroke(n)},_renderDashedStroke:function(n){var r=this.width/2,i=this.height/2;n.beginPath();t.util.drawDashedLine(n,-r,i,0,-i,this.strokeDashArray);t.util.drawDashedLine(n,0,-i,r,i,this.strokeDashArray);t.util.drawDashedLine(n,r,i,-r,i,this.strokeDashArray);n.closePath()},toSVG:function(n){var t=this._createBaseSVGMarkup(),r=this.width/2,i=this.height/2,u=[-r+" "+i,"0 "+-i,r+" "+i].join(",");return t.push("<polygon ",'points="',u,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>'),n?n(t.join("")):t.join("")},complexity:function(){return 1}});t.Triangle.fromObject=function(n){return new t.Triangle(n)}}(typeof exports!="undefined"?exports:undefined),function(n){"use strict";var t=n.fabric||(n.fabric={}),r=Math.PI*2,i=t.util.object.extend;if(t.Ellipse){t.warn("fabric.Ellipse is already defined.");return}t.Ellipse=t.util.createClass(t.Object,{type:"ellipse",rx:0,ry:0,initialize:function(n){n=n||{};this.callSuper("initialize",n);this.set("rx",n.rx||0);this.set("ry",n.ry||0)},_set:function(n,t){this.callSuper("_set",n,t);switch(n){case"rx":this.rx=t;this.set("width",t*2);break;case"ry":this.ry=t;this.set("height",t*2)}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(n){return i(this.callSuper("toObject",n),{rx:this.get("rx"),ry:this.get("ry")})},toSVG:function(n){var t=this._createBaseSVGMarkup(),i=0,r=0;return this.group&&this.group.type==="path-group"&&(i=this.left+this.rx,r=this.top+this.ry),t.push("<ellipse ",'cx="',i,'" cy="',r,'" ','rx="',this.rx,'" ry="',this.ry,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n'),n?n(t.join("")):t.join("")},_render:function(n,t){n.beginPath();n.save();n.transform(1,0,0,this.ry/this.rx,0,0);n.arc(t?this.left+this.rx:0,t?(this.top+this.ry)*this.rx/this.ry:0,this.rx,0,r,!1);n.restore();this._renderFill(n);this._renderStroke(n)},complexity:function(){return 1}});t.Ellipse.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" "));t.Ellipse.fromElement=function(n,r){var u,f;return r||(r={}),u=t.parseAttributes(n,t.Ellipse.ATTRIBUTE_NAMES),u.left=u.left||0,u.top=u.top||0,f=new t.Ellipse(i(u,r)),f.top-=f.ry,f.left-=f.rx,f};t.Ellipse.fromObject=function(n){return new t.Ellipse(n)}}(typeof exports!="undefined"?exports:undefined),function(n){"use strict";var t=n.fabric||(n.fabric={}),r=t.util.object.extend,i;if(t.Rect){console.warn("fabric.Rect is already defined");return}i=t.Object.prototype.stateProperties.concat();i.push("rx","ry","x","y");t.Rect=t.util.createClass(t.Object,{stateProperties:i,type:"rect",rx:0,ry:0,strokeDashArray:null,initialize:function(n){n=n||{};this.callSuper("initialize",n);this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(n,t){if(this.width===1&&this.height===1){n.fillRect(0,0,1,1);return}var u=this.rx?Math.min(this.rx,this.width/2):0,f=this.ry?Math.min(this.ry,this.height/2):0,e=this.width,o=this.height,i=t?this.left:-this.width/2,r=t?this.top:-this.height/2,h=u!==0||f!==0,s=.4477152502;n.beginPath();n.moveTo(i+u,r);n.lineTo(i+e-u,r);h&&n.bezierCurveTo(i+e-s*u,r,i+e,r+s*f,i+e,r+f);n.lineTo(i+e,r+o-f);h&&n.bezierCurveTo(i+e,r+o-s*f,i+e-s*u,r+o,i+e-u,r+o);n.lineTo(i+u,r+o);h&&n.bezierCurveTo(i+s*u,r+o,i,r+o-s*f,i,r+o-f);n.lineTo(i,r+f);h&&n.bezierCurveTo(i,r+s*f,i+s*u,r,i+u,r);n.closePath();this._renderFill(n);this._renderStroke(n)},_renderDashedStroke:function(n){var i=-this.width/2,r=-this.height/2,u=this.width,f=this.height;n.beginPath();t.util.drawDashedLine(n,i,r,i+u,r,this.strokeDashArray);t.util.drawDashedLine(n,i+u,r,i+u,r+f,this.strokeDashArray);t.util.drawDashedLine(n,i+u,r+f,i,r+f,this.strokeDashArray);t.util.drawDashedLine(n,i,r+f,i,r,this.strokeDashArray);n.closePath()},toObject:function(n){var t=r(this.callSuper("toObject",n),{rx:this.get("rx")||0,ry:this.get("ry")||0});return this.includeDefaultValues||this._removeDefaultValues(t),t},toSVG:function(n){var t=this._createBaseSVGMarkup(),i=this.left,r=this.top;return this.group&&this.group.type==="path-group"||(i=-this.width/2,r=-this.height/2),t.push("<rect ",'x="',i,'" y="',r,'" rx="',this.get("rx"),'" ry="',this.get("ry"),'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n'),n?n(t.join("")):t.join("")},complexity:function(){return 1}});t.Rect.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" "));t.Rect.fromElement=function(n,i){if(!n)return null;i=i||{};var u=t.parseAttributes(n,t.Rect.ATTRIBUTE_NAMES);return u.left=u.left||0,u.top=u.top||0,new t.Rect(r(i?t.util.object.clone(i):{},u))};t.Rect.fromObject=function(n){return new t.Rect(n)}}(typeof exports!="undefined"?exports:undefined),function(n){"use strict";var t=n.fabric||(n.fabric={});if(t.Polyline){t.warn("fabric.Polyline is already defined");return}t.Polyline=t.util.createClass(t.Object,{type:"polyline",points:null,minX:0,minY:0,initialize:function(n,i){return t.Polygon.prototype.initialize.call(this,n,i)},_calcDimensions:function(){return t.Polygon.prototype._calcDimensions.call(this)},_applyPointOffset:function(){return t.Polygon.prototype._applyPointOffset.call(this)},toObject:function(n){return t.Polygon.prototype.toObject.call(this,n)},toSVG:function(n){return t.Polygon.prototype.toSVG.call(this,n)},_render:function(n){t.Polygon.prototype.commonRender.call(this,n);this._renderFill(n);this._renderStroke(n)},_renderDashedStroke:function(n){var r,u,i,f;for(n.beginPath(),i=0,f=this.points.length;i<f;i++)r=this.points[i],u=this.points[i+1]||r,t.util.drawDashedLine(n,r.x,r.y,u.x,u.y,this.strokeDashArray)},complexity:function(){return this.get("points").length}});t.Polyline.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat();t.Polyline.fromElement=function(n,i){if(!n)return null;i||(i={});var r=t.parsePointsAttribute(n.getAttribute("points")),u=t.parseAttributes(n,t.Polyline.ATTRIBUTE_NAMES);return r===null?null:new t.Polyline(r,t.util.object.extend(u,i))};t.Polyline.fromObject=function(n){var i=n.points;return new t.Polyline(i,n,!0)}}(typeof exports!="undefined"?exports:undefined),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.object.extend,r=t.util.array.min,u=t.util.array.max,f=t.util.toFixed;if(t.Polygon){t.warn("fabric.Polygon is already defined");return}t.Polygon=t.util.createClass(t.Object,{type:"polygon",points:null,minX:0,minY:0,initialize:function(n,t){t=t||{};this.points=n;this.callSuper("initialize",t);this._calcDimensions();"top"in t||(this.top=this.minY);"left"in t||(this.left=this.minX)},_calcDimensions:function(){var n=this.points,t=r(n,"x"),i=r(n,"y"),f=u(n,"x"),e=u(n,"y");this.width=f-t||1;this.height=e-i||1;this.minX=t;this.minY=i},_applyPointOffset:function(){this.points.forEach(function(n){n.x-=this.minX+this.width/2;n.y-=this.minY+this.height/2},this)},toObject:function(n){return i(this.callSuper("toObject",n),{points:this.points.concat()})},toSVG:function(n){for(var r=[],i=this._createBaseSVGMarkup(),t=0,u=this.points.length;t<u;t++)r.push(f(this.points[t].x,2),",",f(this.points[t].y,2)," ");return i.push("<",this.type," ",'points="',r.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n'),n?n(i.join("")):i.join("")},_render:function(n){this.commonRender(n);this._renderFill(n);(this.stroke||this.strokeDashArray)&&(n.closePath(),this._renderStroke(n))},commonRender:function(n){var i,t,r;for(n.beginPath(),this._applyPointOffset&&((!this.group||this.group.type!=="path-group")&&this._applyPointOffset(),this._applyPointOffset=null),n.moveTo(this.points[0].x,this.points[0].y),t=0,r=this.points.length;t<r;t++)i=this.points[t],n.lineTo(i.x,i.y)},_renderDashedStroke:function(n){t.Polyline.prototype._renderDashedStroke.call(this,n);n.closePath()},complexity:function(){return this.points.length}});t.Polygon.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat();t.Polygon.fromElement=function(n,r){if(!n)return null;r||(r={});var u=t.parsePointsAttribute(n.getAttribute("points")),f=t.parseAttributes(n,t.Polygon.ATTRIBUTE_NAMES);return u===null?null:new t.Polygon(u,i(f,r))};t.Polygon.fromObject=function(n){return new t.Polygon(n.points,n,!0)}}(typeof exports!="undefined"?exports:undefined),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.array.min,r=t.util.array.max,u=t.util.object.extend,e=Object.prototype.toString,f=t.util.drawArc,o={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},s={m:"l",M:"L"};if(t.Path){t.warn("fabric.Path is already defined");return}t.Path=t.util.createClass(t.Object,{type:"path",path:null,minX:0,minY:0,initialize:function(n,t){var r,i;if(t=t||{},this.setOptions(t),!n)throw new Error("`path` argument is required");(r=e.call(n)==="[object Array]",this.path=r?n:n.match&&n.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi),this.path)&&(r||(this.path=this._parsePath()),i=this._parseDimensions(),this.minX=i.left,this.minY=i.top,this.width=i.width,this.height=i.height,i.left+=this.originX==="center"?this.width/2:this.originX==="right"?this.width:0,i.top+=this.originY==="center"?this.height/2:this.originY==="bottom"?this.height:0,this.top=this.top||i.top,this.left=this.left||i.left,this.pathOffset=this.pathOffset||{x:this.minX+this.width/2,y:this.minY+this.height/2},t.sourcePath&&this.setSourcePath(t.sourcePath))},_render:function(n){var t,l=null,v=0,y=0,i=0,r=0,o=0,s=0,h,c,p,w,u=-this.pathOffset.x,e=-this.pathOffset.y,a,b;for(this.group&&this.group.type==="path-group"&&(u=0,e=0),n.beginPath(),a=0,b=this.path.length;a<b;++a){t=this.path[a];switch(t[0]){case"l":i+=t[1];r+=t[2];n.lineTo(i+u,r+e);break;case"L":i=t[1];r=t[2];n.lineTo(i+u,r+e);break;case"h":i+=t[1];n.lineTo(i+u,r+e);break;case"H":i=t[1];n.lineTo(i+u,r+e);break;case"v":r+=t[1];n.lineTo(i+u,r+e);break;case"V":r=t[1];n.lineTo(i+u,r+e);break;case"m":i+=t[1];r+=t[2];v=i;y=r;n.moveTo(i+u,r+e);break;case"M":i=t[1];r=t[2];v=i;y=r;n.moveTo(i+u,r+e);break;case"c":h=i+t[5];c=r+t[6];o=i+t[3];s=r+t[4];n.bezierCurveTo(i+t[1]+u,r+t[2]+e,o+u,s+e,h+u,c+e);i=h;r=c;break;case"C":i=t[5];r=t[6];o=t[3];s=t[4];n.bezierCurveTo(t[1]+u,t[2]+e,o+u,s+e,i+u,r+e);break;case"s":h=i+t[3];c=r+t[4];o=o?2*i-o:i;s=s?2*r-s:r;n.bezierCurveTo(o+u,s+e,i+t[1]+u,r+t[2]+e,h+u,c+e);o=i+t[1];s=r+t[2];i=h;r=c;break;case"S":h=t[3];c=t[4];o=2*i-o;s=2*r-s;n.bezierCurveTo(o+u,s+e,t[1]+u,t[2]+e,h+u,c+e);i=h;r=c;o=t[1];s=t[2];break;case"q":h=i+t[3];c=r+t[4];o=i+t[1];s=r+t[2];n.quadraticCurveTo(o+u,s+e,h+u,c+e);i=h;r=c;break;case"Q":h=t[3];c=t[4];n.quadraticCurveTo(t[1]+u,t[2]+e,h+u,c+e);i=h;r=c;o=t[1];s=t[2];break;case"t":h=i+t[1];c=r+t[2];l[0].match(/[QqTt]/)===null?(o=i,s=r):l[0]==="t"?(o=2*i-p,s=2*r-w):l[0]==="q"&&(o=2*i-o,s=2*r-s);p=o;w=s;n.quadraticCurveTo(o+u,s+e,h+u,c+e);i=h;r=c;o=i+t[1];s=r+t[2];break;case"T":h=t[1];c=t[2];o=2*i-o;s=2*r-s;n.quadraticCurveTo(o+u,s+e,h+u,c+e);i=h;r=c;break;case"a":f(n,i+u,r+e,[t[1],t[2],t[3],t[4],t[5],t[6]+i+u,t[7]+r+e]);i+=t[6];r+=t[7];break;case"A":f(n,i+u,r+e,[t[1],t[2],t[3],t[4],t[5],t[6]+u,t[7]+e]);i=t[6];r=t[7];break;case"z":case"Z":i=v;r=y;n.closePath()}l=t}this._renderFill(n);this._renderStroke(n)},render:function(n,i){this.visible&&(n.save(),this._setupCompositeOperation(n),i||this.transform(n),this._setStrokeStyles(n),this._setFillStyles(n),this.group&&this.group.type==="path-group"&&n.translate(-this.group.width/2,-this.group.height/2),this.transformMatrix&&n.transform.apply(n,this.transformMatrix),this._setOpacity(n),this._setShadow(n),this.clipTo&&t.util.clipContext(this,n),this._render(n,i),this.clipTo&&n.restore(),this._removeShadow(n),this._restoreCompositeOperation(n),n.restore())},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(n){var t=u(this.callSuper("toObject",n),{path:this.path.map(function(n){return n.slice()}),pathOffset:this.pathOffset});return this.sourcePath&&(t.sourcePath=this.sourcePath),this.transformMatrix&&(t.transformMatrix=this.transformMatrix),t},toDatalessObject:function(n){var t=this.toObject(n);return this.sourcePath&&(t.path=this.sourcePath),delete t.sourcePath,t},toSVG:function(n){for(var f,r=[],t=this._createBaseSVGMarkup(),u="",i=0,e=this.path.length;i<e;i++)r.push(this.path[i].join(" "));return f=r.join(" "),this.group&&this.group.type==="path-group"||(u="translate("+-this.pathOffset.x+", "+-this.pathOffset.y+")"),t.push("<path ",'d="',f,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),u,this.getSvgTransformMatrix(),'" stroke-linecap="round" ',"/>\n"),n?n(t.join("")):t.join("")},complexity:function(){return this.path.length},_parsePath:function(){for(var u,y,i,p,f=[],r=[],e,h,w=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/ig,a,v,c=0,n,b=this.path.length;c<b;c++){for(e=this.path[c],v=e.slice(1).trim(),r.length=0;a=w.exec(v);)r.push(a[0]);for(n=[e.charAt(0)],u=0,y=r.length;u<y;u++)h=parseFloat(r[u]),isNaN(h)||n.push(h);var t=n[0],l=o[t.toLowerCase()],k=s[t]||t;if(n.length-1>l)for(i=1,p=n.length;i<p;i+=l)f.push([t].concat(n.slice(i,i+l))),t=k;else f.push(n)}return f},_parseDimensions:function(){for(var l=[],a=[],n,v=null,y=0,p=0,u=0,f=0,e=0,o=0,h,c,b,k,s,w=0,nt=this.path.length;w<nt;++w){n=this.path[w];switch(n[0]){case"l":u+=n[1];f+=n[2];s=[];break;case"L":u=n[1];f=n[2];s=[];break;case"h":u+=n[1];s=[];break;case"H":u=n[1];s=[];break;case"v":f+=n[1];s=[];break;case"V":f=n[1];s=[];break;case"m":u+=n[1];f+=n[2];y=u;p=f;s=[];break;case"M":u=n[1];f=n[2];y=u;p=f;s=[];break;case"c":h=u+n[5];c=f+n[6];e=u+n[3];o=f+n[4];s=t.util.getBoundsOfCurve(u,f,u+n[1],f+n[2],e,o,h,c);u=h;f=c;break;case"C":u=n[5];f=n[6];e=n[3];o=n[4];s=t.util.getBoundsOfCurve(u,f,n[1],n[2],e,o,u,f);break;case"s":h=u+n[3];c=f+n[4];e=e?2*u-e:u;o=o?2*f-o:f;s=t.util.getBoundsOfCurve(u,f,e,o,u+n[1],f+n[2],h,c);e=u+n[1];o=f+n[2];u=h;f=c;break;case"S":h=n[3];c=n[4];e=2*u-e;o=2*f-o;s=t.util.getBoundsOfCurve(u,f,e,o,n[1],n[2],h,c);u=h;f=c;e=n[1];o=n[2];break;case"q":h=u+n[3];c=f+n[4];e=u+n[1];o=f+n[2];s=t.util.getBoundsOfCurve(u,f,e,o,e,o,h,c);u=h;f=c;break;case"Q":e=n[1];o=n[2];s=t.util.getBoundsOfCurve(u,f,e,o,e,o,n[3],n[4]);u=n[3];f=n[4];break;case"t":h=u+n[1];c=f+n[2];v[0].match(/[QqTt]/)===null?(e=u,o=f):v[0]==="t"?(e=2*u-b,o=2*f-k):v[0]==="q"&&(e=2*u-e,o=2*f-o);b=e;k=o;s=t.util.getBoundsOfCurve(u,f,e,o,e,o,h,c);u=h;f=c;e=u+n[1];o=f+n[2];break;case"T":h=n[1];c=n[2];e=2*u-e;o=2*f-o;s=t.util.getBoundsOfCurve(u,f,e,o,e,o,h,c);u=h;f=c;break;case"a":s=t.util.getBoundsOfArc(u,f,n[1],n[2],n[3],n[4],n[5],n[6]+u,n[7]+f);u+=n[6];f+=n[7];break;case"A":s=t.util.getBoundsOfArc(u,f,n[1],n[2],n[3],n[4],n[5],n[6],n[7]);u=n[6];f=n[7];break;case"z":case"Z":u=y;f=p}v=n;s.forEach(function(n){l.push(n.x);a.push(n.y)});l.push(u);a.push(f)}var d=i(l),g=i(a),tt=r(l),it=r(a),rt=tt-d,ut=it-g;return{left:d,top:g,width:rt,height:ut}}});t.Path.fromObject=function(n,i){typeof n.path=="string"?t.loadSVGFromURL(n.path,function(r){var u=r[0],f=n.path;delete n.path;t.util.object.extend(u,n);u.setSourcePath(f);i(u)}):i(new t.Path(n.path,n))};t.Path.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat(["d"]);t.Path.fromElement=function(n,i,r){var f=t.parseAttributes(n,t.Path.ATTRIBUTE_NAMES);i&&i(new t.Path(f.d,u(f,r)))};t.Path.async=!0}(typeof exports!="undefined"?exports:undefined),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.object.extend,r=t.util.array.invoke,u=t.Object.prototype.toObject;if(t.PathGroup){t.warn("fabric.PathGroup is already defined");return}t.PathGroup=t.util.createClass(t.Path,{type:"path-group",fill:"",initialize:function(n,t){t=t||{};this.paths=n||[];for(var i=this.paths.length;i--;)this.paths[i].group=this;this.setOptions(t);t.widthAttr&&(this.scaleX=t.widthAttr/t.width);t.heightAttr&&(this.scaleY=t.heightAttr/t.height);this.setCoords();t.sourcePath&&this.setSourcePath(t.sourcePath)},render:function(n){var i,r,u;if(this.visible){for(n.save(),i=this.transformMatrix,i&&n.transform(i[0],i[1],i[2],i[3],i[4],i[5]),this.transform(n),this._setShadow(n),this.clipTo&&t.util.clipContext(this,n),r=0,u=this.paths.length;r<u;++r)this.paths[r].render(n,!0);this.clipTo&&n.restore();this._removeShadow(n);n.restore()}},_set:function(n,t){if(n==="fill"&&t&&this.isSameColor())for(var i=this.paths.length;i--;)this.paths[i]._set(n,t);return this.callSuper("_set",n,t)},toObject:function(n){var t=i(u.call(this,n),{paths:r(this.getObjects(),"toObject",n)});return this.sourcePath&&(t.sourcePath=this.sourcePath),t},toDatalessObject:function(n){var t=this.toObject(n);return this.sourcePath&&(t.paths=this.sourcePath),t},toSVG:function(n){for(var r=this.getObjects(),u="translate("+this.left+" "+this.top+")",t=["<g ",'style="',this.getSvgStyles(),'" ','transform="',u,this.getSvgTransform(),'" ',">\n"],i=0,f=r.length;i<f;i++)t.push(r[i].toSVG(n));return t.push("<\/g>\n"),n?n(t.join("")):t.join("")},toString:function(){return"#<fabric.PathGroup ("+this.complexity()+"): { top: "+this.top+", left: "+this.left+" }>"},isSameColor:function(){var n=(this.getObjects()[0].get("fill")||"").toLowerCase();return this.getObjects().every(function(t){return(t.get("fill")||"").toLowerCase()===n})},complexity:function(){return this.paths.reduce(function(n,t){return n+(t&&t.complexity?t.complexity():0)},0)},getObjects:function(){return this.paths}});t.PathGroup.fromObject=function(n,i){typeof n.paths=="string"?t.loadSVGFromURL(n.paths,function(r){var f=n.paths,u;delete n.paths;u=t.util.groupSVGElements(r,n,f);i(u)}):t.util.enlivenObjects(n.paths,function(r){delete n.paths;i(new t.PathGroup(r,n))})};t.PathGroup.async=!0}(typeof exports!="undefined"?exports:undefined),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.object.extend,r=t.util.array.min,u=t.util.array.max,e=t.util.array.invoke,f;t.Group||(f={lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0},t.Group=t.util.createClass(t.Object,t.Collection,{type:"group",initialize:function(n,t){t=t||{};this._objects=n||[];for(var r=this._objects.length;r--;)this._objects[r].group=this;this.originalState={};this.callSuper("initialize");t.originX&&(this.originX=t.originX);t.originY&&(this.originY=t.originY);this._calcBounds();this._updateObjectsCoords();t&&i(this,t);this.setCoords();this.saveCoords()},_updateObjectsCoords:function(){this.forEachObject(this._updateObjectCoords,this)},_updateObjectCoords:function(n){var t=n.getLeft(),i=n.getTop(),r=this.getCenterPoint();n.set({originalLeft:t,originalTop:i,left:t-r.x,top:i-r.y});n.setCoords();n.__origHasControls=n.hasControls;n.hasControls=!1},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(n){return this._restoreObjectsState(),n&&(this._objects.push(n),n.group=this),this.forEachObject(this._setObjectActive,this),this._calcBounds(),this._updateObjectsCoords(),this},_setObjectActive:function(n){n.set("active",!0);n.group=this},removeWithUpdate:function(n){return this._moveFlippedObject(n),this._restoreObjectsState(),this.forEachObject(this._setObjectActive,this),this.remove(n),this._calcBounds(),this._updateObjectsCoords(),this},_onObjectAdded:function(n){n.group=this},_onObjectRemoved:function(n){delete n.group;n.set("active",!1)},delegatedProperties:{fill:!0,opacity:!0,fontFamily:!0,fontWeight:!0,fontSize:!0,fontStyle:!0,lineHeight:!0,textDecoration:!0,textAlign:!0,backgroundColor:!0},_set:function(n,t){if(n in this.delegatedProperties){var i=this._objects.length;for(this[n]=t;i--;)this._objects[i].set(n,t)}else this[n]=t},toObject:function(n){return i(this.callSuper("toObject",n),{objects:e(this._objects,"toObject",n)})},render:function(n){if(this.visible){n.save();this.clipTo&&t.util.clipContext(this,n);for(var i=0,r=this._objects.length;i<r;i++)this._renderObject(this._objects[i],n);this.clipTo&&n.restore();n.restore()}},_renderControls:function(n,t){this.callSuper("_renderControls",n,t);for(var i=0,r=this._objects.length;i<r;i++)this._objects[i]._renderControls(n)},_renderObject:function(n,t){var i=n.hasRotatingPoint;n.visible&&(n.hasRotatingPoint=!1,n.render(t),n.hasRotatingPoint=i)},_restoreObjectsState:function(){return this._objects.forEach(this._restoreObjectState,this),this},_moveFlippedObject:function(n){var i=n.get("originX"),r=n.get("originY"),u=n.getCenterPoint(),t;return n.set({originX:"center",originY:"center",left:u.x,top:u.y}),this._toggleFlipping(n),t=n.getPointByOrigin(i,r),n.set({originX:i,originY:r,left:t.x,top:t.y}),this},_toggleFlipping:function(n){this.flipX&&(n.toggle("flipX"),n.set("left",-n.get("left")),n.setAngle(-n.getAngle()));this.flipY&&(n.toggle("flipY"),n.set("top",-n.get("top")),n.setAngle(-n.getAngle()))},_restoreObjectState:function(n){return this._setObjectPosition(n),n.setCoords(),n.hasControls=n.__origHasControls,delete n.__origHasControls,n.set("active",!1),n.setCoords(),delete n.group,this},_setObjectPosition:function(n){var t=this.getCenterPoint(),i=this._getRotatedLeftTop(n);n.set({angle:n.getAngle()+this.getAngle(),left:t.x+i.left,top:t.y+i.top,scaleX:n.get("scaleX")*this.get("scaleX"),scaleY:n.get("scaleY")*this.get("scaleY")})},_getRotatedLeftTop:function(n){var t=this.getAngle()*(Math.PI/180);return{left:-Math.sin(t)*n.getTop()*this.get("scaleY")+Math.cos(t)*n.getLeft()*this.get("scaleX"),top:Math.cos(t)*n.getTop()*this.get("scaleY")+Math.sin(t)*n.getLeft()*this.get("scaleX")}},destroy:function(){return this._objects.forEach(this._moveFlippedObject,this),this._restoreObjectsState()},saveCoords:function(){return this._originalLeft=this.get("left"),this._originalTop=this.get("top"),this},hasMoved:function(){return this._originalLeft!==this.get("left")||this._originalTop!==this.get("top")},setObjectsCoords:function(){return this.forEachObject(function(n){n.setCoords()}),this},_calcBounds:function(n){for(var r,u=[],f=[],t,i=0,e=this._objects.length;i<e;++i){t=this._objects[i];t.setCoords();for(r in t.oCoords)u.push(t.oCoords[r].x),f.push(t.oCoords[r].y)}this.set(this._getBounds(u,f,n))},_getBounds:function(n,i,f){var s=t.util.invertTransform(this.getViewportTransform()),o=t.util.transformPoint(new t.Point(r(n),r(i)),s),h=t.util.transformPoint(new t.Point(u(n),u(i)),s),e={width:h.x-o.x||0,height:h.y-o.y||0};return f||(e.left=o.x||0,e.top=o.y||0,this.originX==="center"&&(e.left+=e.width/2),this.originX==="right"&&(e.left+=e.width),this.originY==="center"&&(e.top+=e.height/2),this.originY==="bottom"&&(e.top+=e.height)),e},toSVG:function(n){for(var t=["<g ",'transform="',this.getSvgTransform(),'">\n'],i=0,r=this._objects.length;i<r;i++)t.push(this._objects[i].toSVG(n));return t.push("<\/g>\n"),n?n(t.join("")):t.join("")},get:function(n){if(n in f){if(this[n])return this[n];for(var t=0,i=this._objects.length;t<i;t++)if(this._objects[t][n])return!0;return!1}return n in this.delegatedProperties?this._objects[0]&&this._objects[0].get(n):this[n]}}),t.Group.fromObject=function(n,i){t.util.enlivenObjects(n.objects,function(r){delete n.objects;i&&i(new t.Group(r,n))})},t.Group.async=!0)}(typeof exports!="undefined"?exports:undefined),function(n){"use strict";var t=fabric.util.object.extend;if(n.fabric||(n.fabric={}),n.fabric.Image){fabric.warn("fabric.Image is already defined.");return}fabric.Image=fabric.util.createClass(fabric.Object,{type:"image",crossOrigin:"",alignX:"none",alignY:"none",meetOrSlice:"meet",_lastScaleX:1,_lastScaleY:1,initialize:function(n,t){t||(t={});this.filters=[];this.resizeFilters=[];this.callSuper("initialize",t);this._initElement(n,t);this._initConfig(t);t.filters&&(this.filters=t.filters,this.applyFilters())},getElement:function(){return this._element},setElement:function(n,t,i){return this._element=n,this._originalElement=n,this._initConfig(i),this.filters.length!==0?this.applyFilters(t):t&&t(),this},setCrossOrigin:function(n){return this.crossOrigin=n,this._element.crossOrigin=n,this},getOriginalSize:function(){var n=this.getElement();return{width:n.width,height:n.height}},_stroke:function(n){n.save();this._setStrokeStyles(n);n.beginPath();n.strokeRect(-this.width/2,-this.height/2,this.width,this.height);n.closePath();n.restore()},_renderDashedStroke:function(n){var t=-this.width/2,i=-this.height/2,r=this.width,u=this.height;n.save();this._setStrokeStyles(n);n.beginPath();fabric.util.drawDashedLine(n,t,i,t+r,i,this.strokeDashArray);fabric.util.drawDashedLine(n,t+r,i,t+r,i+u,this.strokeDashArray);fabric.util.drawDashedLine(n,t+r,i+u,t,i+u,this.strokeDashArray);fabric.util.drawDashedLine(n,t,i+u,t,i,this.strokeDashArray);n.closePath();n.restore()},toObject:function(n){return t(this.callSuper("toObject",n),{src:this._originalElement.src||this._originalElement._src,filters:this.filters.map(function(n){return n&&n.toObject()}),crossOrigin:this.crossOrigin,alignX:this.alignX,alignY:this.alignY,meetOrSlice:this.meetOrSlice})},toSVG:function(n){var t=[],i=-this.width/2,r=-this.height/2,u="none",f;return this.group&&this.group.type==="path-group"&&(i=this.left,r=this.top),this.alignX!=="none"&&this.alignY!=="none"&&(u="x"+this.alignX+"Y"+this.alignY+" "+this.meetOrSlice),t.push('<g transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'">\n','<image xlink:href="',this.getSvgSrc(),'" x="',i,'" y="',r,'" style="',this.getSvgStyles(),'" width="',this.width,'" height="',this.height,'" preserveAspectRatio="',u,'"',"><\/image>\n"),(this.stroke||this.strokeDashArray)&&(f=this.fill,this.fill=null,t.push("<rect ",'x="',i,'" y="',r,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>\n'),this.fill=f),t.push("<\/g>\n"),n?n(t.join("")):t.join("")},getSrc:function(){if(this.getElement())return this.getElement().src||this.getElement()._src},setSrc:function(n,t,i){fabric.util.loadImage(n,function(n){return this.setElement(n,t,i)},this,i&&i.crossOrigin)},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},clone:function(n,t){this.constructor.fromObject(this.toObject(t),n)},applyFilters:function(n,t,i,r){if(t=t||this.filters,i=i||this._originalElement,i){var o=i,u=fabric.util.createCanvasElement(),f=fabric.util.createImage(),e=this;return u.width=o.width,u.height=o.height,u.getContext("2d").drawImage(o,0,0,o.width,o.height),t.length===0?(this._element=i,n&&n(),u):(t.forEach(function(n){n&&n.applyTo(u,n.scaleX||e.scaleX,n.scaleY||e.scaleY);r||n.type!=="Resize"||(e.width*=n.scaleX,e.height*=n.scaleY)}),f.width=u.width,f.height=u.height,fabric.isLikelyNode?(f.src=u.toBuffer(undefined,fabric.Image.pngCompression),e._element=f,!r&&(e._filteredEl=f),n&&n()):(f.onload=function(){e._element=f;!r&&(e._filteredEl=f);n&&n();f.onload=u=o=null},f.src=u.toDataURL("image/png")),u)}},_render:function(n,t){var u,f,i=this._findMargins(),r;u=t?this.left:-this.width/2;f=t?this.top:-this.height/2;this.meetOrSlice==="slice"&&(n.beginPath(),n.rect(u,f,this.width,this.height),n.clip());this.isMoving===!1&&this.resizeFilters.length&&this._needsResize()?(this._lastScaleX=this.scaleX,this._lastScaleY=this.scaleY,r=this.applyFilters(null,this.resizeFilters,this._filteredEl||this._originalElement,!1)):r=this._element;r&&n.drawImage(r,u+i.marginX,f+i.marginY,i.width,i.height);this._renderStroke(n)},_needsResize:function(){return this.scaleX!==this._lastScaleX||this.scaleY!==this._lastScaleY},_findMargins:function(){var n=this.width,t=this.height,i,r,u=0,f=0;return(this.alignX!=="none"||this.alignY!=="none")&&(i=[this.width/this._element.width,this.height/this._element.height],r=this.meetOrSlice==="meet"?Math.min.apply(null,i):Math.max.apply(null,i),n=this._element.width*r,t=this._element.height*r,this.alignX==="Mid"&&(u=(this.width-n)/2),this.alignX==="Max"&&(u=this.width-n),this.alignY==="Mid"&&(f=(this.height-t)/2),this.alignY==="Max"&&(f=this.height-t)),{width:n,height:t,marginX:u,marginY:f}},_resetWidthHeight:function(){var n=this.getElement();this.set("width",n.width);this.set("height",n.height)},_initElement:function(n){this.setElement(fabric.util.getById(n));fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},_initConfig:function(n){n||(n={});this.setOptions(n);this._setWidthHeight(n);this._element&&this.crossOrigin&&(this._element.crossOrigin=this.crossOrigin)},_initFilters:function(n,t){n.filters&&n.filters.length?fabric.util.enlivenObjects(n.filters,function(n){t&&t(n)},"fabric.Image.filters"):t&&t()},_setWidthHeight:function(n){this.width="width"in n?n.width:this.getElement()?this.getElement().width||0:0;this.height="height"in n?n.height:this.getElement()?this.getElement().height||0:0},complexity:function(){return 1}});fabric.Image.CSS_CANVAS="canvas-img";fabric.Image.prototype.getSvgSrc=fabric.Image.prototype.getSrc;fabric.Image.fromObject=function(n,t){fabric.util.loadImage(n.src,function(i){fabric.Image.prototype._initFilters.call(n,n,function(r){n.filters=r||[];var u=new fabric.Image(i,n);t&&t(u)})},null,n.crossOrigin)};fabric.Image.fromURL=function(n,t,i){fabric.util.loadImage(n,function(n){t(new fabric.Image(n,i))},null,i&&i.crossOrigin)};fabric.Image.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href".split(" "));fabric.Image.fromElement=function(n,i,r){var u=fabric.parseAttributes(n,fabric.Image.ATTRIBUTE_NAMES),f="xMidYMid",e="meet",s,h,o;u.preserveAspectRatio&&(o=u.preserveAspectRatio.split(" "));o&&o.length&&(e=o.pop(),e!=="meet"&&e!=="slice"?(f=e,e="meet"):o.length&&(f=o.pop()));s=f!=="none"?f.slice(1,4):"none";h=f!=="none"?f.slice(5,8):"none";u.alignX=s;u.alignY=h;u.meetOrSlice=e;fabric.Image.fromURL(u["xlink:href"],i,t(r?fabric.util.object.clone(r):{},u))};fabric.Image.async=!0;fabric.Image.pngCompression=1}(typeof exports!="undefined"?exports:undefined);fabric.util.object.extend(fabric.Object.prototype,{_getAngleValueForStraighten:function(){var n=this.getAngle()%360;return n>0?Math.round((n-1)/90)*90:Math.round(n/90)*90},straighten:function(){return this.setAngle(this._getAngleValueForStraighten()),this},fxStraighten:function(n){n=n||{};var i=function(){},r=n.onComplete||i,u=n.onChange||i,t=this;return fabric.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(n){t.setAngle(n);u()},onComplete:function(){t.setCoords();r()},onStart:function(){t.set("active",!1)}}),this}});fabric.util.object.extend(fabric.StaticCanvas.prototype,{straightenObject:function(n){return n.straighten(),this.renderAll(),this},fxStraightenObject:function(n){return n.fxStraighten({onChange:this.renderAll.bind(this)}),this}});fabric.Image.filters=fabric.Image.filters||{};fabric.Image.filters.BaseFilter=fabric.util.createClass({type:"BaseFilter",initialize:function(n){n&&this.setOptions(n)},setOptions:function(n){for(var t in n)this[t]=n[t]},toObject:function(){return{type:this.type}},toJSON:function(){return this.toObject()}}),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.object.extend;t.Image.filters.Brightness=t.util.createClass(t.Image.filters.BaseFilter,{type:"Brightness",initialize:function(n){n=n||{};this.brightness=n.brightness||0},applyTo:function(n){for(var u=n.getContext("2d"),f=u.getImageData(0,0,n.width,n.height),i=f.data,r=this.brightness,t=0,e=i.length;t<e;t+=4)i[t]+=r,i[t+1]+=r,i[t+2]+=r;u.putImageData(f,0,0)},toObject:function(){return i(this.callSuper("toObject"),{brightness:this.brightness})}});t.Image.filters.Brightness.fromObject=function(n){return new t.Image.filters.Brightness(n)}}(typeof exports!="undefined"?exports:undefined),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.object.extend;t.Image.filters.Convolute=t.util.createClass(t.Image.filters.BaseFilter,{type:"Convolute",initialize:function(n){n=n||{};this.opaque=n.opaque;this.matrix=n.matrix||[0,0,0,0,1,0,0,0,0];var i=t.util.createCanvasElement();this.tmpCtx=i.getContext("2d")},_createImageData:function(n,t){return this.tmpCtx.createImageData(n,t)},applyTo:function(n){for(var t,i,r,l,a,u,f,b=this.matrix,k=n.getContext("2d"),v=k.getImageData(0,0,n.width,n.height),e=Math.round(Math.sqrt(b.length)),d=Math.floor(e/2),o=v.data,y=v.width,g=v.height,p=y,nt=g,tt=this._createImageData(p,nt),s=tt.data,ft=this.opaque?1:0,h=0;h<nt;h++)for(t=0;t<p;t++){var et=h,ot=t,c=(h*p+t)*4,it=0,rt=0,ut=0,w=0;for(i=0;i<e;i++)for(r=0;r<e;r++)(l=et+i-d,a=ot+r-d,l<0||l>g||a<0||a>y)||(u=(l*y+a)*4,f=b[i*e+r],it+=o[u]*f,rt+=o[u+1]*f,ut+=o[u+2]*f,w+=o[u+3]*f);s[c]=it;s[c+1]=rt;s[c+2]=ut;s[c+3]=w+ft*(255-w)}k.putImageData(tt,0,0)},toObject:function(){return i(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}});t.Image.filters.Convolute.fromObject=function(n){return new t.Image.filters.Convolute(n)}}(typeof exports!="undefined"?exports:undefined),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.object.extend;t.Image.filters.GradientTransparency=t.util.createClass(t.Image.filters.BaseFilter,{type:"GradientTransparency",initialize:function(n){n=n||{};this.threshold=n.threshold||100},applyTo:function(n){for(var r=n.getContext("2d"),u=r.getImageData(0,0,n.width,n.height),i=u.data,e=this.threshold,f=i.length,t=0,o=i.length;t<o;t+=4)i[t+3]=e+255*(f-t)/f;r.putImageData(u,0,0)},toObject:function(){return i(this.callSuper("toObject"),{threshold:this.threshold})}});t.Image.filters.GradientTransparency.fromObject=function(n){return new t.Image.filters.GradientTransparency(n)}}(typeof exports!="undefined"?exports:undefined),function(n){"use strict";var t=n.fabric||(n.fabric={});t.Image.filters.Grayscale=t.util.createClass(t.Image.filters.BaseFilter,{type:"Grayscale",applyTo:function(n){for(var f=n.getContext("2d"),r=f.getImageData(0,0,n.width,n.height),i=r.data,e=r.width*r.height*4,t=0,u;t<e;)u=(i[t]+i[t+1]+i[t+2])/3,i[t]=u,i[t+1]=u,i[t+2]=u,t+=4;f.putImageData(r,0,0)}});t.Image.filters.Grayscale.fromObject=function(){return new t.Image.filters.Grayscale}}(typeof exports!="undefined"?exports:undefined),function(n){"use strict";var t=n.fabric||(n.fabric={});t.Image.filters.Invert=t.util.createClass(t.Image.filters.BaseFilter,{type:"Invert",applyTo:function(n){for(var r=n.getContext("2d"),u=r.getImageData(0,0,n.width,n.height),i=u.data,f=i.length,t=0;t<f;t+=4)i[t]=255-i[t],i[t+1]=255-i[t+1],i[t+2]=255-i[t+2];r.putImageData(u,0,0)}});t.Image.filters.Invert.fromObject=function(){return new t.Image.filters.Invert}}(typeof exports!="undefined"?exports:undefined),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.object.extend;t.Image.filters.Mask=t.util.createClass(t.Image.filters.BaseFilter,{type:"Mask",initialize:function(n){n=n||{};this.mask=n.mask;this.channel=[0,1,2,3].indexOf(n.channel)>-1?n.channel:0},applyTo:function(n){var o,s;if(this.mask){var e=n.getContext("2d"),u=e.getImageData(0,0,n.width,n.height),h=u.data,i=this.mask.getElement(),f=t.util.createCanvasElement(),c=this.channel,r,l=u.width*u.height*4;for(f.width=i.width,f.height=i.height,f.getContext("2d").drawImage(i,0,0,i.width,i.height),o=f.getContext("2d").getImageData(0,0,i.width,i.height),s=o.data,r=0;r<l;r+=4)h[r+3]=s[r+c];e.putImageData(u,0,0)}},toObject:function(){return i(this.callSuper("toObject"),{mask:this.mask.toObject(),channel:this.channel})}});t.Image.filters.Mask.fromObject=function(n,i){t.util.loadImage(n.mask.src,function(r){n.mask=new t.Image(r,n.mask);i&&i(new t.Image.filters.Mask(n))})};t.Image.filters.Mask.async=!0}(typeof exports!="undefined"?exports:undefined),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.object.extend;t.Image.filters.Noise=t.util.createClass(t.Image.filters.BaseFilter,{type:"Noise",initialize:function(n){n=n||{};this.noise=n.noise||0},applyTo:function(n){for(var u=n.getContext("2d"),f=u.getImageData(0,0,n.width,n.height),i=f.data,e=this.noise,r,t=0,o=i.length;t<o;t+=4)r=(.5-Math.random())*e,i[t]+=r,i[t+1]+=r,i[t+2]+=r;u.putImageData(f,0,0)},toObject:function(){return i(this.callSuper("toObject"),{noise:this.noise})}});t.Image.filters.Noise.fromObject=function(n){return new t.Image.filters.Noise(n)}}(typeof exports!="undefined"?exports:undefined),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.object.extend;t.Image.filters.Pixelate=t.util.createClass(t.Image.filters.BaseFilter,{type:"Pixelate",initialize:function(n){n=n||{};this.blocksize=n.blocksize||4},applyTo:function(n){for(var h=n.getContext("2d"),f=h.getImageData(0,0,n.width,n.height),i=f.data,w=f.height,s=f.width,t,u,c,l,a,v,e,y,o,p,r=0;r<w;r+=this.blocksize)for(u=0;u<s;u+=this.blocksize)for(t=r*4*s+u*4,c=i[t],l=i[t+1],a=i[t+2],v=i[t+3],e=r,y=r+this.blocksize;e<y;e++)for(o=u,p=u+this.blocksize;o<p;o++)t=e*4*s+o*4,i[t]=c,i[t+1]=l,i[t+2]=a,i[t+3]=v;h.putImageData(f,0,0)},toObject:function(){return i(this.callSuper("toObject"),{blocksize:this.blocksize})}});t.Image.filters.Pixelate.fromObject=function(n){return new t.Image.filters.Pixelate(n)}}(typeof exports!="undefined"?exports:undefined),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.object.extend;t.Image.filters.RemoveWhite=t.util.createClass(t.Image.filters.BaseFilter,{type:"RemoveWhite",initialize:function(n){n=n||{};this.threshold=n.threshold||30;this.distance=n.distance||20},applyTo:function(n){for(var h=n.getContext("2d"),c=h.getImageData(0,0,n.width,n.height),i=c.data,l=this.threshold,e=this.distance,o=255-l,s=Math.abs,r,u,f,t=0,a=i.length;t<a;t+=4)r=i[t],u=i[t+1],f=i[t+2],r>o&&u>o&&f>o&&s(r-u)<e&&s(r-f)<e&&s(u-f)<e&&(i[t+3]=1);h.putImageData(c,0,0)},toObject:function(){return i(this.callSuper("toObject"),{threshold:this.threshold,distance:this.distance})}});t.Image.filters.RemoveWhite.fromObject=function(n){return new t.Image.filters.RemoveWhite(n)}}(typeof exports!="undefined"?exports:undefined),function(n){"use strict";var t=n.fabric||(n.fabric={});t.Image.filters.Sepia=t.util.createClass(t.Image.filters.BaseFilter,{type:"Sepia",applyTo:function(n){for(var u=n.getContext("2d"),f=u.getImageData(0,0,n.width,n.height),i=f.data,e=i.length,r,t=0;t<e;t+=4)r=.3*i[t]+.59*i[t+1]+.11*i[t+2],i[t]=r+100,i[t+1]=r+50,i[t+2]=r+255;u.putImageData(f,0,0)}});t.Image.filters.Sepia.fromObject=function(){return new t.Image.filters.Sepia}}(typeof exports!="undefined"?exports:undefined),function(n){"use strict";var t=n.fabric||(n.fabric={});t.Image.filters.Sepia2=t.util.createClass(t.Image.filters.BaseFilter,{type:"Sepia2",applyTo:function(n){for(var e=n.getContext("2d"),o=e.getImageData(0,0,n.width,n.height),i=o.data,s=i.length,r,u,f,t=0;t<s;t+=4)r=i[t],u=i[t+1],f=i[t+2],i[t]=(r*.393+u*.769+f*.189)/1.351,i[t+1]=(r*.349+u*.686+f*.168)/1.203,i[t+2]=(r*.272+u*.534+f*.131)/2.14;e.putImageData(o,0,0)}});t.Image.filters.Sepia2.fromObject=function(){return new t.Image.filters.Sepia2}}(typeof exports!="undefined"?exports:undefined),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.object.extend;t.Image.filters.Tint=t.util.createClass(t.Image.filters.BaseFilter,{type:"Tint",initialize:function(n){n=n||{};this.color=n.color||"#000000";this.opacity=typeof n.opacity!="undefined"?n.opacity:new t.Color(this.color).getAlpha()},applyTo:function(n){var e=n.getContext("2d"),o=e.getImageData(0,0,n.width,n.height),r=o.data,y=r.length,i,s,h,c,l,a,v,u,f;for(f=new t.Color(this.color).getSource(),s=f[0]*this.opacity,h=f[1]*this.opacity,c=f[2]*this.opacity,u=1-this.opacity,i=0;i<y;i+=4)l=r[i],a=r[i+1],v=r[i+2],r[i]=s+l*u,r[i+1]=h+a*u,r[i+2]=c+v*u;e.putImageData(o,0,0)},toObject:function(){return i(this.callSuper("toObject"),{color:this.color,opacity:this.opacity})}});t.Image.filters.Tint.fromObject=function(n){return new t.Image.filters.Tint(n)}}(typeof exports!="undefined"?exports:undefined),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.object.extend;t.Image.filters.Multiply=t.util.createClass(t.Image.filters.BaseFilter,{type:"Multiply",initialize:function(n){n=n||{};this.color=n.color||"#000000"},applyTo:function(n){for(var f=n.getContext("2d"),e=f.getImageData(0,0,n.width,n.height),r=e.data,o=r.length,u=new t.Color(this.color).getSource(),i=0;i<o;i+=4)r[i]*=u[0]/255,r[i+1]*=u[1]/255,r[i+2]*=u[2]/255;f.putImageData(e,0,0)},toObject:function(){return i(this.callSuper("toObject"),{color:this.color})}});t.Image.filters.Multiply.fromObject=function(n){return new t.Image.filters.Multiply(n)}}(typeof exports!="undefined"?exports:undefined),function(n){"use strict";var t=n.fabric;t.Image.filters.Blend=t.util.createClass({type:"Blend",initialize:function(n){n=n||{};this.color=n.color||"#000";this.image=n.image||!1;this.mode=n.mode||"multiply";this.alpha=n.alpha||1},applyTo:function(n){var v=n.getContext("2d"),y=v.getImageData(0,0,n.width,n.height),r=y.data,u,f,e,o,s,h,c,p=!1,a,l,w,i,b;for(this.image?(p=!0,a=t.util.createCanvasElement(),a.width=this.image.width,a.height=this.image.height,l=new t.StaticCanvas(a),l.add(this.image),w=l.getContext("2d"),c=w.getImageData(0,0,l.width,l.height).data):(c=new t.Color(this.color).getSource(),u=c[0]*this.alpha,f=c[1]*this.alpha,e=c[2]*this.alpha),i=0,b=r.length;i<b;i+=4){o=r[i];s=r[i+1];h=r[i+2];p&&(u=c[i]*this.alpha,f=c[i+1]*this.alpha,e=c[i+2]*this.alpha);switch(this.mode){case"multiply":r[i]=o*u/255;r[i+1]=s*f/255;r[i+2]=h*e/255;break;case"screen":r[i]=1-(1-o)*(1-u);r[i+1]=1-(1-s)*(1-f);r[i+2]=1-(1-h)*(1-e);break;case"add":r[i]=Math.min(255,o+u);r[i+1]=Math.min(255,s+f);r[i+2]=Math.min(255,h+e);break;case"diff":case"difference":r[i]=Math.abs(o-u);r[i+1]=Math.abs(s-f);r[i+2]=Math.abs(h-e);break;case"subtract":var k=o-u,d=s-f,g=h-e;r[i]=k<0?0:k;r[i+1]=d<0?0:d;r[i+2]=g<0?0:g;break;case"darken":r[i]=Math.min(o,u);r[i+1]=Math.min(s,f);r[i+2]=Math.min(h,e);break;case"lighten":r[i]=Math.max(o,u);r[i+1]=Math.max(s,f);r[i+2]=Math.max(h,e)}}v.putImageData(y,0,0)},toObject:function(){return{color:this.color,image:this.image,mode:this.mode,alpha:this.alpha}}});t.Image.filters.Blend.fromObject=function(n){return new t.Image.filters.Blend(n)}}(typeof exports!="undefined"?exports:undefined),function(n){"use strict";var i=n.fabric||(n.fabric={}),e=Math.pow,t=Math.floor,o=Math.sqrt,r=Math.abs,u=Math.max,s=Math.round,h=Math.sin,f=Math.ceil;i.Image.filters.Resize=i.util.createClass(i.Image.filters.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:0,scaleY:0,lanczosLobes:3,applyTo:function(n,t,i){this.rcpScaleX=1/t;this.rcpScaleY=1/i;var r=n.width,u=n.height,f=s(r*t),e=s(u*i),o;this.resizeType==="sliceHack"&&(o=this.sliceByTwo(n,r,u,f,e));this.resizeType==="hermite"&&(o=this.hermiteFastResize(n,r,u,f,e));this.resizeType==="bilinear"&&(o=this.bilinearFiltering(n,r,u,f,e));this.resizeType==="lanczos"&&(o=this.lanczosResize(n,r,u,f,e));n.width=f;n.height=e;n.getContext("2d").putImageData(o,0,0)},sliceByTwo:function(n,r,f,e,o){var c=n.getContext("2d"),l,v=.5,y=.5,p=1,w=1,b=!1,k=!1,s=r,h=f,a=i.util.createCanvasElement(),d=a.getContext("2d");for(e=t(e),o=t(o),a.width=u(e,r),a.height=u(o,f),e>r&&(v=2,p=-1),o>f&&(y=2,w=-1),l=c.getImageData(0,0,r,f),n.width=u(e,r),n.height=u(o,f),c.putImageData(l,0,0);!b||!k;)r=s,f=h,e*p<t(s*v*p)?s=t(s*v):(s=e,b=!0),o*w<t(h*y*w)?h=t(h*y):(h=o,k=!0),l=c.getImageData(0,0,r,f),d.putImageData(l,0,0),c.clearRect(0,0,s,h),c.drawImage(a,0,0,r,f,0,0,s,h);return c.getImageData(0,0,e,o)},lanczosResize:function(n,i,u,s,c){function tt(n){return function(t){if(t>n)return 0;if(t*=Math.PI,r(t)<1e-16)return 1;var i=t/n;return h(t)*h(i)/t/i}}function it(n){var yt=!0,ht,ot,h,w,f,rt,ct,lt,at,vt,tt,st,it;n:while(yt){for(ht=n,yt=!1,l.x=(ht+.5)*k,a.x=t(l.x),ot=0;ot<c;ot++){for(l.y=(ot+.5)*d,a.y=t(l.y),rt=0,ct=0,lt=0,at=0,vt=0,h=a.x-g;h<=a.x+g;h++)if(!(h<0)&&!(h>=i))for(tt=t(1e3*r(h-l.x)),v[tt]||(v[tt]={}),it=a.y-nt;it<=a.y+nt;it++)it<0||it>=u||(st=t(1e3*r(it-l.y)),v[tt][st]||(v[tt][st]=ut(o(e(tt*ft,2)+e(st*et,2))/1e3)),w=v[tt][st],w>0&&(f=(it*i+h)*4,rt+=w,ct+=w*y[f],lt+=w*y[f+1],at+=w*y[f+2],vt+=w*y[f+3]));f=(ot*s+ht)*4;p[f]=ct/rt;p[f+1]=lt/rt;p[f+2]=at/rt;p[f+3]=vt/rt}if(++ht<s){n=ht;yt=!0;ot=h=w=f=rt=ct=lt=at=vt=tt=st=it=undefined;continue n}else return b}}var w=n.getContext("2d"),rt=w.getImageData(0,0,i,u),b=w.getImageData(0,0,s,c),y=rt.data,p=b.data,ut=tt(this.lanczosLobes),k=this.rcpScaleX,d=this.rcpScaleY,ft=2/this.rcpScaleX,et=2/this.rcpScaleY,g=f(k*this.lanczosLobes/2),nt=f(d*this.lanczosLobes/2),v={},l={},a={};return it(0)},bilinearFiltering:function(n,i,r,u,f){for(var p,w,b,k,v,y,s,h,c,e,d,ut=0,l,g=this.rcpScaleX,nt=this.rcpScaleY,tt=n.getContext("2d"),it=4*(i-1),ft=tt.getImageData(0,0,i,r),a=ft.data,rt=tt.getImageData(0,0,u,f),et=rt.data,o=0;o<f;o++)for(s=0;s<u;s++)for(v=t(g*s),y=t(nt*o),h=g*s-v,c=nt*o-y,l=4*(y*i+v),e=0;e<4;e++)p=a[l+e],w=a[l+4+e],b=a[l+it+e],k=a[l+it+4+e],d=p*(1-h)*(1-c)+w*h*(1-c)+b*c*(1-h)+k*h*c,et[ut++]=d;return rt},hermiteFastResize:function(n,i,u,e,s){for(var a,p,w,c,l,b=this.rcpScaleX,k=this.rcpScaleY,ht=f(b/2),ct=f(k/2),tt=n.getContext("2d"),lt=tt.getImageData(0,0,i,u),v=lt.data,it=tt.getImageData(0,0,e,s),d=it.data,y=0;y<s;y++)for(a=0;a<e;a++){var g=(a+y*e)*4,h=0,nt=0,rt=0,ut=0,ft=0,et=0,ot=0,at=(y+.5)*k;for(p=t(y*k);p<(y+1)*k;p++){var st=r(at-(p+.5))/ct,vt=(a+.5)*b,yt=st*st;for(w=t(a*b);w<(a+1)*b;w++)(c=r(vt-(w+.5))/ht,l=o(yt+c*c),l>1&&l<-1)||(h=2*l*l*l-3*l*l+1,h>0&&(c=4*(w+p*i),ot+=h*v[c+3],rt+=h,v[c+3]<255&&(h=h*v[c+3]/250),ut+=h*v[c],ft+=h*v[c+1],et+=h*v[c+2],nt+=h))}d[g]=ut/nt;d[g+1]=ft/nt;d[g+2]=et/nt;d[g+3]=ot/rt}return it}});i.Image.filters.Resize.fromObject=function(){return new i.Image.filters.Resize}}(typeof exports!="undefined"?exports:undefined),function(n){"use strict";var t=n.fabric||(n.fabric={}),u=t.util.object.extend,f=t.util.object.clone,i=t.util.toFixed,e=t.StaticCanvas.supports("setLineDash"),r;if(t.Text){t.warn("fabric.Text is already defined");return}r=t.Object.prototype.stateProperties.concat();r.push("fontFamily","fontWeight","fontSize","text","textDecoration","textAlign","fontStyle","lineHeight","textBackgroundColor","useNative","path");t.Text=t.util.createClass(t.Object,{_dimensionAffectingProps:{fontSize:!0,fontWeight:!0,fontFamily:!0,textDecoration:!0,fontStyle:!0,lineHeight:!0,stroke:!0,strokeWidth:!0,text:!0},_reNewline:/\r?\n/,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",textDecoration:"",textAlign:"left",fontStyle:"",lineHeight:1.3,textBackgroundColor:"",path:null,useNative:!0,stateProperties:r,stroke:null,shadow:null,initialize:function(n,t){t=t||{};this.text=n;this.__skipDimension=!0;this.setOptions(t);this.__skipDimension=!1;this._initDimensions()},_initDimensions:function(){if(!this.__skipDimension){var n=t.util.createCanvasElement();this._render(n.getContext("2d"))}},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_render:function(n){typeof Cufon=="undefined"||this.useNative===!0?this._renderViaNative(n):this._renderViaCufon(n)},_renderViaNative:function(n){var i=this.text.split(this._reNewline);this._setTextStyles(n);this.width=this._getTextWidth(n,i);this.height=this._getTextHeight(n,i);this.clipTo&&t.util.clipContext(this,n);this._renderTextBackground(n,i);this._translateForTextAlign(n);this._renderText(n,i);this.textAlign!=="left"&&this.textAlign!=="justify"&&n.restore();this._renderTextDecoration(n,i);this.clipTo&&n.restore();this._setBoundaries(n,i);this._totalLineHeight=0},_renderText:function(n,t){n.save();this._setOpacity(n);this._setShadow(n);this._setupCompositeOperation(n);this._renderTextFill(n,t);this._renderTextStroke(n,t);this._restoreCompositeOperation(n);this._removeShadow(n);n.restore()},_translateForTextAlign:function(n){this.textAlign!=="left"&&this.textAlign!=="justify"&&(n.save(),n.translate(this.textAlign==="center"?this.width/2:this.width,0))},_setBoundaries:function(n,t){var i,u,r,f;for(this._boundaries=[],i=0,u=t.length;i<u;i++)r=this._getLineWidth(n,t[i]),f=this._getLineLeftOffset(r),this._boundaries.push({height:this.fontSize*this.lineHeight,width:r,left:f})},_setTextStyles:function(n){this._setFillStyles(n);this._setStrokeStyles(n);n.textBaseline="alphabetic";this.skipTextAlign||(n.textAlign=this.textAlign);n.font=this._getFontDeclaration()},_getTextHeight:function(n,t){return this.fontSize*t.length*this.lineHeight},_getTextWidth:function(n,t){for(var u,i=n.measureText(t[0]||"|").width,r=1,f=t.length;r<f;r++)u=n.measureText(t[r]).width,u>i&&(i=u);return i},_renderChars:function(n,t,i,r,u){t[n](i,r,u)},_renderTextLine:function(n,t,i,r,u,f){var h,s,e,l;if(u-=this.fontSize/4,this.textAlign!=="justify"){this._renderChars(n,t,i,r,u,f);return}if(h=t.measureText(i).width,s=this.width,s>h){var o=i.split(/\s+/),a=t.measureText(i.replace(/\s+/g,"")).width,v=s-a,y=o.length-1,p=v/y,c=0;for(e=0,l=o.length;e<l;e++)this._renderChars(n,t,o[e],r+c,u,f),c+=t.measureText(o[e]).width+p}else this._renderChars(n,t,i,r,u,f)},_getLeftOffset:function(){return-this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextFill:function(n,t){var r,i,u,f;if(this.fill||this._skipFillStrokeCheck){for(this._boundaries=[],r=0,i=0,u=t.length;i<u;i++)f=this._getHeightOfLine(n,i,t),r+=f,this._renderTextLine("fillText",n,t[i],this._getLeftOffset(),this._getTopOffset()+r,i);this.shadow&&!this.shadow.affectStroke&&this._removeShadow(n)}},_renderTextStroke:function(n,t){var r,i,u,f;if(this.stroke&&this.strokeWidth!==0||this._skipFillStrokeCheck){for(r=0,n.save(),this.strokeDashArray&&(1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),e&&n.setLineDash(this.strokeDashArray)),n.beginPath(),i=0,u=t.length;i<u;i++)f=this._getHeightOfLine(n,i,t),r+=f,this._renderTextLine("strokeText",n,t[i],this._getLeftOffset(),this._getTopOffset()+r,i);n.closePath();n.restore()}},_getHeightOfLine:function(){return this.fontSize*this.lineHeight},_renderTextBackground:function(n,t){this._renderTextBoxBackground(n);this._renderTextLinesBackground(n,t)},_renderTextBoxBackground:function(n){this.backgroundColor&&(n.save(),n.fillStyle=this.backgroundColor,n.fillRect(this._getLeftOffset(),this._getTopOffset(),this.width,this.height),n.restore())},_renderTextLinesBackground:function(n,t){var i,u,r,f;if(this.textBackgroundColor){for(n.save(),n.fillStyle=this.textBackgroundColor,i=0,u=t.length;i<u;i++)t[i]!==""&&(r=this._getLineWidth(n,t[i]),f=this._getLineLeftOffset(r),n.fillRect(this._getLeftOffset()+f,this._getTopOffset()+i*this.fontSize*this.lineHeight,r,this.fontSize*this.lineHeight));n.restore()}},_getLineLeftOffset:function(n){return this.textAlign==="center"?(this.width-n)/2:this.textAlign==="right"?this.width-n:0},_getLineWidth:function(n,t){return this.textAlign==="justify"?this.width:n.measureText(t).width},_renderTextDecoration:function(n,t){function r(r){for(var e,s,f=0,o=t.length;f<o;f++)e=i._getLineWidth(n,t[f]),s=i._getLineLeftOffset(e),n.fillRect(i._getLeftOffset()+s,~~(r+f*i._getHeightOfLine(n,f,t)-u),e,1)}if(this.textDecoration){var u=this._getTextHeight(n,t)/2,i=this;this.textDecoration.indexOf("underline")>-1&&r(this.fontSize*this.lineHeight);this.textDecoration.indexOf("line-through")>-1&&r(this.fontSize*this.lineHeight-this.fontSize/2);this.textDecoration.indexOf("overline")>-1&&r(this.fontSize*this.lineHeight-this.fontSize)}},_getFontDeclaration:function(){return[t.isLikelyNode?this.fontWeight:this.fontStyle,t.isLikelyNode?this.fontStyle:this.fontWeight,this.fontSize+"px",t.isLikelyNode?'"'+this.fontFamily+'"':this.fontFamily].join(" ")},render:function(n,t){if(this.visible){n.save();t||this.transform(n);var i=this.group&&this.group.type==="path-group";i&&n.translate(-this.group.width/2,-this.group.height/2);this.transformMatrix&&n.transform.apply(n,this.transformMatrix);i&&n.translate(this.left,this.top);this._render(n);n.restore()}},toObject:function(n){var t=u(this.callSuper("toObject",n),{text:this.text,fontSize:this.fontSize,fontWeight:this.fontWeight,fontFamily:this.fontFamily,fontStyle:this.fontStyle,lineHeight:this.lineHeight,textDecoration:this.textDecoration,textAlign:this.textAlign,path:this.path,textBackgroundColor:this.textBackgroundColor,useNative:this.useNative});return this.includeDefaultValues||this._removeDefaultValues(t),t},toSVG:function(n){var i=[],r=this.text.split(this._reNewline),t=this._getSVGLeftTopOffsets(r),u=this._getSVGTextAndBg(t.lineTop,t.textLeft,r),f=this._getSVGShadows(t.lineTop,r);return t.textTop+=this._fontAscent?this._fontAscent/5*this.lineHeight:0,this._wrapSVGTextAndBg(i,u,f,t),n?n(i.join("")):i.join("")},_getSVGLeftTopOffsets:function(n){var t=this.useNative?this.fontSize*this.lineHeight:-this._fontAscent-this._fontAscent/5*this.lineHeight,i=-(this.width/2),r=this.useNative?this.fontSize*this.lineHeight-.25*this.fontSize:this.height/2-n.length*this.fontSize-this._totalLineHeight;return{textLeft:i+(this.group&&this.group.type==="path-group"?this.left:0),textTop:r+(this.group&&this.group.type==="path-group"?this.top:0),lineTop:t}},_wrapSVGTextAndBg:function(n,t,r,u){n.push('<g transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'">\n',t.textBgRects.join(""),"<text ",this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",this.textDecoration?'text-decoration="'+this.textDecoration+'" ':"",'style="',this.getSvgStyles(),'" ','transform="translate(',i(u.textLeft,2)," ",i(u.textTop,2),')">',r.join(""),t.textSpans.join(""),"<\/text>\n","<\/g>\n")},_getSVGShadows:function(n,r){var f=[],u,o,e=1,s;if(!this.shadow||!this._boundaries)return f;for(u=0,o=r.length;u<o;u++)r[u]!==""?(s=this._boundaries&&this._boundaries[u]?this._boundaries[u].left:0,f.push('<tspan x="',i(s+e+this.shadow.offsetX,2),u===0||this.useNative?'" y':'" dy','="',i(this.useNative?n*u-this.height/2+this.shadow.offsetY:n+(u===0?this.shadow.offsetY:0),2),'" ',this._getFillAttributes(this.shadow.color),">",t.util.string.escapeXml(r[u]),"<\/tspan>"),e=1):e++;return f},_getSVGTextAndBg:function(n,t,i){var e=[],u=[],f=1,r,o;for(this._setSVGBg(u),r=0,o=i.length;r<o;r++)(i[r]!==""?(this._setSVGTextLineText(i[r],r,e,n,f,u),f=1):f++,this.textBackgroundColor&&this._boundaries)&&this._setSVGTextLineBg(u,r,t,n);return{textSpans:e,textBgRects:u}},_setSVGTextLineText:function(n,r,u,f,e){var o=this._boundaries&&this._boundaries[r]?i(this._boundaries[r].left,2):0;u.push('<tspan x="',o,'" ',r===0||this.useNative?"y":"dy",'="',i(this.useNative?f*r-this.height/2:f*e,2),'" ',this._getFillAttributes(this.fill),">",t.util.string.escapeXml(n),"<\/tspan>")},_setSVGTextLineBg:function(n,t,r,u){n.push("<rect ",this._getFillAttributes(this.textBackgroundColor),' x="',i(r+this._boundaries[t].left,2),'" y="',i(u*t-this.height/2,2),'" width="',i(this._boundaries[t].width,2),'" height="',i(this._boundaries[t].height,2),'"><\/rect>\n')},_setSVGBg:function(n){this.backgroundColor&&this._boundaries&&n.push("<rect ",this._getFillAttributes(this.backgroundColor),' x="',i(-this.width/2,2),'" y="',i(-this.height/2,2),'" width="',i(this.width,2),'" height="',i(this.height,2),'"><\/rect>')},_getFillAttributes:function(n){var i=n&&typeof n=="string"?new t.Color(n):"";return!i||!i.getSource()||i.getAlpha()===1?'fill="'+n+'"':'opacity="'+i.getAlpha()+'" fill="'+i.setAlpha(1).toRgb()+'"'},_set:function(n,t){n==="fontFamily"&&this.path&&(this.path=this.path.replace(/(.*?)([^\/]*)(\.font\.js)/,"$1"+t+"$3"));this.callSuper("_set",n,t);n in this._dimensionAffectingProps&&(this._initDimensions(),this.setCoords())},complexity:function(){return 1}});t.Text.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size text-decoration text-anchor".split(" "));t.Text.DEFAULT_SVG_FONT_SIZE=16;t.Text.fromElement=function(n,i){var u,r,f;return n?(u=t.parseAttributes(n,t.Text.ATTRIBUTE_NAMES),i=t.util.object.extend(i?t.util.object.clone(i):{},u),i.top=i.top||0,i.left=i.left||0,"dx"in u&&(i.left+=u.dx),"dy"in u&&(i.top+=u.dy),"fontSize"in i||(i.fontSize=t.Text.DEFAULT_SVG_FONT_SIZE),i.originX||(i.originX="left"),i.top+=i.fontSize/4,r=new t.Text(n.textContent,i),f=0,r.originX==="left"&&(f=r.getWidth()/2),r.originX==="right"&&(f=-r.getWidth()/2),r.set({left:r.getLeft()+f,top:r.getTop()-r.getHeight()/2}),r):null};t.Text.fromObject=function(n){return new t.Text(n.text,f(n))};t.util.createAccessors(t.Text)}(typeof exports!="undefined"?exports:undefined),function(){var n=fabric.util.object.clone;fabric.IText=fabric.util.createClass(fabric.Text,fabric.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"#333",cursorDelay:1e3,cursorDuration:600,styles:null,caching:!0,_skipFillStrokeCheck:!0,_reSpace:/\s|\n/,_fontSizeFraction:4,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,_charWidthsCache:{},initialize:function(n,t){this.styles=t?t.styles||{}:{};this.callSuper("initialize",n,t);this.initBehavior();fabric.IText.instances.push(this);this.__lineWidths={};this.__lineHeights={};this.__lineOffsets={}},isEmptyStyles:function(){var n,t,i,r;if(!this.styles)return!0;n=this.styles;for(t in n)for(i in n[t])for(r in n[t][i])return!1;return!0},setSelectionStart:function(n){this.selectionStart!==n&&(this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this}));this.selectionStart=n;this.hiddenTextarea&&(this.hiddenTextarea.selectionStart=n)},setSelectionEnd:function(n){this.selectionEnd!==n&&(this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this}));this.selectionEnd=n;this.hiddenTextarea&&(this.hiddenTextarea.selectionEnd=n)},getSelectionStyles:function(n,t){var u,i,r;if(arguments.length===2){for(u=[],i=n;i<t;i++)u.push(this.getSelectionStyles(i));return u}return r=this.get2DCursorLocation(n),this.styles[r.lineIndex]?this.styles[r.lineIndex][r.charIndex]||{}:{}},setSelectionStyles:function(n){if(this.selectionStart===this.selectionEnd)this._extendStyles(this.selectionStart,n);else for(var t=this.selectionStart;t<this.selectionEnd;t++)this._extendStyles(t,n);return this},_extendStyles:function(n,t){var i=this.get2DCursorLocation(n);this.styles[i.lineIndex]||(this.styles[i.lineIndex]={});this.styles[i.lineIndex][i.charIndex]||(this.styles[i.lineIndex][i.charIndex]={});fabric.util.object.extend(this.styles[i.lineIndex][i.charIndex],t)},_render:function(n){this.callSuper("_render",n);this.ctx=n;this.isEditing&&this.renderCursorOrSelection()},renderCursorOrSelection:function(){if(this.active){var t=this.text.split(""),n;this.selectionStart===this.selectionEnd?(n=this._getCursorBoundaries(t,"cursor"),this.renderCursor(n)):(n=this._getCursorBoundaries(t,"selection"),this.renderSelection(t,n))}},get2DCursorLocation:function(n){typeof n=="undefined"&&(n=this.selectionStart);var i=this.text.slice(0,n),t=i.split(this._reNewline);return{lineIndex:t.length-1,charIndex:t[t.length-1].length}},getCurrentCharStyle:function(n,t){var i=this.styles[n]&&this.styles[n][t===0?0:t-1];return{fontSize:i&&i.fontSize||this.fontSize,fill:i&&i.fill||this.fill,textBackgroundColor:i&&i.textBackgroundColor||this.textBackgroundColor,textDecoration:i&&i.textDecoration||this.textDecoration,fontFamily:i&&i.fontFamily||this.fontFamily,fontWeight:i&&i.fontWeight||this.fontWeight,fontStyle:i&&i.fontStyle||this.fontStyle,stroke:i&&i.stroke||this.stroke,strokeWidth:i&&i.strokeWidth||this.strokeWidth}},getCurrentCharFontSize:function(n,t){return this.styles[n]&&this.styles[n][t===0?0:t-1]&&this.styles[n][t===0?0:t-1].fontSize||this.fontSize},getCurrentCharColor:function(n,t){return this.styles[n]&&this.styles[n][t===0?0:t-1]&&this.styles[n][t===0?0:t-1].fill||this.cursorColor},_getCursorBoundaries:function(n,t){var r=this.get2DCursorLocation(),u=this.text.split(this._reNewline),f=Math.round(this._getLeftOffset()),e=this._getTopOffset(),i=this._getCursorBoundariesOffsets(n,t,r,u);return{left:f,top:e,leftOffset:i.left+i.lineLeft,topOffset:i.top}},_getCursorBoundariesOffsets:function(n,t,i,r){for(var c,s=0,u=0,e=0,o=0,h=t==="cursor"?this._getHeightOfLine(this.ctx,0)-this.getCurrentCharFontSize(i.lineIndex,i.charIndex):0,f=0;f<this.selectionStart;f++)n[f]==="\n"?(o=0,c=u+(t==="cursor"?1:0),h+=this._getCachedLineHeight(c),u++,e=0):(o+=this._getWidthOfChar(this.ctx,n[f],u,e),e++),s=this._getCachedLineOffset(u,r);return this._clearCache(),{top:h,left:o,lineLeft:s}},_clearCache:function(){this.__lineWidths={};this.__lineHeights={};this.__lineOffsets={}},_getCachedLineHeight:function(n){return this.__lineHeights[n]||(this.__lineHeights[n]=this._getHeightOfLine(this.ctx,n))},_getCachedLineWidth:function(n,t){return this.__lineWidths[n]||(this.__lineWidths[n]=this._getWidthOfLine(this.ctx,n,t))},_getCachedLineOffset:function(n,t){var i=this._getCachedLineWidth(n,t);return this.__lineOffsets[n]||(this.__lineOffsets[n]=this._getLineLeftOffset(i))},renderCursor:function(n){var t=this.ctx;t.save();var u=this.get2DCursorLocation(),i=u.lineIndex,r=u.charIndex,f=this.getCurrentCharFontSize(i,r),e=i===0&&r===0?this._getCachedLineOffset(i,this.text.split(this._reNewline)):n.leftOffset;t.fillStyle=this.getCurrentCharColor(i,r);t.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity;t.fillRect(n.left+e,n.top+n.topOffset,this.cursorWidth/this.scaleX,f);t.restore()},renderSelection:function(n,t){var u=this.ctx,i,r,y,e,p;u.save();u.fillStyle=this.selectionColor;var h=this.get2DCursorLocation(this.selectionStart),c=this.get2DCursorLocation(this.selectionEnd),l=h.lineIndex,o=c.lineIndex,f=this.text.split(this._reNewline);for(i=l;i<=o;i++){var a=this._getCachedLineOffset(i,f)||0,v=this._getCachedLineHeight(i),s=0;if(i===l)for(r=0,y=f[i].length;r<y;r++)r>=h.charIndex&&(i!==o||r<c.charIndex)&&(s+=this._getWidthOfChar(u,f[i][r],i,r)),r<h.charIndex&&(a+=this._getWidthOfChar(u,f[i][r],i,r));else if(i>l&&i<o)s+=this._getCachedLineWidth(i,f)||5;else if(i===o)for(e=0,p=c.charIndex;e<p;e++)s+=this._getWidthOfChar(u,f[i][e],i,e);u.fillRect(t.left+a,t.top+t.topOffset,s,v);t.topOffset+=v}u.restore()},_renderChars:function(n,t,i,r,u,f){var e,h,c;if(this.isEmptyStyles())return this._renderCharsFast(n,t,i,r,u);this.skipTextAlign=!0;r-=this.textAlign==="center"?this.width/2:this.textAlign==="right"?this.width:0;var l=this.text.split(this._reNewline),v=this._getWidthOfLine(t,f,l),y=this._getHeightOfLine(t,f,l),p=this._getLineLeftOffset(v),a=i.split(""),o,s="";for(r+=p||0,t.save(),e=0,h=a.length;e<=h;e++)o=o||this.getCurrentCharStyle(f,e),c=this.getCurrentCharStyle(f,e+1),(this._hasStyleChanged(o,c)||e===h)&&(this._renderChar(n,t,f,e-1,s,r,u,y),s="",o=c),s+=a[e];t.restore()},_renderCharsFast:function(n,t,i,r,u){this.skipTextAlign=!1;n==="fillText"&&this.fill&&this.callSuper("_renderChars",n,t,i,r,u);n==="strokeText"&&this.stroke&&this.callSuper("_renderChars",n,t,i,r,u)},_renderChar:function(n,t,i,r,u,f,e,o){var s,h,c,l,a;this.styles&&this.styles[i]&&(s=this.styles[i][r])?(l=s.stroke||this.stroke,a=s.fill||this.fill,t.save(),h=this._applyCharStylesGetWidth(t,u,i,r,s),c=this._getHeightOfChar(t,u,i,r),a&&t.fillText(u,f,e),l&&t.strokeText(u,f,e),this._renderCharDecoration(t,s,f,e,h,o,c),t.restore(),t.translate(h,0)):(n==="strokeText"&&this.stroke&&t[n](u,f,e),n==="fillText"&&this.fill&&t[n](u,f,e),h=this._applyCharStylesGetWidth(t,u,i,r),this._renderCharDecoration(t,null,f,e,h,o),t.translate(t.measureText(u).width,0))},_hasStyleChanged:function(n,t){return n.fill!==t.fill||n.fontSize!==t.fontSize||n.textBackgroundColor!==t.textBackgroundColor||n.textDecoration!==t.textDecoration||n.fontFamily!==t.fontFamily||n.fontWeight!==t.fontWeight||n.fontStyle!==t.fontStyle||n.stroke!==t.stroke||n.strokeWidth!==t.strokeWidth},_renderCharDecoration:function(n,t,i,r,u,f,e){var o=t?t.textDecoration||this.textDecoration:this.textDecoration,s=(t?t.fontSize:null)||this.fontSize;o&&(o.indexOf("underline")>-1&&this._renderCharDecorationAtOffset(n,i,r+this.fontSize/this._fontSizeFraction,u,0,this.fontSize/20),o.indexOf("line-through")>-1&&this._renderCharDecorationAtOffset(n,i,r+this.fontSize/this._fontSizeFraction,u,e/2,s/20),o.indexOf("overline")>-1&&this._renderCharDecorationAtOffset(n,i,r,u,f-this.fontSize/this._fontSizeFraction,this.fontSize/20))},_renderCharDecorationAtOffset:function(n,t,i,r,u,f){n.fillRect(t,i-u,r,f)},_renderTextLine:function(n,t,i,r,u,f){u+=this.fontSize/4;this.callSuper("_renderTextLine",n,t,i,r,u,f)},_renderTextDecoration:function(n,t){if(this.isEmptyStyles())return this.callSuper("_renderTextDecoration",n,t)},_renderTextLinesBackground:function(n,t){var u,e,i,h,f,o,s,r,c,l;if(this.textBackgroundColor||this.styles){for(n.save(),this.textBackgroundColor&&(n.fillStyle=this.textBackgroundColor),u=0,e=this.fontSize/this._fontSizeFraction,i=0,h=t.length;i<h;i++){if(f=this._getHeightOfLine(n,i,t),t[i]===""){u+=f;continue}if(o=this._getWidthOfLine(n,i,t),s=this._getLineLeftOffset(o),this.textBackgroundColor&&(n.fillStyle=this.textBackgroundColor,n.fillRect(this._getLeftOffset()+s,this._getTopOffset()+u+e,o,f)),this.styles[i])for(r=0,c=t[i].length;r<c;r++)this.styles[i]&&this.styles[i][r]&&this.styles[i][r].textBackgroundColor&&(l=t[i][r],n.fillStyle=this.styles[i][r].textBackgroundColor,n.fillRect(this._getLeftOffset()+s+this._getWidthOfCharsAt(n,i,r,t),this._getTopOffset()+u+e,this._getWidthOfChar(n,l,i,r,t)+1,f));u+=f}n.restore()}},_getCacheProp:function(n,t){return n+t.fontFamily+t.fontSize+t.fontWeight+t.fontStyle+t.shadow},_applyCharStylesGetWidth:function(t,i,r,u,f){var e=f||this.styles[r]&&this.styles[r][u],o,s;return(e=e?n(e):{},this._applyFontStyles(e),o=this._getCacheProp(i,e),this.isEmptyStyles()&&this._charWidthsCache[o]&&this.caching)?this._charWidthsCache[o]:(typeof e.shadow=="string"&&(e.shadow=new fabric.Shadow(e.shadow)),s=e.fill||this.fill,t.fillStyle=s.toLive?s.toLive(t):s,e.stroke&&(t.strokeStyle=e.stroke&&e.stroke.toLive?e.stroke.toLive(t):e.stroke),t.lineWidth=e.strokeWidth||this.strokeWidth,t.font=this._getFontDeclaration.call(e),this._setShadow.call(e,t),this.caching?(this._charWidthsCache[o]||(this._charWidthsCache[o]=t.measureText(i).width),this._charWidthsCache[o]):t.measureText(i).width)},_applyFontStyles:function(n){n.fontFamily||(n.fontFamily=this.fontFamily);n.fontSize||(n.fontSize=this.fontSize);n.fontWeight||(n.fontWeight=this.fontWeight);n.fontStyle||(n.fontStyle=this.fontStyle)},_getStyleDeclaration:function(t,i){return this.styles[t]&&this.styles[t][i]?n(this.styles[t][i]):{}},_getWidthOfChar:function(n,t,i,r){var u,f,e;return this.textAlign==="justify"&&/\s/.test(t)?this._getWidthOfSpace(n,i):(u=this._getStyleDeclaration(i,r),this._applyFontStyles(u),f=this._getCacheProp(t,u),this._charWidthsCache[f]&&this.caching)?this._charWidthsCache[f]:n?(n.save(),e=this._applyCharStylesGetWidth(n,t,i,r),n.restore(),e):void 0},_getHeightOfChar:function(n,t,i,r){return this.styles[i]&&this.styles[i][r]?this.styles[i][r].fontSize||this.fontSize:this.fontSize},_getWidthOfCharAt:function(n,t,i,r){r=r||this.text.split(this._reNewline);var u=r[t].split("")[i];return this._getWidthOfChar(n,u,t,i)},_getHeightOfCharAt:function(n,t,i,r){r=r||this.text.split(this._reNewline);var u=r[t].split("")[i];return this._getHeightOfChar(n,u,t,i)},_getWidthOfCharsAt:function(n,t,i,r){for(var f=0,u=0;u<i;u++)f+=this._getWidthOfCharAt(n,t,u,r);return f},_getWidthOfLine:function(n,t,i){return this._getWidthOfCharsAt(n,t,i[t].length,i)},_getWidthOfSpace:function(n,t){var r=this.text.split(this._reNewline),i=r[t],u=i.split(/\s+/),f=this._getWidthOfWords(n,i,t),e=this.width-f,o=u.length-1;return e/o},_getWidthOfWords:function(n,t,i){for(var u,f=0,r=0;r<t.length;r++)u=t[r],u.match(/\s/)||(f+=this._getWidthOfChar(n,u,i,r));return f},_getTextWidth:function(n,t){var i,r,f,u;if(this.isEmptyStyles())return this.callSuper("_getTextWidth",n,t);for(i=this._getWidthOfLine(n,0,t),r=1,f=t.length;r<f;r++)u=this._getWidthOfLine(n,r,t),u>i&&(i=u);return i},_getHeightOfLine:function(n,t,i){var r,o,f;i=i||this.text.split(this._reNewline);var u=this._getHeightOfChar(n,i[t][0],t,0),s=i[t],e=s.split("");for(r=1,o=e.length;r<o;r++)f=this._getHeightOfChar(n,e[r],t,r),f>u&&(u=f);return u*this.lineHeight},_getTextHeight:function(n,t){for(var r=0,i=0,u=t.length;i<u;i++)r+=this._getHeightOfLine(n,i,t);return r},_getTopOffset:function(){var n=fabric.Text.prototype._getTopOffset.call(this);return n-this.fontSize/this._fontSizeFraction},_renderTextBoxBackground:function(n){this.backgroundColor&&(n.save(),n.fillStyle=this.backgroundColor,n.fillRect(this._getLeftOffset(),this._getTopOffset()+this.fontSize/this._fontSizeFraction,this.width,this.height),n.restore())},toObject:function(t){return fabric.util.object.extend(this.callSuper("toObject",t),{styles:n(this.styles)})}});fabric.IText.fromObject=function(t){return new fabric.IText(t.text,n(t))};fabric.IText.instances=[]}(),function(){var n=fabric.util.object.clone;fabric.util.object.extend(fabric.IText.prototype,{initBehavior:function(){this.initAddedHandler();this.initCursorSelectionHandlers();this.initDoubleClickSimulation()},initSelectedHandler:function(){this.on("selected",function(){var n=this;setTimeout(function(){n.selected=!0},100)})},initAddedHandler:function(){this.on("added",function(){this.canvas&&!this.canvas._hasITextHandlers&&(this.canvas._hasITextHandlers=!0,this._initCanvasHandlers())})},_initCanvasHandlers:function(){this.canvas.on("selection:cleared",function(){fabric.IText.prototype.exitEditingOnOthers.call()});this.canvas.on("mouse:up",function(){fabric.IText.instances.forEach(function(n){n.__isMousedown=!1})});this.canvas.on("object:selected",function(n){fabric.IText.prototype.exitEditingOnOthers.call(n.target)})},_tick:function(){if(!this._abortCursorAnimation){var n=this;this.animate("_currentCursorOpacity",1,{duration:this.cursorDuration,onComplete:function(){n._onTickComplete()},onChange:function(){n.canvas&&n.canvas.renderAll()},abort:function(){return n._abortCursorAnimation}})}},_onTickComplete:function(){if(!this._abortCursorAnimation){var n=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1);this._cursorTimeout1=setTimeout(function(){n.animate("_currentCursorOpacity",0,{duration:this.cursorDuration/2,onComplete:function(){n._tick()},onChange:function(){n.canvas&&n.canvas.renderAll()},abort:function(){return n._abortCursorAnimation}})},100)}},initDelayedCursor:function(n){var t=this,i=n?0:this.cursorDelay;n&&(this._abortCursorAnimation=!0,clearTimeout(this._cursorTimeout1),this._currentCursorOpacity=1,this.canvas&&this.canvas.renderAll());this._cursorTimeout2&&clearTimeout(this._cursorTimeout2);this._cursorTimeout2=setTimeout(function(){t._abortCursorAnimation=!1;t._tick()},i)},abortCursorAnimation:function(){this._abortCursorAnimation=!0;clearTimeout(this._cursorTimeout1);clearTimeout(this._cursorTimeout2);this._currentCursorOpacity=0;this.canvas&&this.canvas.renderAll();var n=this;setTimeout(function(){n._abortCursorAnimation=!1},10)},selectAll:function(){this.selectionStart=0;this.selectionEnd=this.text.length;this.fire("selection:changed");this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},getSelectedText:function(){return this.text.slice(this.selectionStart,this.selectionEnd)},findWordBoundaryLeft:function(n){var i=0,t=n-1;if(this._reSpace.test(this.text.charAt(t)))while(this._reSpace.test(this.text.charAt(t)))i++,t--;while(/\S/.test(this.text.charAt(t))&&t>-1)i++,t--;return n-i},findWordBoundaryRight:function(n){var i=0,t=n;if(this._reSpace.test(this.text.charAt(t)))while(this._reSpace.test(this.text.charAt(t)))i++,t++;while(/\S/.test(this.text.charAt(t))&&t<this.text.length)i++,t++;return n+i},findLineBoundaryLeft:function(n){for(var i=0,t=n-1;!/\n/.test(this.text.charAt(t))&&t>-1;)i++,t--;return n-i},findLineBoundaryRight:function(n){for(var i=0,t=n;!/\n/.test(this.text.charAt(t))&&t<this.text.length;)i++,t++;return n+i},getNumNewLinesInSelectedText:function(){for(var r=this.getSelectedText(),t=0,n=0,i=r.split(""),u=i.length;n<u;n++)i[n]==="\n"&&t++;return t},searchWordBoundary:function(n,t){for(var i=this._reSpace.test(this.text.charAt(n))?n-1:n,r=this.text.charAt(i),u=/[ \n\.,;!\?\-]/;!u.test(r)&&i>0&&i<this.text.length;)i+=t,r=this.text.charAt(i);return u.test(r)&&r!=="\n"&&(i+=t===1?0:1),i},selectWord:function(n){var t=this.searchWordBoundary(n,-1),i=this.searchWordBoundary(n,1);this.setSelectionStart(t);this.setSelectionEnd(i);this.initDelayedCursor(!0)},selectLine:function(n){var t=this.findLineBoundaryLeft(n),i=this.findLineBoundaryRight(n);this.setSelectionStart(t);this.setSelectionEnd(i);this.initDelayedCursor(!0)},enterEditing:function(){if(!this.isEditing&&this.editable)return this.exitEditingOnOthers(),this.isEditing=!0,this.initHiddenTextarea(),this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._tick(),this.canvas&&this.canvas.renderAll(),this.fire("editing:entered"),this.canvas&&this.canvas.fire("text:editing:entered",{target:this}),this},exitEditingOnOthers:function(){fabric.IText.instances.forEach(function(n){n.selected=!1;n.isEditing&&n.exitEditing()},this)},_setEditingProps:function(){this.hoverCursor="text";this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text");this.borderColor=this.editingBorderColor;this.hasControls=this.selectable=!1;this.lockMovementX=this.lockMovementY=!0},_updateTextarea:function(){this.hiddenTextarea&&(this.hiddenTextarea.value=this.text,this.hiddenTextarea.selectionStart=this.selectionStart)},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.overCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){return this.selected=!1,this.isEditing=!1,this.selectable=!0,this.selectionEnd=this.selectionStart,this.hiddenTextarea&&this.canvas&&this.hiddenTextarea.parentNode.removeChild(this.hiddenTextarea),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this.fire("editing:exited"),this.canvas&&this.canvas.fire("text:editing:exited",{target:this}),this},_removeExtraneousStyles:function(){var t=this.text.split(this._reNewline);for(var n in this.styles)t[n]||delete this.styles[n]},_removeCharsFromTo:function(n,t){for(var i=t,u,f,r;i!==n;)u=this.get2DCursorLocation(i).charIndex,i--,f=this.get2DCursorLocation(i).charIndex,r=f>u,r?this.removeStyleObject(r,i+1):this.removeStyleObject(this.get2DCursorLocation(i).charIndex===0,i);this.text=this.text.slice(0,n)+this.text.slice(t)},insertChars:function(n){var t=this.text.slice(this.selectionStart,this.selectionStart+1)==="\n";this.text=this.text.slice(0,this.selectionStart)+n+this.text.slice(this.selectionEnd);this.selectionStart===this.selectionEnd&&this.insertStyleObjects(n,t,this.copiedStyles);this.selectionStart+=n.length;this.selectionEnd=this.selectionStart;this.canvas&&this.canvas.renderAll().renderAll();this.setCoords();this.fire("changed");this.canvas&&this.canvas.fire("text:changed",{target:this})},insertNewlineStyleObject:function(t,i,r){var e,u,f;if(this.shiftLineStyles(t,1),this.styles[t+1]||(this.styles[t+1]={}),e=this.styles[t][i-1],u={},r)u[0]=n(e),this.styles[t+1]=u;else{for(f in this.styles[t])parseInt(f,10)>=i&&(u[parseInt(f,10)-i]=this.styles[t][f],delete this.styles[t][f]);this.styles[t+1]=u}},insertCharStyleObject:function(t,i,r){var f=this.styles[t],e=n(f),o,u;i!==0||r||(i=1);for(o in e)u=parseInt(o,10),u>=i&&(f[u+1]=e[u]);this.styles[t][i]=r||n(f[i-1])},insertStyleObjects:function(n,t,i){var u=this.get2DCursorLocation(),r=u.lineIndex,f=u.charIndex;this.styles[r]||(this.styles[r]={});n==="\n"?this.insertNewlineStyleObject(r,f,t):i?this._insertStyles(i):this.insertCharStyleObject(r,f)},_insertStyles:function(n){for(var t=0,i=n.length;t<i;t++){var r=this.get2DCursorLocation(this.selectionStart+t),u=r.lineIndex,f=r.charIndex;this.insertCharStyleObject(u,f,n[t])}},shiftLineStyles:function(t,i){var f=n(this.styles),u,r;for(u in this.styles)r=parseInt(u,10),r>t&&(this.styles[r+i]=f[r])},removeStyleObject:function(t,i){var s=this.get2DCursorLocation(i),r=s.lineIndex,e=s.charIndex,u,c,o,l,f;if(t){var a=this.text.split(this._reNewline),h=a[r-1],v=h?h.length:0;this.styles[r-1]||(this.styles[r-1]={});for(e in this.styles[r])this.styles[r-1][parseInt(e,10)+v]=this.styles[r][e];this.shiftLineStyles(r,-1)}else{u=this.styles[r];u&&(c=this.selectionStart===this.selectionEnd?-1:0,delete u[e+c]);o=n(u);for(l in o)f=parseInt(l,10),f>=e&&f!==0&&(u[f-1]=o[f],delete u[f])}},insertNewline:function(){this.insertChars("\n")}})}();fabric.util.object.extend(fabric.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date;this.__lastLastClickTime=+new Date;this.__lastPointer={};this.on("mousedown",this.onMouseDown.bind(this))},onMouseDown:function(n){this.__newClickTime=+new Date;var t=this.canvas.getPointer(n.e);this.isTripleClick(t)?(this.fire("tripleclick",n),this._stopEvent(n.e)):this.isDoubleClick(t)&&(this.fire("dblclick",n),this._stopEvent(n.e));this.__lastLastClickTime=this.__lastClickTime;this.__lastClickTime=this.__newClickTime;this.__lastPointer=t;this.__lastIsEditing=this.isEditing;this.__lastSelected=this.selected},isDoubleClick:function(n){return this.__newClickTime-this.__lastClickTime<500&&this.__lastPointer.x===n.x&&this.__lastPointer.y===n.y&&this.__lastIsEditing},isTripleClick:function(n){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===n.x&&this.__lastPointer.y===n.y},_stopEvent:function(n){n.preventDefault&&n.preventDefault();n.stopPropagation&&n.stopPropagation()},initCursorSelectionHandlers:function(){this.initSelectedHandler();this.initMousedownHandler();this.initMousemoveHandler();this.initMouseupHandler();this.initClicks()},initClicks:function(){this.on("dblclick",function(n){this.selectWord(this.getSelectionStartFromPointer(n.e))});this.on("tripleclick",function(n){this.selectLine(this.getSelectionStartFromPointer(n.e))})},initMousedownHandler:function(){this.on("mousedown",function(n){var t=this.canvas.getPointer(n.e);this.__mousedownX=t.x;this.__mousedownY=t.y;this.__isMousedown=!0;this.hiddenTextarea&&this.canvas&&this.canvas.wrapperEl.appendChild(this.hiddenTextarea);this.selected&&this.setCursorByClick(n.e);this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.initDelayedCursor(!0))})},initMousemoveHandler:function(){this.on("mousemove",function(n){if(this.__isMousedown&&this.isEditing){var t=this.getSelectionStartFromPointer(n.e);t>=this.__selectionStartOnMouseDown?(this.setSelectionStart(this.__selectionStartOnMouseDown),this.setSelectionEnd(t)):(this.setSelectionStart(t),this.setSelectionEnd(this.__selectionStartOnMouseDown))}})},_isObjectMoved:function(n){var t=this.canvas.getPointer(n);return this.__mousedownX!==t.x||this.__mousedownY!==t.y},initMouseupHandler:function(){this.on("mouseup",function(n){(this.__isMousedown=!1,this._isObjectMoved(n.e))||(this.__lastSelected&&(this.enterEditing(),this.initDelayedCursor(!0)),this.selected=!0)})},setCursorByClick:function(n){var t=this.getSelectionStartFromPointer(n);n.shiftKey?t<this.selectionStart?(this.setSelectionEnd(this.selectionStart),this.setSelectionStart(t)):this.setSelectionEnd(t):(this.setSelectionStart(t),this.setSelectionEnd(t))},_getLocalRotatedPointer:function(n){var t=this.canvas.getPointer(n),i=new fabric.Point(t.x,t.y),r=new fabric.Point(this.left,this.top),u=fabric.util.rotatePoint(i,r,fabric.util.degreesToRadians(-this.angle));return this.getLocalPointer(n,u)},getSelectionStartFromPointer:function(n){for(var c,l,u,e,a,f=this._getLocalRotatedPointer(n),i=this.text.split(this._reNewline),o=0,r=0,s=0,h=0,v,t=0,y=i.length;t<y;t++){for(s+=this._getHeightOfLine(this.ctx,t)*this.scaleY,c=this._getWidthOfLine(this.ctx,t,i),l=this._getLineLeftOffset(c),r=l*this.scaleX,this.flipX&&(i[t]=i[t].split("").reverse().join("")),u=0,e=i[t].length;u<e;u++){if(a=i[t][u],o=r,r+=this._getWidthOfChar(this.ctx,a,t,this.flipX?e-u:u)*this.scaleX,s<=f.y||r<=f.x){h++;continue}return this._getNewSelectionStartFromOffset(f,o,r,h+t,e)}if(f.y<s)return this._getNewSelectionStartFromOffset(f,o,r,h+t,e)}if(typeof v=="undefined")return this.text.length},_getNewSelectionStartFromOffset:function(n,t,i,r,u){var e=n.x-t,o=i-n.x,s=o>e?0:1,f=r+s;return this.flipX&&(f=u-f),f>this.text.length&&(f=this.text.length),f}});fabric.util.object.extend(fabric.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=fabric.document.createElement("textarea");this.hiddenTextarea.setAttribute("autocapitalize","off");this.hiddenTextarea.style.cssText="position: fixed; bottom: 20px; left: 0px; opacity: 0; width: 0px; height: 0px; z-index: -999;";fabric.document.body.appendChild(this.hiddenTextarea);fabric.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this));fabric.util.addListener(this.hiddenTextarea,"keypress",this.onKeyPress.bind(this));fabric.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this));fabric.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this));!this._clickHandlerInitialized&&this.canvas&&(fabric.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},_keysMap:{8:"removeChars",9:"exitEditing",27:"exitEditing",13:"insertNewline",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown",46:"forwardDelete"},_ctrlKeysMap:{65:"selectAll",88:"cut"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(n){if(this.isEditing){if(n.keyCode in this._keysMap)this[this._keysMap[n.keyCode]](n);else{if(!(n.keyCode in this._ctrlKeysMap&&(n.ctrlKey||n.metaKey)))return;this[this._ctrlKeysMap[n.keyCode]](n)}n.stopImmediatePropagation();n.preventDefault();this.canvas&&this.canvas.renderAll()}},forwardDelete:function(n){this.selectionStart===this.selectionEnd&&this.moveCursorRight(n);this.removeChars(n)},copy:function(n){var t=this.getSelectedText(),i=this._getClipboardData(n);i&&i.setData("text",t);this.copiedText=t;this.copiedStyles=this.getSelectionStyles(this.selectionStart,this.selectionEnd)},paste:function(n){var t=null,i=this._getClipboardData(n);t=i?i.getData("text"):this.copiedText;t&&this.insertChars(t)},cut:function(n){this.selectionStart!==this.selectionEnd&&(this.copy(),this.removeChars(n))},_getClipboardData:function(n){return n&&(n.clipboardData||fabric.window.clipboardData)},onKeyPress:function(n){!this.isEditing||n.metaKey||n.ctrlKey||(n.which!==0&&this.insertChars(String.fromCharCode(n.which)),n.stopPropagation())},getDownCursorOffset:function(n,t){var r=t?this.selectionEnd:this.selectionStart,f=this.text.split(this._reNewline),o,s,h=this.text.slice(0,r),c=this.text.slice(r),l=h.slice(h.lastIndexOf("\n")+1),w=c.match(/(.*)\n?/)[1],b=(c.match(/.*\n(.*)\n?/)||{})[1]||"",u=this.get2DCursorLocation(r),a,e,v,i,y,p;if(u.lineIndex===f.length-1||n.metaKey||n.keyCode===34)return this.text.length-r;for(a=this._getWidthOfLine(this.ctx,u.lineIndex,f),s=this._getLineLeftOffset(a),e=s,v=u.lineIndex,i=0,y=l.length;i<y;i++)o=l[i],e+=this._getWidthOfChar(this.ctx,o,v,i);return p=this._getIndexOnNextLine(u,b,e,f),w.length+1+p},_getIndexOnNextLine:function(n,t,i,r){for(var c,o,s=n.lineIndex+1,l=this._getWidthOfLine(this.ctx,s,r),a=this._getLineLeftOffset(l),f=a,e=0,h,u=0,v=t.length;u<v;u++)if(c=t[u],o=this._getWidthOfChar(this.ctx,c,s,u),f+=o,f>i){h=!0;var y=f-o,p=f,w=Math.abs(y-i),b=Math.abs(p-i);e=b<w?u+1:u;break}return h||(e=t.length),e},moveCursorDown:function(n){this.abortCursorAnimation();this._currentCursorOpacity=1;var t=this.getDownCursorOffset(n,this._selectionDirection==="right");n.shiftKey?this.moveCursorDownWithShift(t):this.moveCursorDownWithoutShift(t);this.initDelayedCursor()},moveCursorDownWithoutShift:function(n){this._selectionDirection="right";this.selectionStart+=n;this.selectionStart>this.text.length&&(this.selectionStart=this.text.length);this.selectionEnd=this.selectionStart;this.fire("selection:changed");this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},swapSelectionPoints:function(){var n=this.selectionEnd;this.selectionEnd=this.selectionStart;this.selectionStart=n},moveCursorDownWithShift:function(n){this.selectionEnd===this.selectionStart&&(this._selectionDirection="right");var t=this._selectionDirection==="right"?"selectionEnd":"selectionStart";this[t]+=n;this.selectionEnd<this.selectionStart&&this._selectionDirection==="left"&&(this.swapSelectionPoints(),this._selectionDirection="right");this.selectionEnd>this.text.length&&(this.selectionEnd=this.text.length);this.fire("selection:changed");this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},getUpCursorOffset:function(n,t){var u=t?this.selectionEnd:this.selectionStart,r=this.get2DCursorLocation(u),i,l,a;if(r.lineIndex===0||n.metaKey||n.keyCode===33)return u;var f=this.text.slice(0,u),e=f.slice(f.lastIndexOf("\n")+1),o=(f.match(/\n?(.*)\n.*$/)||{})[1]||"",s=this.text.split(this._reNewline),h,v=this._getWidthOfLine(this.ctx,r.lineIndex,s),y=this._getLineLeftOffset(v),c=y,p=r.lineIndex;for(i=0,l=e.length;i<l;i++)h=e[i],c+=this._getWidthOfChar(this.ctx,h,p,i);return a=this._getIndexOnPrevLine(r,o,c,s),o.length-a+e.length},_getIndexOnPrevLine:function(n,t,i,r){for(var c,o,s=n.lineIndex-1,l=this._getWidthOfLine(this.ctx,s,r),a=this._getLineLeftOffset(l),f=a,e=0,h,u=0,v=t.length;u<v;u++)if(c=t[u],o=this._getWidthOfChar(this.ctx,c,s,u),f+=o,f>i){h=!0;var y=f-o,p=f,w=Math.abs(y-i),b=Math.abs(p-i);e=b<w?u:u-1;break}return h||(e=t.length-1),e},moveCursorUp:function(n){this.abortCursorAnimation();this._currentCursorOpacity=1;var t=this.getUpCursorOffset(n,this._selectionDirection==="right");n.shiftKey?this.moveCursorUpWithShift(t):this.moveCursorUpWithoutShift(t);this.initDelayedCursor()},moveCursorUpWithShift:function(n){this.selectionEnd===this.selectionStart&&(this._selectionDirection="left");var t=this._selectionDirection==="right"?"selectionEnd":"selectionStart";this[t]-=n;this.selectionEnd<this.selectionStart&&this._selectionDirection==="right"&&(this.swapSelectionPoints(),this._selectionDirection="left");this.selectionStart<0&&(this.selectionStart=0);this.fire("selection:changed");this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},moveCursorUpWithoutShift:function(n){this.selectionStart===this.selectionEnd&&(this.selectionStart-=n);this.selectionStart<0&&(this.selectionStart=0);this.selectionEnd=this.selectionStart;this._selectionDirection="left";this.fire("selection:changed");this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},moveCursorLeft:function(n){(this.selectionStart!==0||this.selectionEnd!==0)&&(this.abortCursorAnimation(),this._currentCursorOpacity=1,n.shiftKey?this.moveCursorLeftWithShift(n):this.moveCursorLeftWithoutShift(n),this.initDelayedCursor())},_move:function(n,t,i){n.altKey?this[t]=this["findWordBoundary"+i](this[t]):n.metaKey||n.keyCode===35||n.keyCode===36?this[t]=this["findLineBoundary"+i](this[t]):this[t]+=i==="Left"?-1:1},_moveLeft:function(n,t){this._move(n,t,"Left")},_moveRight:function(n,t){this._move(n,t,"Right")},moveCursorLeftWithoutShift:function(n){this._selectionDirection="left";this.selectionEnd===this.selectionStart&&this._moveLeft(n,"selectionStart");this.selectionEnd=this.selectionStart;this.fire("selection:changed");this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},moveCursorLeftWithShift:function(n){this._selectionDirection==="right"&&this.selectionStart!==this.selectionEnd?this._moveLeft(n,"selectionEnd"):(this._selectionDirection="left",this._moveLeft(n,"selectionStart"),this.text.charAt(this.selectionStart)==="\n"&&this.selectionStart--,this.selectionStart<0&&(this.selectionStart=0));this.fire("selection:changed");this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},moveCursorRight:function(n){this.selectionStart>=this.text.length&&this.selectionEnd>=this.text.length||(this.abortCursorAnimation(),this._currentCursorOpacity=1,n.shiftKey?this.moveCursorRightWithShift(n):this.moveCursorRightWithoutShift(n),this.initDelayedCursor())},moveCursorRightWithShift:function(n){this._selectionDirection==="left"&&this.selectionStart!==this.selectionEnd?this._moveRight(n,"selectionStart"):(this._selectionDirection="right",this._moveRight(n,"selectionEnd"),this.text.charAt(this.selectionEnd-1)==="\n"&&this.selectionEnd++,this.selectionEnd>this.text.length&&(this.selectionEnd=this.text.length));this.fire("selection:changed");this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},moveCursorRightWithoutShift:function(n){this._selectionDirection="right";this.selectionStart===this.selectionEnd?(this._moveRight(n,"selectionStart"),this.selectionEnd=this.selectionStart):(this.selectionEnd+=this.getNumNewLinesInSelectedText(),this.selectionEnd>this.text.length&&(this.selectionEnd=this.text.length),this.selectionStart=this.selectionEnd);this.fire("selection:changed");this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},removeChars:function(n){this.selectionStart===this.selectionEnd?this._removeCharsNearCursor(n):this._removeCharsFromTo(this.selectionStart,this.selectionEnd);this.selectionEnd=this.selectionStart;this._removeExtraneousStyles();this.canvas&&this.canvas.renderAll().renderAll();this.setCoords();this.fire("changed");this.canvas&&this.canvas.fire("text:changed",{target:this})},_removeCharsNearCursor:function(n){var t,i,r;this.selectionStart!==0&&(n.metaKey?(t=this.findLineBoundaryLeft(this.selectionStart),this._removeCharsFromTo(t,this.selectionStart),this.selectionStart=t):n.altKey?(i=this.findWordBoundaryLeft(this.selectionStart),this._removeCharsFromTo(i,this.selectionStart),this.selectionStart=i):(r=this.text.slice(this.selectionStart-1,this.selectionStart)==="\n",this.removeStyleObject(r),this.selectionStart--,this.text=this.text.slice(0,this.selectionStart)+this.text.slice(this.selectionStart+1)))}});fabric.util.object.extend(fabric.IText.prototype,{_setSVGTextLineText:function(n,t,i,r,u,f){this.styles[t]?this._setSVGTextLineChars(n,t,i,r,u,f):this.callSuper("_setSVGTextLineText",n,t,i,r,u)},_setSVGTextLineChars:function(n,t,i,r,u,f){for(var o,c,v=t===0||this.useNative?"y":"dy",s=n.split(""),h=0,l=this._getSVGLineLeftOffset(t),a=this._getSVGLineTopOffset(t),y=this._getHeightOfLine(this.ctx,t),e=0,p=s.length;e<p;e++)o=this.styles[t][e]||{},i.push(this._createTextCharSpan(s[e],o,l,a,v,h)),c=this._getWidthOfChar(this.ctx,s[e],t,e),o.textBackgroundColor&&f.push(this._createTextCharBg(o,l,a,y,c,h)),h+=c},_getSVGLineLeftOffset:function(n){return this._boundaries&&this._boundaries[n]?fabric.util.toFixed(this._boundaries[n].left,2):0},_getSVGLineTopOffset:function(n){for(var i=0,t=0;t<=n;t++)i+=this._getHeightOfLine(this.ctx,t);return i-this.height/2},_createTextCharBg:function(n,t,i,r,u,f){return['<rect fill="',n.textBackgroundColor,'" transform="translate(',-this.width/2," ",-this.height+r,")",'" x="',t+f,'" y="',i+r,'" width="',u,'" height="',r,'"><\/rect>'].join("")},_createTextCharSpan:function(n,t,i,r,u,f){var e=this.getSvgStyles.call(fabric.util.object.extend({visible:!0,fill:this.fill,stroke:this.stroke,type:"text"},t));return['<tspan x="',i+f,'" ',u,'="',r,'" ',t.fontFamily?'font-family="'+t.fontFamily.replace(/"/g,"'")+'" ':"",t.fontSize?'font-size="'+t.fontSize+'" ':"",t.fontStyle?'font-style="'+t.fontStyle+'" ':"",t.fontWeight?'font-weight="'+t.fontWeight+'" ':"",t.textDecoration?'text-decoration="'+t.textDecoration+'" ':"",'style="',e,'">',fabric.util.string.escapeXml(n),"<\/tspan>"].join("")}}),function(){function n(n,t,i){var r=e.parse(n),f,u;r.port||(r.port=r.protocol.indexOf("https:")===0?443:80);f=r.port===443?s:o;u=f.request({hostname:r.hostname,port:r.port,path:r.path,method:"GET"},function(n){var r="";t&&n.setEncoding(t);n.on("end",function(){i(r)});n.on("data",function(t){n.statusCode===200&&(r+=t)})});u.on("error",function(n){n.errno===process.ECONNREFUSED?fabric.log("ECONNREFUSED: connection refused to "+r.hostname+":"+r.port):fabric.log(n.message)});u.end()}function t(n,t){var i=require("fs");i.readFile(n,function(n,i){if(n)throw fabric.log(n),n;t(i)})}var r,u;if(typeof document=="undefined"||typeof window=="undefined"){var f=require("xmldom").DOMParser,e=require("url"),o=require("http"),s=require("https"),i=require("canvas"),h=require("canvas").Image;fabric.util.loadImage=function(i,r,u){function e(n){f.src=new Buffer(n,"binary");f._src=i;r&&r.call(u,f)}var f=new h;i&&(i instanceof Buffer||i.indexOf("data")===0)?(f.src=f._src=i,r&&r.call(u,f)):i&&i.indexOf("http")!==0?t(i,e):i?n(i,"binary",e):r&&r.call(u,i)};fabric.loadSVGFromURL=function(i,r,u){i=i.replace(/^\n\s*/,"").replace(/\?.*$/,"").trim();i.indexOf("http")!==0?t(i,function(n){fabric.loadSVGFromString(n.toString(),r,u)}):n(i,"",function(n){fabric.loadSVGFromString(n,r,u)})};fabric.loadSVGFromString=function(n,t,i){var r=(new f).parseFromString(n);fabric.parseSVGDocument(r.documentElement,function(n,i){t&&t(n,i)},i)};fabric.util.getScript=function(t,i){n(t,"",function(n){eval(n);i&&i()})};fabric.Image.fromObject=function(n,t){fabric.util.loadImage(n.src,function(i){var r=new fabric.Image(i);r._initConfig(n);r._initFilters(n,function(n){r.filters=n||[];t&&t(r)})})};fabric.createCanvasForNode=function(n,t,r,u){var f,e,s,o;return u=u||r,f=fabric.document.createElement("canvas"),e=new i(n||600,t||600,u),f.style={},f.width=e.width,f.height=e.height,s=fabric.Canvas||fabric.StaticCanvas,o=new s(f,r),o.contextContainer=e.getContext("2d"),o.nodeCanvas=e,o.Font=i.Font,o};fabric.StaticCanvas.prototype.createPNGStream=function(){return this.nodeCanvas.createPNGStream()};fabric.StaticCanvas.prototype.createJPEGStream=function(n){return this.nodeCanvas.createJPEGStream(n)};r=fabric.StaticCanvas.prototype.setWidth;fabric.StaticCanvas.prototype.setWidth=function(n,t){return r.call(this,n,t),this.nodeCanvas.width=n,this};fabric.Canvas&&(fabric.Canvas.prototype.setWidth=fabric.StaticCanvas.prototype.setWidth);u=fabric.StaticCanvas.prototype.setHeight;fabric.StaticCanvas.prototype.setHeight=function(n,t){return u.call(this,n,t),this.nodeCanvas.height=n,this};fabric.Canvas&&(fabric.Canvas.prototype.setHeight=fabric.StaticCanvas.prototype.setHeight)}}();