/*!
 * jQuery Stepy - A Wizard Plugin - http://wbotelhos.com/stepy
 * ------------------------------------------------------------------------------------
 *
 * jQuery Stepy is a plugin based on FormToWizard that generates a customizable wizard.
 * 
 * Licensed under The MIT License
 * 
 * @version        1.0.0
 * @since          2010.07.03
 * @author         Washington Botelho
 * @documentation  wbotelhos.com/stepy
 * @twitter        twitter.com/wbotelhos
 * 
 * Usage with default values:
 * ------------------------------------------------------------------------------------
 * $('#step').stepy();
 *
 *	<form id="step">
 *		<fieldset title="Step 1">
 *			<legend>description one</legend>
 *			<!-- input fields -->
 *		</fieldset>
 *
 *		<fieldset title="Step 2">
 *			<legend>description one</legend>
 *			<!-- input fields -->
 *		</fieldset>
 *
 *		<input type="submit" class="finish" value="Finish!"/>
 *	</form>
 *
 */
(function(n){var t={init:function(i){return this.each(function(){var u=n.extend({},n.fn.stepy.defaults,i),r=n(this).data("options",u),f=r.attr("id"),o,c,l,p,v;(f===undefined||f=="")&&(f="stepy-"+n("."+r.attr("class")).index(this),r.attr("id",f));o=n("<ul/>",{id:f+"-titles","class":"stepy-titles clearfix"});u.titleTarget?n(u.titleTarget).html(o):o.insertBefore(r);u.validate&&(jQuery.validator.setDefaults({ignore:u.ignore}),r.append('<div class="stepy-error clearfix"/>'));var e=r.children("fieldset"),s=undefined,a=undefined,y="",h="";e.each(function(i){s=n(this);s.addClass("step").attr("id",f+"-step-"+i).append('<p id="'+f+"-buttons-"+i+'" class="'+f+'-buttons"/>');a=s.children("legend");u.legend||a.hide();y="";u.description&&(a.length?y="<span>"+a.html()+"<\/span>":n.error(f+": the legend element of the step "+(i+1)+" is required to set the description!"));h=s.attr("title");h=h!=""?"<div>"+h+"<\/div>":"--";o.append('<li id="'+f+"-title-"+i+'">'+h+y+"<\/li>");i==0?e.length>1&&t.createNextButton.call(r,i):(t.createBackButton.call(r,i),s.hide(),i<e.length-1&&t.createNextButton.call(r,i))});c=o.children();c.first().addClass("current-step");l=r.children(".finish");u.finishButton&&(l.length?(p=r.is("form"),v=undefined,u.finish&&p&&(v=r.attr("onsubmit"),r.attr("onsubmit","return false;")),l.click(function(n){if(u.finish&&!t.execute.call(r,u.finish,e.length-1))n.preventDefault();else if(p){v?r.attr("onsubmit",v):r.removeAttr("onsubmit");var i=l.attr("type")=="submit";i||u.validate&&!t.validate.call(r,e.length-1)||r.submit()}}),l.appendTo(r.find("p:last"))):n.error(f+': element with class name "finish" missing!'));u.titleClick?c.click(function(){var e=c.filter(".current-step").attr("id").split("-"),f=parseInt(e[e.length-1],10),i=n(this).index();if(i>f){if(u.next&&!t.execute.call(r,u.next,i))return!1}else if(i<f&&u.back&&!t.execute.call(r,u.back,i))return!1;i!=f&&t.step.call(r,i+1)}):c.css("cursor","default");e.delegate('input[type="text"], input[type="password"]',"keypress",function(t){var e=t.keyCode?t.keyCode:t.which,i,r,u;e==13&&(t.preventDefault(),i=n(this).parent().children("."+f+"-buttons"),i.length&&(r=i.children(".button-next"),r.length?r.click():(u=i.children(".finish"),u.length&&u.click())))});e.first().find(":input:visible:enabled").first().select().focus()})},createBackButton:function(i){var u=this,f=this.attr("id"),r=this.data("options");n("<a/>",{id:f+"-back-"+i,href:"javascript:void(0);","class":"button-back btn btn-info",html:r.backLabel}).click(function(){(!r.back||t.execute.call(u,r.back,i-1))&&t.step.call(u,i-0)}).appendTo(n("#"+f+"-buttons-"+i))},createNextButton:function(i){var u=this,f=this.attr("id"),r=this.data("options");n("<a/>",{id:f+"-next-"+i,href:"javascript:void(0);","class":"button-next  btn btn-info",html:r.nextLabel}).click(function(){(!r.next||t.execute.call(u,r.next,i+1))&&t.step.call(u,i+1+1)}).appendTo(n("#"+f+"-buttons-"+i))},execute:function(n,t){var i=n.call(this,t+1);return i||i===undefined},step:function(i){var r,u,e,f,s,o;if(i--,r=this.children("fieldset"),i>r.length-1&&(i=r.length-1),u=this.data("options"),max=i,u.validate)for(e=!0,f=0;f<i;f++)if(e&=t.validate.call(this,f),u.block&&!e){max=f;break}return r.hide().eq(max).show(),s=n("#"+this.attr("id")+"-titles").children(),s.removeClass("current-step").eq(max).addClass("current-step"),this.is("form")&&(o=undefined,o=max==i?r.eq(max).find(":input:enabled:visible"):r.eq(max).find(".error").select().focus(),o.first().select().focus()),u.select&&u.select.call(this,max+1),this},validate:function(t){if(!this.is("form"))return!0;var e=this.children("fieldset").eq(t),i=!0,r=n("#"+this.attr("id")+"-titles").children().eq(t),u=this.data("options"),f=this.validate();return n(e.find(":input:enabled").get().reverse()).each(function(){var t=f.element(n(this));t===undefined&&(t=!0);i&=t;i?u.errorImage&&r.removeClass("error-image"):(u.errorImage&&r.addClass("error-image"),f.focusInvalid())}),i}};n.fn.stepy=function(i){if(t[i])return t[i].apply(this,Array.prototype.slice.call(arguments,1));if(typeof i!="object"&&i)n.error("Method "+i+" does not exist!");else return t.init.apply(this,arguments)};n.fn.stepy.defaults={back:undefined,backLabel:"&lt; Back",block:!1,description:!0,errorImage:!1,finish:undefined,finishButton:!0,legend:!0,ignore:"",next:undefined,nextLabel:"Next &gt;",titleClick:!1,titleTarget:undefined,validate:!1,select:undefined}})(jQuery);